\chapter{Groups}
\label{ch:groups}


An identity type is not just any type:  in the previous sections we have seen that the identity type $a\eqto_Aa$ reflects the ``symmetries'' of an element $a$ in a type $A$.\footnote{%
  Since the symmetries $p : a\eqto_A a$ are paths that start and end
  at the point $a:A$, we also call them \emph{loops} at $a$,
  or \emph{automorphisms} of $a$.\par
  \begin{tikzpicture}
    \draw plot [smooth cycle] coordinates {(0,0) (2.3,0) (2,1.9) (0,2.1)};
    \node[dot,label=left:$a$] (a) at (0.5,0.3) {};
    \node (A) at (2.5,2.1) {$A$};
    \draw[->] (a) .. controls ++(-10:3) and ++(100:2.5) .. node[auto,swap] {$p$} (a);
  \end{tikzpicture}}
Symmetries have special properties.  For instance, you can rotate a square by $90\mathdegree$, and you can reverse that motion by rotating it by $-90\mathdegree$.
Symmetries can also be composed, and this composition respects certain rules that hold in all examples.  One way to study the concept of ``symmetries'' would be to isolate the common rules for all our examples, and to show, conversely, that anything satisfying these rules actually \emph{is} an example.



With inspiration of geometric and algebraic origins, it became clear to mathematicians at the end of the 19\textsuperscript{th} century that the properties of such symmetries could be codified by saying that they form an abstract \emph{group}.
In \cref{sec:identity-types} we saw that equality is ``reflexive, symmetric 
and transitive'' -- implemented by operations $\refl{a}$, $\symm_{a,b}$ 
and $\trans_{a,b,c}$, and an abstract group is just a set with such 
operations satisfying appropriate rules.

We attack the issue more concretely:
instead of focusing on the abstract properties,
we bring the type exhibiting the symmetries to the fore.
This type is called the \emph{classifying type} of the group.
The axioms for an abstract group follow from the rules for identity types,
without us needing to impose them.
We will show that the two approaches give the same end result.

In this chapter we lay the foundations and provide some basic examples of groups.

\section{Brief overview of the chapter}
In \cref{sec:typegroup} we give the formal definition of a group 
along with some basic examples.
In \cref{sec:identity-type-as-abstract} we expand on the properties of a group
and compare these with those of an abstract group.
In \cref{sec:homomorphisms} we explain how groups map to each other through
``homomorphisms'' (which to us are simply given by pointed maps),
and what this entails for the identity types: 
all the abstract group properties are preserved.
As an important example, we study the sign homomorphism 
in~\cref{sec:sign-homomorphism}.

In most of our exposition we make the blanket assumption that the identity type in question is a set, but in \cref{sec:inftygps} we briefly discuss $\infty$-groups, where this assumption is dropped.

Classically, groups have appeared because they ``act'' on a set 
(or more general objects), that is to say, they collect some of the
symmetries of the set. This is a point of view that we will return to
many times and we give the basic theory in \cref{sec:gsets}.
This section should remind the reader of the material in \cref{cha:circle},
where we dealt with the special case of the group of integers.
More generally, connected \coverings now reappear in the guise of
``transitive $G$-sets'', laying the groundwork for our later discussion 
of the set of subgroups of a group.

Also discussed in \cref{sec:gsets} is the notion of ``$G$-torsor''.
A $G$-torsor is a $G$-set that is merely equal to the universal \covering.
The type of $G$-torsors recovers the classifying type of the group $G$,
and this idea is used in \cref{sec:Gsetforabstract} to build the equivalence between our definition of a group and the abstract version taught in most algebra classes.  This is followed up for homomorphisms in \cref{sec:homabsisconcr} and for $G$-sets in \cref{sec:Gsetsabstrconcr}.
(\MB{missing: \cref{sec:monoepi}, \cref{sec:abelian-groups}, \cref{sec:Semidirect-products}, \cref{sec:pullback}, \cref{sec:coprod}. Next para is unfinished.}.)


With all this in place, the structure of the type of groups is in many aspects similar to the universe, in the sense that many of the constructions on the universe that we're accustomed to have analogues for groups, namely:
functions are replaced by homomorphisms;
products stay ``the same,'' as we will see in \cref{ex:productofgroups}
(and more generally, product types over sets ``stay the same'');
and the sum of two groups has a simple implementation as the sum of the underlying types with the base points identified, as defined more precisely in \cref{def:wedge}.
In the usual treatment this is a somewhat more difficult subject involving ``words'' taken from the two groups.
This reappears in our setting when we show that homomorphisms
from a sum to another group
correspond to pairs of homomorphisms
(just as for sums of types and functions between types).

A deeper study of subgroups is postponed to \cref{ch:subgroups},
where they take center stage.

\section{The type of groups}
\label{sec:typegroup}

In order to motivate the formal definition of a group we
revisit some types that we have seen in earlier chapters,
paying special attention to the symmetries in these types.
\begin{example}\label{ex:base=base}
  We defined the circle $\Sc$ in \cref{def:circle} by declaring
  that it has a point $\base$ and an identification (``symmetry'')
  $\Sloop:\base\eqto\base$.
  In \cref{cor:S1groupoid} we proved that $\base\eqto\base$ is equivalent
  to the set $\zet$ (of integers),
  where $n\in\zet$ corresponds to the $n$-fold composition of $\Sloop$ with itself
  (which works for both positive and negative $n$).
  We can think of this as describing the symmetries of $\base$ as follows.
  We have one ``generating symmetry'' $\Sloop$,
  and this symmetry can be composed with itself any number of times,
  giving a symmetry for each integer.
  Composition of symmetries here corresponds to addition of integers.

  The circle is an efficient packaging of the ``{group}'' of integers, 
  for the declaration of $\base$ and $\Sloop$ not only gives the \emph{set}
  $\zet$ of integers, but also the addition operation.
\end{example}
\begin{example}
  Recall the finite set $\bn{2}:\FinSet_2$ from \cref{def:finiteset},
  containing two elements.
  According to \cref{xca:C2}, the identity type $\bn{2} \eqto \bn{2}$ 
  has exactly two distinct elements, $\refl{\bn{2}}$ and $\twist$,
  and doing $\twist$ twice yields $\refl{\bn{2}}$.
  We see that these are all the symmetries
  of a two point set you'd expect to have:
  you can let everything stay in place ($\refl{\bn{2}}$);
  or you can swap the two elements ($\twist$).
  If you swap twice, the result leaves everything in place.
  The pointed type $\FinSet_2$ (of ``finite sets with two elements''),
  with $\bn{2}$ as the base point, is our embodiment of these symmetries, 
  \ie they are the elements of $\bn{2} \eqto \bn{2}$.

  Observe that, by the induction principle of $\Sc$,
  there is an interesting function $\Sc\to\FinSet_2$,
  sending $\base:\Sc$ to $\bn{2} :\FinSet_2$ and $\Sloop$ to $\twist$.
  We saw this already in~\cref{fig:covering}.
\end{example}

Note that the types $\Sc$ and $\FinSet_2$ in the examples above are groupoids.
For an arbitrary type $A$ and an element $a:A$,
the symmetries of $a$ in $A$ form an \inftygp, cf.~\cref{sec:inftygps} below.
However, in elementary texts it is customary to restrict the notion 
of a group to the case when $a\eqto_A a$ is a \emph{set}, 
as we will do, starting in \cref{sec:identity-type-as-abstract}.
This makes things considerably easier: if are we given two elements 
$g,h:a\eqto_A a$, then the identity type $g\eqto h$ is a proposition
(and we can simply write $g = h$). That is, $g$ can be equal to $h$ in 
at most one way, and questions relating to uniqueness of
identification will never present a problem.

The examples of groups that Klein and Lie were interested in
often had more structure on the set $a\eqto_A a$,
for instance a topology or a smooth structure.
For such a group it makes sense to look at smooth maps from the real numbers
to $a\eqto_A a$, or to talk about a convergent sequence of symmetries of $a$.
\footnote{%
  Such groups give rise to \inftygps by converting
  continuous (or smooth) symmetries of $a$ in $A$
  parametrized by the continuous (or smooth) real interval,
  into identifications,
  as described already in \cref{ft:cohesive}
  in \cref{ch:univalent-mathematics}.
  Then also smooth or continuous paths in $a\eqto_A a$
  turn into identifications of symmetries.
  See also~\cref{sec:topology}.}
See \cref{ch:grouphistory} for a brief summary of the history of groups.

\begin{remark}\label{rem:heap-preview}
  The reader may wonder about the status of the identity type 
  $a\eqto_A a'$ where $a,a':A$ are different elements.
  One problem is of course that if $p,q:a\eqto_A a'$,
  there is no obvious way of composing $p$ and $q$
  to get another element in $a\eqto_A a'$.
  Another problem is that $a\eqto_A a'$ does not have a distinguished element,
  such as $\refl{a}:a\eqto_A a$.\footnote{%
    The type $a\eqto_A a'$ does have an interesting \emph{ternary}
    composition, mapping $p,q,r$ to $p\inv{q}r$.
    A set with this kind of operation is called a \emph{heap},
    and we'll explore heaps further in \cref{sec:heaps}.}
Given an $f:a\eqto_A a'$ we can use transport along $f$ to compare 
$a\eqto_A a'$ with $a\eqto_A a$ (much as affine planes can be compared 
with the standard plane or a finite dimensional real vector space is 
isomorphic to some Euclidean space), but absent the existence and choice 
of such an $f$ the identity types $a\eqto_Aa'$ and $a\eqto_Aa$ are 
different animals.
We will return to this example in \cref{sec:heaps}.
\end{remark}


\begin{remark}
  \label{rem:whypointedconngpoid}
  As a consequence of \cref{lem:subtype-eq-=},\marginnote{%
    \begin{tikzpicture}
      \draw plot [smooth cycle] coordinates {(0,0) (2.8,0) (2.5,1.9) (0,2.1)};
      \draw[dashed] plot [smooth cycle] coordinates
      {(.1,.1) (1.2,.1) (1,1.5) (.1,1.7)};
      \node[dot,label=left:$a$] (a) at (0.5,.3) {};
      \node[dot,label=right:$b$] (b) at (1.8,.3) {};
      \node (cdots) at (1.8,1.4) {$\cdots$};
      \node (A) at (2.6,2.1) {$A$};
      \node (Aa) at (.7,1.9) {$A_{(a)}$};
      \draw[->] (a) .. controls ++(-10:1) and ++(110:1.6) .. node[auto,swap]
      {$p$} (a);
      \draw[dashed] plot [smooth cycle] coordinates
      {(1.5,.1) (2.5,.2) (2.6,.8) (1.5,.9)};
      \draw[dashed] plot [smooth cycle] coordinates
      {(1.5,1.1) (2.5,1.2) (2.4,1.8) (1.2,2)};
    \end{tikzpicture}}
  the inclusion of the component $\conncomp A a \defequi \sum_{x:A}
  \Trunc{a\eqto x}$ into $A$ (\ie the first projection)
  induces an equivalence of identity types
  from $(a,!)\eqto_{A_{(a)}}(a,!)$ to $a\eqto_A a$. 
  This means that, when considering the loop type $a\eqto_A a$,
  ``only the elements $x:A$ with $x$ merely equal to $a$ are relevant''.
  To avoid irrelevant extra components,
  we should consider only \emph{connected} types $A$ (\cf \cref{def:connected}).

  Also, our preference for $a\eqto_A a$ to be a \emph{set}
  indicates that we should consider only the connected types $A$
  that are \emph{groupoids}.
\end{remark}

\begin{definition}\label{def:pt-conn-groupoid}
  The type of \emph{pointed, connected groupoids} is the type\marginnote{%
    The meaning of the superscript ``${=1}$'' can be explained as follows:
    We also define
    \begin{align*}
      \UU^{\le1}&\defeq\Groupoid\\
      &\defeq
        \sum_{A:\UU} \isgrpd(A)
    \end{align*}
    to emphasize that groupoids are $1$-types;
    the type of connected types is defined as follows.
    \[
    \UU^{>0} \defeq \sum_{A:\UU} \isconn(A)
    \]
  Similar notations with a subscript ``$*$'' indicate pointed types.}%
  \glossary(UU1){$\protect\UUscone$}{pointed, connected groupoids, \cref{def:pt-conn-groupoid}}
  \[
  \UUscone \defeq \sum_{A:\UU} ( A \times \isconn(A) \times \isgrpd(A) ).\qedhere
  \]
\end{definition}

\begin{xca}\label{xca:defgroup}
  Given a type $A$ and an element $a:A$, 
  show that $A$ is connected if and only if the proposition 
  $\prod_{x:A}\Trunc{a \eqto_A x}$ holds.
  Show furthermore that $A$ is a groupoid if and only if the 
  type $a\eqto_A a$ is a set.
  Conclude by showing that the type $\UUscone$ is equivalent to the type
  \[
    \sum_{A:\UU} \sum_{a:A} \biggl( \Bigl( \prod_{x:A}\Trunc{a \eqto_A x} \Bigr)
      \times \isset( a\eqto_A a ) \biggr).\qedhere
  \]
\end{xca}

\begin{remark}
  We shall refer to a pointed connected groupoid $(A,a,p,q)$ simply
  by the pointed type $X \defeq (A,a)$.
  There is no essential ambiguity in this, for
  the types $\isconn(A)$ and $\isgrpd(A)$ are propositions 
  (\cref{lem:prop-utils} and \cref{lem:isX-is-prop}),
  and so the witnesses $p$ and $q$ are unique.
\end{remark}

We are now ready to define the type of groups.

\begin{definition}\label{def:typegroup}
  The \emph{type of groups} is a wrapped copy (see \cref{sec:unary-sum-types})
  of the type of pointed connected groupoids $\UUscone$,
  \[
    \typegroup \defequi \Copy_{\mkgroup}(\UUscone),
  \]
  with constructor $\mkgroup : \UUscone \to \Group$.%
  \glossary(924Omega_){$\protect\mkgroup$}{group constructor,
  \cref{def:typegroup}}\index{group}%
  \footnote{%
  The reader may ask why we use $\mkgroup$, which only makes a wrapped
  copy of each $(A,s,p,q): \UUscone$. The answer is that flatly defining
  groups as their classifying types would be confusing.
  Using $\mkgroup$ we avoid awkward terminology such as `
  `the group of the integers is the circle''. 
  The symbol $\mkgroup$ is inspired by $\loops$
  in \cref{def:looptype}, which in \cref{sec:identity-type-as-abstract}
  will be used to recover the traditional concept of a group.
  Recall also the example of the negated natural numbers $\NNN$
  from \cref{sec:unary-sum-types}:
  Its elements are $-n$ for $n:\NN$ to remind us how to think about them.
  And the same applies to $\Group$:
  Its elements are $\mkgroup X$ for $X : \UUscone$
  to remind us how to think about them.
  }
  A \emph{group} is an element of $\typegroup$.
\end{definition}

\begin{definition}\label{def:classifying-type}
  We write $\B : \typegroup \to \UUscone$ for the
  destructor associated with $\Copy_{\mkgroup}(\UUscone)$.
  For $G : \typegroup$,
  we call $\BG$ the \emph{classifying type}\index{classifying type}
  of $G$.\footnote{%
    As a notational convention we always write the ``$\B$''
    so that it sits next to and matches the shape
    of its operand.
    You see immediately the typographical reason behind this convention:
    The italic letters $B$, $G$ get along nicely,
    while the roman $\B$ would clash with its italic friend $G$
    if we wrote $\B G$ instead.}
  Moreover, the elements of $\BG$ will be referred to as the \emph{shapes of $G$},
  and we define the \emph{designated shape of $G$}\index{designated shape}\index{shape}
  by setting
  $\shape_G\defequi \pt_{\BG}$,
  \ie the designated shape of $G$ is the base point of its
  classifying type, see \cref{def:pointedtypes}.
\end{definition}

\begin{definition}\label{def:looptype}
  Given a pointed type $X\jdeq(A,a)$, we define
  $\loops X \defeq (a \eqto_A a)$, \ie the type of the symmetries
  of $a:A$. %also called the \emph{symmetries in} $X$ / $G$ below?
  The type $\loops X$ is pointed at $\refl{a}$.%
  \index{loop type constructor}\index{symmetry type constructor}
  \glossary(924Omega){$\protect\loops X$}%
  {type of symmetries (loops) in pointed type, \cref{def:looptype}}
\end{definition}


\begin{definition}\label{def:group-symmetries}
  Let $G$ be a group.
  We regard every group as a group of symmetries,
  and thus we refer to the elements of $\loops \BG$ as the
  \emph{symmetries in $G$};\index{symmetries in a group $G$}
  they are the symmetries of the designated shape $\shape_G$ of $G$.
  We adopt the notation 
  \[
    \USymG \defeq \loops \BG
  \]
  for the type of symmetries in $G$; it is a set.\footnote{%
    Taking the symmetries in a group
    thus defines a map
    $\USym : \Group \to \Set$,
    with $\mkgroup X \mapsto \loops X$.
    Just as with ``$\B$'', we write the ``$\USym$'' so that it matches
    the shape of its operand.}
  (Notice the careful distinction above between the phrases
  ``\emph{symmetries in}'' and ``\emph{symmetries of}''.) 
\end{definition}

\begin{remark}\label{rem:aut}
  As noted in \cref{sec:unary-sum-types},
  the constructor and destructor pair forms an equivalence $\Group \weq \UUscone$.
  The type $\UUscone$ is a subtype of $\UUp$, so
  once you know that a pointed type $X$ is a connected groupoid,
  you also know that $X$ is the classifying type of a group,
  namely $G\defeq\mkgroup X$.

  Note that the equivalence also entails that identifications (of groups) of type $G \eqto H$ are equivalent to identifications (of pointed
  types) of type $\BG \eqto \BH$.
\end{remark}

\begin{remark}\label{rem:BG-convention}
  Defining a function $f : \prod_{G:\Group}T(G)$,
  where $T(G)$ is a type parametrized by $G:\Group$,
  amounts to defining $f(G)$ for $G\jdeq\mkgroup X$,
  where $X$ is a pointed connected groupoid,
  namely the classifying type $\BG$.\footnote{%
    If you are bothered by the convention
    to write the classifying type of $G$ in \emph{italic} like a variable,
    you can either think of $\BG$ as a locally defined
    variable denoting the classifying type that is
    defined whenever a variable $G$ of type $\Group$ is introduced,
    or you can imagine that whenever such a $G$ is introduced
    (with the goal of making a construction or proving a proposition),
    we silently apply the induction principle to
    reveal a wrapped variable $\BG:\UUscone$.}
\end{remark}

Frequently we want to consider the symmetries $\loops(A,a)$ of some element $a$ in some groupoid $A$, so we introduce the following definition.

\begin{definition}\label{def:automorphism-group}
  For a groupoid $A$ with a specified point $a$,
  we define the \emph{automorphism group} of $a:A$ by%
  \glossary(Aut){$\protect\Aut_A(a)$}{automorphism group of the element $a$
    in the type $A$, \cref{def:automorphism-group}}\index{automorphism group}%
  \index{group!of automorphisms}
  \[
    \Aut_A(a) \defeq \mkgroup (A_{(a)},(a,!)),
  \]
  \ie $\Aut_A(a)$ is the group with classifying type
  $\BAut_A(a) \jdeq (A_{(a)},(a,!))$,
  the connected component of $A$ containing $a$, pointed at $a$.
\end{definition}
\begin{remark}
  \label{rem:symmetriesofnonconnectedgroupoids}
  If $A$ is connected, then $\fst: A_{(a)} \to A$ is an equivalence 
  between the pointed types $(A_{(a)},(a,!))$ and $(A,a)$, pointed by $\refl{a}$.
  Consequently, for any $G \jdeq \mkgroup(A,a) : \Group$, 
  we have an identification of type $G \eqto \Aut_A(a)$.

  In other words, for any $G \jdeq \mkgroup\BG$, we have
  an identification $G \eqto \Aut_{\BG}(\shape_G)$, of $G$ with the automorphism
  group of the designated shape $\shape_G : \BG$.
\end{remark}

\subsection{First examples}
\label{sec:firstgroupexamples}
\begin{example}\label{ex:circlegroup}
  The circle $\Sc$, which we defined in \cref{def:circle},
  is a connected groupoid (\cref{lem:circleisconnected}, \cref{cor:S1groupoid})
  and is pointed at $\base$.
  The identity type $\base\eqto_\Sc\base$ is equivalent to 
  the set of integers $\zet$ and composition corresponds to addition.
  This justifies our definition of the \emph{group of integers} as%
  \glossary(ZZ){$\protect\ZZ$}{group of integers,
      \cref{ex:circlegroup}}\index{group!of integers}
  \[
    \ZZ \defeq \mkgroup(\Sc,\base).
  \]
  In other words, the classifying type of $\ZZ$ is $\B\ZZ \defeq \Sc$, 
  pointed at $\base$. 
  Recall from~\cref{rem:symmetriesofnonconnectedgroupoids} that there is 
  then a canonical identification of type $\ZZ \eqto \Aut_\Sc(\base)$.  
  It is noteworthy that along the way we gave several
  versions of the circle, each of which has its own merits.
  For example, the type of infinite cycles in \cref{def:S1toC}
  and \cref{thm:S1bysymmetries},
  \[
    \InfCyc\jdeq %\conncomp{\biggl(\sum_{X:\UU}(X\to X)\biggr)}{\zet,\zs}
    \sum_{X:\UU} \sum_{t:X\to X} \Trunc{(\zet,\zs)\eqto(X,t)}.\qedhere
  \]
\end{example}
\begin{xca}\label{xca:groups}
Use various results from \cref{cha:circle} to construct two different
identifications of type $\ZZ \eqto \Aut_\Cyc(\zet,\zs)$.
\end{xca}

\begin{example}\label{ex:groups}
  Apart from the circle, there are some important groups that come 
  almost for free: namely the automorphisms of specific elements
  in the groupoid $\Set$.
  \begin{enumerate}
  \item\label{ex:trivgroup}
  Recall that $\true$, and hence $\true \eqto \true$, is contractible.
  Hence $\Aut_{\Set}(\true)$ is a group called the 
  \emph{trivial group}. \index{trivial group}
  In fact, for any proposition $P$ we can also identify the trivial group 
  with $\Aut_{\Set}(P)$, see \cref{xca:group-example-details}. 
  Unlike $\Set$, the type $\true$ is connected,
  so we can also identify the trivial group with
  $\mkgroup (\true,\triv)$, or with $\mkgroup (C,c)$ for
  any contractible type $C$ and element $c:C$, or
  with $\Aut_{S}(x)$ for any set $S$ and element $x:S$.
 
  \item\label{ex:permgroup}
    If $n:\NN$, then the \emph{permutation group of $n$ letters}
    (also known as the \emph{symmetric group of order $n$}) is%
    \glossary(918Sigma2){$\protect\SG_n$}{symmetric group of order $n$,
      \cref{ex:groups}\ref{ex:permgroup}}\index{symmetric group}%
    \index{group!symmetric group}
    \[
      \SG_n\defequi \Aut_{\Set}(\bn n). %\mkgroup(\FinSet_n,\bn{n}),
    \]
    The classifying type is thus $\BSG_n\jdeq (\FinSet_n,\bn{n})$,   
    where $\FinSet_n \jdeq \Set_{(\bn{n})}$ is the groupoid of 
    sets of cardinality $n$ (\cf \ref{def:groupoidFin}).
    
    Again, we can also identify the group $\SG_n$ with
    $\Aut_\FinSet(\bn{n})$ (by \cref{xca:group-example-details}), with 
    $\Aut_{\FinSet_n}(\bn n)$ (by \cref{rem:symmetriesofnonconnectedgroupoids}),
    or even with $\Aut_{\UU}(\bn n)$ (by stretching the definition of $\Aut$,
    using that $\UU_{(\bn n)}$ is a connected groupoid, see~\cref{rem:autinfgp}).


    If the reader starts worrying about size issues,
    see~\cref{rem:groupsarebig}.\footnote{%
This footnote is for those who worry about size issues -- a
theme we usually ignore in our exposition. 
Recall from \MB{updated} \cref{sec:universes} the chain of
universes $\UU_0 : \UU_1 : \UU_2 : \dots$ such that for each $i$
all types in $\UU_i$ are also in $\UU_j$ for all $j>i$.
Let $\Set_0$ be the type of sets in $\UU_0$, 
\ie $\Set_0\defeq \sum_{S:\UU_0}\isset(S)$. Then $\true:\Set_0$ 
and $\Set_0 : \UU_1$ (because the sum is taken over $\UU_0$).
In order to accommodate the trivial group $\Aut_{\Set_0}(\true)$, 
the universe ``$\UU$'' appearing as a subscript of the first 
$\Sigma$-type in \cref{def:pt-conn-groupoid}, reappearing later in 
\cref{def:typegroup} of the type of groups,
needs to be at least as big as $\UU_1$. 
If $\UU$ is taken to be $\UU_1$, then the type $\typegroup$ of groups 
will not be in $\UU_1$, but in the bigger universe $\UU_2$.
\Cref{xca:typegroupisgroupoid} below asks you to verify that $\Group$
is a (large) groupoid. If we then choose some group $G:\typegroup$
and look at its group of automorphisms, $\Aut_\Group(G)$,
this will be an element of $\typegroup$ only if the universe $\UU$ in the
definition of $\typegroup$ is at least as big as $\UU_2$. Clearly, 
this doesn't stop and so we also need an ascending chain of types of groups:
  \[
    \typegroup_i \defequi \Copy_{\mkgroup}\bigl( (\UU_i)_*^{=1} \bigr) : \UU_{i+1}.
  \]
Any group we encounter will be an element of $\typegroup_i$ for $i$
large enough. As a matter of fact, the trivial group $\Aut_{\true}(\triv)$
is an element of $\typegroup_0$. The Replacement~\cref{pri:replacement}
often allows us to conclude that a group $G$ belongs to $\typegroup_0$.
This is the case for $\SG_S$, for $S:\Set_0$, and for $\Aut_\Group(G)$,
for $G:\Group_0$, as we invite the reader to check.
(Hint: use \cref{xca:comp-loc-small-ess-small}.)
However, even with this principle there are groups that only belong
to $\typegroup_i$ for $i>0$ large enough.

These matters concerning universes are nontrivial and important,
but in this text we have chosen to focus on other matters.
}

  \item\label{ex:genpermgroup}
    More generally, if $S$ is a set, is there a pointed connected groupoid $(A,a)$ so that $a\eqto_Aa$ models all the ``permutations'' $S\eqto_{\Set}S$ of $S$?
    Again, the only thing wrong with the groupoid $\Set$ of sets
    is that $\Set$ is not connected.
%}!\footnote{it's so simple -- so very simple -- that only a child can do it!}  %
    The \emph{group of permutations of $S$} is defined to be%
    \glossary(918Sigma3){$\protect\SG_S$}{permutation group on a set $S$,
      \cref{ex:groups}\ref{ex:genpermgroup}}\index{permutation group}%
    \index{group!permutation group}

    \[
      \SG_S\defequi \Aut_{\Set}(S),
    \]
    with classifying type $\BSG_S\jdeq(\conncomp \Set S,S)$.\qedhere
  \end{enumerate}
\end{example}

\begin{xca}
  \label{xca:group-example-details}
  Show that $\Aut_{\Set}(P)$ is a trivial group for any proposition $P$.
  Verify that $\SG_0$, $\SG_1$, and $\SG_\false$ are all trivial groups.
  Using~\cref{def:finiteset}, give identifications of type 
  $\Aut_\FinSet(\bn{n})\eqto\Sigma_{\bn{n}}$ for $n:\NN$.
  Also, give an identification of type $\Aut_\Set(\NN)\eqto\Aut_\Set(\zet)$. 
\end{xca}

\begin{remark}
  \label{rem:groupsarebig}
  This remark is for those who worry about size issues -- a theme we usually ignore in our exposition.  If we
  start with a base universe $\UU_0$, the groupoid $\FinSet_n$ of sets of cardinality $n$ is the $\Sigma$-type
  $\sum_{A:\UU_0}\Trunc{A\eqto\bn{n}}$ over $\UU_0$ and so (without any modification) will lie in any bigger
  universe $\UU_1$.  In order to accommodate the permutation groups of sets in $\UU_0$, the universe ``$\UU$'' appearing as
  a subscript of the first $\Sigma$-type in \cref{def:pt-conn-groupoid}, appearing later in the definition of
  ``group'', needs to be at least as big as $\UU_1$.  If $\UU$ is taken to be $\UU_1$, then the type
  $\typegroup$ of groups will not be in $\UU_1$, but in some bigger universe $\UU_2$.
  If we then choose some group $G:\typegroup$
  and look at its group of automorphisms, $\Aut_\Group(G)$,\footnote{%
    \Cref{xca:typegroupisgroupoid} below asks you to verify that $\Group$
    is a (large) groupoid.}
  based on the identity type $G \eqto_\Group G$, this will be an element of $\typegroup$ only if the universe $\UU$ in the definition of
  $\typegroup$ is at least as big as $\UU_2$.  Our convention from \cref{sec:universes} is
  that the universes form an ascending chain $\UU_0\subseteq\UU_1\subseteq\UU_2\subseteq\dots$, corresponding
  to which there will an ascending chain of types of groups,
  \[
    \typegroup_i \defequi \Copy_{\mkgroup}\bigl( (\UU_i)_*^{=1} \bigr) : \UU_{i+1},
  \]
  and any group we encounter will be an element of $\typegroup_i$ for $i$
  large enough.

  These matters concerning universes are nontrivial and important,
  but in this text we have chosen to focus on other matters.\footnote{%
    We will note, however, that the Replacement~\cref{pri:replacement}
    often allows us to conclude that a group $G$ belongs to $\typegroup_0$.
    This is the case for $\SG_S$, for $S:\Set_0$, and for $\Aut_\Group(G)$,
    for $G:\Group_0$, as we invite the reader to check.
    Hint: use \cref{xca:comp-loc-small-ess-small}.}
\end{remark}

\begin{example}\label{ex:cyclicgroups}
  In \cref{cor:id-m-cycle} we studied the symmetries of the 
  standard $m$-cycle $(\bn m,\zs)$ for $m$ a positive integer, 
  and showed that there were $m$ different such symmetries.
  Moreover, we showed that these symmetries can be identified with the elements
  $0,1,\dots,m-1$ of $\bn m$ (according to the image of $0$),
  and under this correspondence composition of symmetries correspond to
  addition modulo $m$, with $0$ the identity.
  Note that all of these can be obtained from $1$ under addition.
  With $\Cyc,\,\Cyc_m$ from \cref{def:Cyc}, \ref{def:Cyc-components},
  the \emph{cyclic group of order $m$} is thus defined to be
  \[
    \CG_m \defeq \Aut_\Cyc(\bn m,\zs),
  \]
  with classifying type $\BCG_m \jdeq (\Cyc_m, (\bn m,\zs))$.\footnote{%
    Note that the cyclic group of order $1$ is the trivial group,
    the cyclic group of order $2$ is equivalent to the symmetric group $\SG_2$:
    there is exactly one nontrivial symmetry $f$ and $f^2$ is the identity.
    When $m>2$ the cyclic group of order $m$ is a group that does not appear
    elsewhere in our current list.
    In particular, the cyclic group of order $m$ has only $m$ different
    symmetries, whereas we will see that the group of 
    permutations $\SG_m$ has $m!=1\cdot 2\cdot\dots\cdot m$ symmetries.}

  By using univalence on the equivalences of~\cref{thm:coveringsofS1perms}, we get a chain of identifications
  \[
    \begin{tikzcd}
      \CG_m \rar[eqtol] & \Aut_{\sum_{X:\Set}(X\to X)}(\bn m,\zs) \dar[eqtol] &
      \\
      & \Aut_{\SetBundle(\Sc)}(\Sc,\dg{m}) \rar[eqtol] & \Aut_{\Sc\to\Set}(R_m),
    \end{tikzcd}
  \]
  where $\dg{m} : \Sc \to \Sc$ is the degree $m$ map,
  and $R_m : \Sc \to \Set$ is the $m$\th power bundle from~\cref{def:RmtoS1}.

  For reasons that will become clear later (\cref{def:normalquotient}),
  we introduce another name for the cyclic group of order $m$, corresponding
  to the last step above, namely,
  \[
    \ZZ/m\ZZ \defeq \Aut_{\Sc\to\Set}(R_m).\qedhere
  \]
\end{example}

\begin{example}
\label{ex:Cm}
There are other (beside the symmetries of the $m$-cycle and of the $m$-fold \covering) ways of obtaining the cyclic group of order $m$, which occasionally are more convenient.
The prime other interpretation comes from thinking about the symmetries of the $m$-cycle in a slightly different way.
We can picture the $m$-cycle as consisting of $m$ points on a circle,
\eg as the set of $m$\th roots of unity in the complex plane, as shown in~\cref{fig:m-cycle-roots}.
\begin{marginfigure}
  \begin{tikzpicture}
    \foreach \n/\deg in {0/0, 1/35, 2/70, m-1/325} {
      \node[dot] (x\n) at (\deg:1) {};
      \node (l\n) [at=(x\n.\deg), anchor=\deg+180, shift=(\deg:1pt)] {$\xi^{\n}$};
      \draw[->,shorten <=1pt,shorten >=1pt] (x\n) arc (\deg:\deg+35:1);
    }
    \foreach \deg in {110, 115, 120, 275, 280, 285} {
      \node[cntdot] at (\deg:1) {};
    }
    \draw[shorten <=1pt,shorten >=1pt] (125:1) arc (125:270:1);
    \draw[->,shorten <=1pt,shorten >=1pt] (290:1) arc (290:325:1);
    \draw (180:1.2) -- (360:1.2);
    \draw[->] (1.6,0) -- (1.9,0);
    \node at (2.1,0) {$x$};
    \node at (0,1.7) {$y$};
    \draw[->] (270:1.2) -- (90:1.5);
  \end{tikzpicture}
  \caption{The $m$-cycle as the $m$\th roots of unity.
    (Here $\xi=\ee^{2\pi\ii/m}$ is a primitive $m$\th root.)}
  \label{fig:m-cycle-roots}
\end{marginfigure}
Any cyclic permutation is in particular a permutation 
of the $m$-element set underlying the cycle.
This manifests itself as the projection map 
$\prj : \Cyc_m \to \FinSet_m : ((X,t),!) \mapsto (X,!)$,\footnote{%
  In the terminology of \cref{sec:stuff-struct-prop},
  this map forgets the cycle structure on the underlying set.}
equivalently, using the notation introduced above, $\prj : \BCG_m \to \BSG_m$,
where the group $\SG_m=\Aut_\Set(\bn m)$ is that of
\emph{all} permutations of the set $\bn m$.
This projection map,
whose fiber at $X : \BSG_m$ can be identified with
the set $\sum_{t:X\to X}\Trunc{(X,t)\eqto(\bn m,\zs)}$,
captures $\CG_m$ as a ``subgroup'' of the permutations, 
namely the cyclic ones, corresponding to the fact that the 
shapes of $\CG_m$ (\ie the elements of $\BCG_m$)
are those of $\SG_m$ together with the extra structure of 
the ``cyclic ordering'' determined by $t$.

But how do we capture the other aspect of $\CG_m$,
mentioned in~\cref{ex:cyclicgroups},
that all the cyclic permutations can be obtained by a single generating one?
When thinking of the $m$\th roots of unity as in~\cref{fig:m-cycle-roots},
we can take complex multiplication by $\xi$ to be the generating symmetry.

The key insight is provided by the function $R_m:S^1\to\FinSet_m$ from~\cref{def:RmtoS1},
with $R_m(\base)\defequi\bn m$ and
$R_m(\Sloop)\defis \zs$, picking out exactly the cyclic permutation
$\zs:\bn m\eqto \bn m$ (and its iterates) among all permutations.
Using our new notation, we can also write this as
\[
  R_m : \B\ZZ \to \BSG_m.
\]
Set truncation (\cref{def:set-truncation}) provides us with a tool for capturing only the symmetries in $\FinSet_m$ hit by $R_m$:\marginnote{%
  $\begin{tikzcd}[column sep=tiny,ampersand replacement=\&]
  \& \B\ZZ\ar[dl]\ar[rr,equivr,"c"] \& \& \Cyc_0 \ar[dr] \& \\
  \BCG'_m \ar[rrrr,dashed,"g"']\ar[drr,"\prj"'] \& \& \& \&  \BCG_m\ar[dll,"\prj"] \\
  \& \& \BSG_m\ar[from=uul,"R_m" near start,crossing over]
  \ar[from=uur,"{\blank/m}"' near start,crossing over]\& \&
  \end{tikzcd}$}
the (in language to come) subgroup of the permutation group generated by the cyclic permutation $\zs$ is the group
\[
  \CG'_m\defequi\mkgroup(\BCG'_m,\sh_{\CG'_m}),
\]
where $\BCG'_m\defequi \sum_{X:\FinSet_m}\Trunc{\inv{R_m}(X)}_0$
and $\sh_{\CG'_m}\defequi (\bn m,\trunc{(\base,\refl{\bn m})}_0)$.
That is, $\BCG'_m$ is the $0$-image of $R_m$ in the sense 
of~\cref{sec:higher-images},
and is in particular a pointed connected groupoid.
Since we have a factorization of $R_m$ as the equivalence $c:\Sc\equivto\Cyc_0$
followed by the map $\blank/m:\Cyc_0 \to \BSG_m$,
and since $\Cyc_m$ is the $0$-image of the latter by~\cref{thm:image-Z-to-Cm},
we get a uniquely induced pointed equivalence $g : \BCG'_m \ptdweto \BCG_m$.\footnote{%
  More precisely, but using language not yet established: $\CG_m$ is both isomorphic to $\ZZ/m\ZZ$, the ``quotient group'' (\cf \cref{def:normalquotient}) of $\ZZ$ by the ``kernel'' (\cf \cref{def:kernel}) induced by $R_m$, and to $\CG'_m$, which is the corresponding ``image'' (\cf \cref{sec:image}). This pattern will later be captured in~\cref{thm:fund-thm-homs}.}
This identifies the set $\Trunc{\inv{R_m}(X)}_0$ with the set of 
cycle structures on the $m$-element set $X$.
\end{example}

\begin{xca}\label{xca:CG2isSG2}
Show that the set truncation of $\inv R_2(\bn 2)$ is contractible.
This reflects that $\CG_2$ and $\SG_2$ can be identified.
Even more so, show that $\CG_2\eqto_\typegroup\SG_2$ is contractible.
\end{xca}
\begin{xca}\label{xca:RmloopCGm}
Elaborate the symmetries of
$\sh_{\CG'_m}\jdeq (\bn m,\trunc{(\base,\refl{\bn m})}_0)$
in $\BCG'_m$ and show that they are indeed the permutations of $\bn m$
than can be generated by $R_m(\Sloop)$, that is, by $s$. 
\end{xca}

\begin{example}\label{ex:productofgroups}
  If you have two groups $G$ and $H$,
  their \emph{product} $G\times H$ is given by taking
  the product of their classifying types:\footnote{%
    Note that $\B(G\times H)\jdeq \BG\times \BH$ is pointed at
  $\shape_{G\times H}\jdeq(\shape_G,\shape_H)$.}
  \[
    G\times H\defequi \mkgroup(\BG\times\BH)
  \]
  For instance, $\SG_2\times\SG_2$ is called the
  \emph{Klein four-group}\index{Klein four-group} or \emph{Vierergruppe}\index{Vierergruppe}, because
  it has four symmetries.
\end{example}

\begin{xca}\label{xca:klein-not-cyclic}
  Show that we cannot identify $\CG_4$ and $\SG_2\times\SG_2$,
  \ie the Klein four-group is not a cyclic group.
\end{xca}
\begin{remark}
In \cref{lem:idtypesgiveabstractgroups} we will see that the identity type
of a group satisfies a list of laws justifying the name ``group'' and
we will later show in \cref{lem:Groupsareidentitytypes} that groups
are uniquely characterized by these laws.
\end{remark}
Some groups have the property that the order you compose the 
symmetries is immaterial.  The prime example is the group of 
integers $\ZZ\jdeq\mkgroup(\Sc,\base)$.
Any symmetry is of the form $\Sloop^n$ for some integer $n$, 
and if $\Sloop^m$ is also a symmetry, 
then $\Sloop^n\Sloop^m=\Sloop^{n+m}=\Sloop^{m+n}=\Sloop^m\Sloop^n$.

 Such cases are important enough to have their own name:
\begin{definition}\label{def:abgp}
  A group $G$ is \emph{abelian} if all symmetries commute, in the sense that
  the proposition
  \[
    \isAb(G)\defequi\prod_{g,h: \USymG}gh=hg
  \]
  is true.  In other words, the type of abelian groups is
  \[
    \AbGroup \defequi \sum_{G:\typegroup}\isAb(G).\qedhere
  \]
\end{definition}
\begin{xca}\label{exer:first examples}
  Show that symmetric group $\SG_2$ is abelian, but that $\SG_3$ is not.
  Show that if $G$ and $H$ are abelian groups, then so is their product $G\times H$.
\end{xca}
We can visualize symmetries $g$ and $h$ commuting with each
other in a group $A \jdeq\mkgroup(A,a)$ by the picture\marginnote{%
  \begin{tikzcd}[ampersand replacement=\&]
    a \ar[r,eqr,"g"]\ar[d,eql,"h"'] \& a\ar[d,eqr,"h"] \\
    a \ar[r,eql,"g"'] \& a
  \end{tikzcd}}
in the margin;
going from (upper left hand corner) $a$ to (lower right hand corner) 
$a$ by either composition gives the same result.

\begin{remark}
  \label{rem:whatAREabeliangroups}

  Abelian groups have the amazing property that the classifying types are themselves identity types (of certain $2$-types).
  This can be used to give a very important characterization of what it means to be abelian.
  We will return to this point in \cref{sec:abelian-groups}.

  Alternatively, the reference to $\isAb$ in the definition of abelian groups is avoidable using the ``one point union'' of pointed types $X\vee Y$ of \cref{def:wedge} below. (It is the sum of $X$ and $Y$ where the base points are identified.). \cref{xca:whatAREabeliangroups}
  \marginnote{%
    \begin{tikzcd}[ampersand replacement=\&]
      \BG\vee\BG\ar[r,"\text{fold}"]\ar[d,"\text{inclusion}"'] \& \BG \\
       \BG\times\BG\ar[ur,dashed]
    \end{tikzcd}}
offers the alternative definition that a group $G$ is abelian if and only if
the ``fold'' map $\BG\vee \BG\ptdto \BG$ (where both summands are mapped by
the identity) factors through the inclusion $\BG\vee\BG\ptdto\BG\times\BG$
(where $\inl{x}$ is mapped to $(x,\sh_G)$ and $\inr{x}$ to $(\sh_G,x)$).
The latter turns out to be a proposition equivalent to $\isAb(G)$.
\end{remark}

\begin{xca}
  Let $\mkgroup(A,a):\typegroup$ and let $b$ be an arbitrary element of $A$.
  Prove that the groups $\mkgroup(A,a)$ and $\mkgroup(A,b)$ are 
  merely identical, in the sense that the proposition
  $\Trunc{\mkgroup(A,a)\eqto\mkgroup(A,b)}$ is true.
  Similarly for \inftygps in \cref{sec:inftygps} when you get that far.
\end{xca}

  \begin{xca}\label{xca:typegroupisgroupoid}
    Given two groups $G$ and $H$.  Prove that $G\eqto H$ is a set.
    Prove that the type of groups is a groupoid.
    This means that, given a group $G$, the component of $\typegroup$,
    containing (and pointed at) $G$, is again a group, $\Aut_\Group(G)$,
    which we will call more simply the \emph{group $\Aut(G)$ of automorphisms}%
    \index{group!of automorphisms} of $G$,
    or the \emph{automorphism group}\index{automorphism group} of $G$.
  \end{xca}

\section{Abstract groups}
\label{sec:identity-type-as-abstract}

Studying the identity type leads one to the definition of what an 
abstract group should be. We fix a type $A$ and an element $a:A$ for the rest
of the section, and we focus on the identity type $a\eqto a$.
We make the following observations about its elements and operations on them.

\begin{enumerate}
\item
  There is an element $\refl a : a \eqto a$.
  (See page \pageref{rules-for-equality}, item \ref{E2}.)
  We set $e \defeq \refl a$ as notation for the time being.
\item
  For $g : a \eqto a$, the inverse $g^{-1} : a \eqto a$ was defined in \cref{def:eq-symm}.
  Because it was defined by path induction, this inverse operation satisfies $e^{-1} \jdeq e$.
\item
  For $g, h : a \eqto a$, the product $h \cdot g : a \eqto a$ was defined in \cref{def:eq-trans}.
  Because it was defined by path induction, this product operation satisfies $e \cdot g \jdeq g$.
\end{enumerate}

For any elements $g,g_1,g_2,g_3:a\eqto a$, we consider the 
following four identity types:
\begin{enumerate}
\item
  \label{it:right-unit} \emph{the right unit law:} $g \eqto g\cdot e$,
\item
  \label{it:left-unit} \emph{the left unit law:} $g \eqto e\cdot g$,
\item
  \label{it:associativity} \emph{the associativity law:} $g_1\cdot(g_2\cdot g_3)
  \eqto (g_1\cdot g_2)\cdot g_3$,
\item
  \label{it:inverse} \emph{the law of inverses:} $g\cdot \inv g \eqto e$.
\end{enumerate}

In \cref{xca:path-groupoid-laws}, the reader has constructed explicit
elements of these identity types. 
If $a\eqto a$ is a set, then the identity types
above are all propositions. Then, in line with the convention adopted 
in \cref{sec:props-sets-grpds}, we could simply say that
\cref{xca:path-groupoid-laws} establishes that the equations hold.
That motivates the following definition, 
in which we introduce a new set $S$ to play the role of $a\eqto a$.
We introduce a new element $e:S$ to play the role of $\refl a$, 
a new multiplication operation, and a new inverse operation. 
The original type $A$ and its element $a$ play no further role.\footnote{%
In \cref{sec:inftygps} we will come back to $A$ and $a$ and
consider the case in which $A$ is an arbitrary connected type
and $a:A$. Then $a\eqto a$ need not be a set.}

\begin{definition}\label{def:abstractgroup}
  An \emph{abstract group}\index{abstract group}\index{group!abstract}
  consists of the following data.
  \begin{enumerate}
  \item\label{struc:under-set} A set $S$, called the \emph{underlying set}.
  \item\label{struc:unit} An element $e:S$, called the \emph{unit} or the \emph{neutral element}.\index{neutral element}
  \item\label{struc:mult-op} A function $S\to S\to S$, called \emph{multiplication},
    taking two elements $g_1,g_2:S$ to their \emph{product}, denoted by $g_1\cdot g_2:S$.
    \par \noindent
    Moreover, the following equations should hold, for all $g,g_1,g_2,g_3 : S$.
    \begin{enumerate}[label=(\alph*),ref=\ref{struc:mult-op} (\alph*)]
    \item\label{axiom:unit-laws} $g\cdot e=g$ and $e\cdot g=g$ (the \emph{unit laws})
    \item\label{axiom:ass-law} $g_1\cdot(g_2\cdot g_3)=(g_1\cdot g_2)\cdot g_3$ (the \emph{associativity law})
    \end{enumerate}
  \item\label{struc:inv-op} A function $S\to S$, the \emph{inverse operation},
    taking an element $g:S$ to its \emph{inverse} $g^{-1}$.
    \par \noindent
    Moreover, the following equation should hold, for all $g:S$.
    \begin{enumerate}[label=(\alph*),ref=\ref{struc:inv-op} (\alph*),resume*]
    \item\label{axiom:inv-law} $ g\cdot g^{-1} = e$ (the \emph{law of inverses})
    \qedhere
    \end{enumerate}
  \end{enumerate}
\end{definition}

\begin{remark}
  Strictly speaking, the proofs of the various equations are part of the data defining an abstract group, too.  But, since the equations are
  propositions, the proofs are unique, and by the convention introduced in \cref{rem:subtype-convention}, we can afford to omit them, when no confusion can occur.  Moreover, one need not worry whether one gets a different group if the equations are given different proofs, because proofs of
  propositions are unique.
\end{remark}

\begin{remark}\label{rem:monoids}
  A \emph{monoid}\index{monoid} is a collection of data consisting only of \ref{struc:under-set}, \ref{struc:unit}, and \ref{struc:mult-op} from the list in
  \cref{def:abstractgroup}.  In other words, the existence of inverses is not assumed.  For this reason, the property that $S$ is a set, the
  unit laws, and the associativity law are, together, known as the \emph{monoid laws}.
\end{remark}

Taking into account the introductory comments we have made above, we may state the following lemma.

\begin{lemma}\label{lem:idtypesgiveabstractgroups}
  If $G$ is a group, then the set $\USymG \jdeq (\sh_G\eqto\sh_G)$
  of symmetries in $G$ (see \cref{def:group-symmetries}),
  together with $e\defequi\refl{\shape_G}{}$,
  $g^{-1}\defequi\symm_{\shape_G,\shape_G}g$
  and $h \cdot g \defequi \trans_{\shape_G,\shape_G,\shape_G}(g)(h)$, define an abstract group.
  We will let $\abstr(G)$ denote that abstract group.
\end{lemma}

\begin{proof}
  The type $\USymG$ is a set, because $\BG$ is a groupoid.
  \cref{xca:path-groupoid-laws} shows that all the relevant equations hold, as required.
\end{proof}

\begin{definition}\label{def:abstrG}
  Given a group $G$, the abstract group of~\cref{lem:idtypesgiveabstractgroups},
  $\abstr(G)$, is called the \emph{abstract group associated to $G$}.
\end{definition}

\begin{remark}\label{rem:inverses-as-property}
  Instead of including the inverse operation as part
  \ref{struc:inv-op} of the structure (including with the property
  \ref{axiom:inv-law}), some authors assume the existence of inverses
  by positing the following property.
  \begin{enumerate}[start=5]
    \item\label{axiom:mere-inverse} for all $g:S$ there exists an element
    $h:S$ such that $e = g \cdot h$.
  \end{enumerate}

  We will now compare \ref{axiom:mere-inverse} to \ref{struc:inv-op}.
  Property \ref{axiom:mere-inverse} contains the phrase ``there exists'', and thus its translation into type theory
  uses the quantifier $\exists$, as defined in \cref{sec:prop-trunc}.  Under this translation, property \ref{axiom:mere-inverse} does
  not immediately allow us to speak of ``the inverse of $g$''.
  However, the following lemma shows that we can define an inverse operation as in \ref{struc:inv-op} from a witness of \ref{axiom:mere-inverse}
  -- its proof goes by using the properties \ref{axiom:unit-laws} and \ref{axiom:ass-law} to prove that inverses are unique.  As a consequence,
  we \emph{can} speak ``the inverse of $g$''.
\end{remark}

\begin{lemma}%
  \label{lem:group-inv-operation}%
  Given a set $S$ together with $e$ and $\cdot$ as in
  \cref{def:abstractgroup} satisfying the unit laws, the associativity
  law, and property \ref{axiom:mere-inverse}, there is an ``inverse'' function
  $S \to S$ having property \ref{axiom:inv-law} of \cref{def:abstractgroup}.
\end{lemma}

\begin{proof}
  Consider the function $\mu: S \to (S \to S)$ defined as
  $g\mapsto (h \mapsto g\cdot h)$. Let $g:S$. We claim that the fiber
  $\inv{\mu(g)}(e)$ is contractible.  Contractibility is a proposition, hence to
  prove it from \ref{axiom:mere-inverse}, one can as well assume the
  actual existence of $h$ such that $g\cdot h = e$. Then $(h,!)$ is an
  element of the fiber $\inv{\mu(g)}(e)$. We will now prove that it is
  a center of contraction. For any other element $(h',!)$, we want to
  prove $(h,!) = (h',!)$, which is equivalent to the equation $h=h'$. In
  order to prove the latter, we show that $h$ is also an inverse on
  the left of $g$, meaning that $h\cdot g=e$.  This equation is also a
  proposition, so we can assume from \ref{axiom:mere-inverse} that we have an
  element $k:S$ such that $h\cdot k = e$.  Multiplying that equation by
  $g$ on the left, one obtains
  \begin{displaymath}
    k = e \cdot k = (g\cdot h)\cdot k = g\cdot (h\cdot k) = g\cdot e = g,
  \end{displaymath}
  from which we see that $h\cdot g=e$.
  Now it follows that
  \begin{displaymath}
    h = h \cdot e = h \cdot (g\cdot h') = (h \cdot g) \cdot h' = e \cdot h' = h',
  \end{displaymath}
  as required. Hence $\inv{\mu(g)}(e)$ is contractible, and we may define $g^{-1}$ to
  be the center of the contraction, for any $g:S$.
  The function $g \mapsto g^{-1}$ satisfies the law of inverses \ref{axiom:inv-law}, as required.
\end{proof}

%Note that the proof above also shows the other \emph{law of inverses}:
%for all $g:S$ we have $g^{-1}\cdot g=e$. In exercise below.

\begin{remark}
  \label{rem:typemonoidabstrgp}
  We may encode the type of abstract groups as follows. 
  We let $S$ denote the underlying set, $e : S$ denote the unit, 
  $\mu:S\to S\to S$ denote the multiplication operation 
  $g\mapsto (h \mapsto g\cdot h)$, and $\iota : S \to S$ denote 
  the inverse operation $g \mapsto g^{-1}$.  Using
  that notation, we introduce names for the relevant propositions.
  \begin{align*}
    \mathrm{UnitLaws}(S,e,\mu)   & \defequi\prod_{g:S} (\mu{}(g)(e) = g)\times(\mu{}(e)(g) = g) \\
    \mathrm{AssocLaw}(S,\mu{})   & \defequi\prod_{g_1,g_2,g_3:S} \mu{}(g_1)(\mu{}(g_2)(g_3))=\mu{}(\mu{}(g_1)(g_2))(g_3) \\
    \mathrm{MonoidLaws}(S,e,\mu) & \defequi \isset{(S)} \times \mathrm{UnitLaws}(S,e,\mu) \times \mathrm{AssocLaw}(S,\mu{}) \\
    \mathrm{InverseLaw}(S,e,\mu,\iota) & \defequi \prod_{g:S}(\mu(g)(\iota(g)) = e) \\
    \mathrm{GroupLaws}(S,e,\mu,\iota) & \defequi \mathrm{MonoidLaws}(S,e,\mu) \times \mathrm{InverseLaw}(S,e,\mu,\iota)
  \end{align*}
  Now we define the type of abstract groups in terms of those propositions.
  \[
    \typegroup^\abstr \defequi \sum_{S:\UU} \sum_{e:S}\sum_{\mu{}:S\to S\to S}
    \sum_{\iota\colon S\to S} \mathrm{GroupLaws}(S,e,\mu,\iota)
  \]

  Thus, following the convention introduced in \cref{rem:iterated-sums},
  an abstract group $\mathscr G$ will be a quintuple of the form
  $\mathscr G \jdeq (S,e,\mu,\iota,!)$.  For brevity, we will usually 
  omit the proof of the properties from the display, since it's unique,
  and write an abstract group as though it were a quadruple 
  $\mathscr G \jdeq (S,e,\mu,\iota)$.
\end{remark}

\begin{remark}
  That the concept of an abstract group synthesizes the idea of symmetries
  will be justified in \cref{sec:Gsetforabstract} where we prove that
  the function $\abstr:\typegroup\to\typegroup^\abstr$ from 
  \cref{def:abstrG} is an equivalence.
\end{remark}

\begin{remark}
  If $\mathcal G\jdeq (S,e,\mu,\iota)$ and $\mathcal G'\jdeq(S',e',\mu',\iota')$
  are abstract groups, an element of the identity type
  $\mathcal G\eqto\mathcal G'$ consists of quite a lot of information,
  provided we interpret it by repeated application of \cref{lem:isEq-pair=}.
  First and foremost, we need an identification $p:S\eqto S'$ of sets, but
  from there on the information is a proof of a conjunction of propositions.\footnote{%
    Even though we are able to give a concise definition of \inftygps 
    in \cref{sec:inftygps}, we don't know how to define
    the type of ``abstract \inftygps'' in a way similar
    to~\cref{def:abstractgroup}:
    such a definition would require infinitely many 
    levels of operations producing
    identifications of instances of operations of lower levels.
    And an identification would similarly require infinitely
    many operations identifying the operations at all levels.
    See also \cref{rem:ee=e_coherence}.}
  An analysis shows that this conjunction can be shortened to the equations $e'=p(e)$ and
  $\mu'(p(s),p(t))=p(\mu(s,t))$.  A convenient way of obtaining an identity $p$ that preserves these equations is to apply univalence to an
  equivalence $f: S \equivto S'$ that preserves them.
  We call such a function $f$ an \emph{isomorphism of abstract groups}.%
  \index{isomorphism!of abstract groups}
\end{remark}

\begin{xca}
  Perform the mentioned analysis.
\end{xca}

\begin{xca}
  \label{xca:op-abs-group}
  Let $\mathcal G \jdeq (S,e,\mu,\iota)$ be an abstract group.
  Define another structure $\mathcal G\op \defeq (S,e,\mu\op,\iota)$,
  where $\mu\op : S \to S \to S$ sends $a,b:S$ to $\mu(b,a)$,
  \ie $\mu\op$ swaps the order of the arguments as compared to $\mu$.

  Show that $\iota : S \to S$ defines an isomorphism 
  $\mathcal G \equivto \mathcal G\op$.\footnote{%
  Hint: in down-to-earth terms this boils down to the equations
  $\inv e = e$ and $(a\cdot b)^{-1} = b^{-1}\cdot a^{-1}$.}
\end{xca}

\begin{xca}
  \label{xca:conj}
  Let $\mathcal G\jdeq(S,e,\mu,\iota)$ be an abstract group and let $g:S$.  If $s:S$, let $\conj^g(s)\defequi g\cdot s\cdot g^{-1}$.  Show that the resulting function $\conj^g:S\to S$ preserves the group structure (for instance $g\cdot(s\cdot s')\cdot g^{-1}=(g\cdot s\cdot g^{-1} )\cdot(g\cdot s\cdot g^{-1})$) and is an equivalence.  The resulting identification $\conj^g:\mathcal G\eqto\mathcal G$ is called \emph{conjugation} by $g$.\index{conjugation}
\end{xca}

\begin{remark}\label{rem:ee=e_coherence}
  Without the demand that the underlying type of an abstract group or monoid is a set, life would be more complicated.  For instance, for the
  case when $g$ is $e$, the unit laws \ref{axiom:unit-laws} of \cref{def:abstractgroup} would provide \emph{two} (potentially different)
  identifications $e\cdot e \eqto e$, and we would have to separately assume that they agree.  This problem vanishes in the setup we adopt for
  \inftygps in \cref{sec:inftygps}.
\end{remark}

\begin{xca}
  For an element $g$ in an abstract group,
  prove that $e=\inv g\cdot g$ and $g=(g^{-1})^{-1}$. 
  (Hint: study the proof of \cref{lem:group-inv-operation}.)
  In other words (for the
  machines among us), given an abstract group $(S,e,\mu,\iota)$,
  give an element in the proposition
  \begin{displaymath}
    \prod_{g:S} (e=\mu(\iota(g))(g))\times
    (g=\iota(\iota(g))).\qedhere
  \end{displaymath}
\end{xca}

\begin{xca}\label{xca:typemonoidisgroupoid}
  Prove that the types of monoids and abstract groups are groupoids.
\end{xca}

\begin{xca}
  \label{xca:cheapgroup}
  There is a leaner way of characterizing what an abstract group is:
  define a \emph{sheargroup} to be a set $S$ together with an element $e:S$,
  a function $\blank * \blank: S\to S\to S$, sending $a,b:S$ to $a*b:S$,
  and the following propositions,
  where we use the shorthand $\bar a\defequi a*e$:
  \begin{enumerate}
  \item $e*a=a$,
  \item $a*a=e$, and
  \item $c*(b*a)=\casoverline{(c*\bar b)}*a$,
  \end{enumerate}
  for all $a,b,c:S$.
  Construct an equivalence from the type of abstract groups to the type of sheargroups.\footnote{%
      Hint: setting $a\cdot b\defequi \bar b*a$ gives you an abstract group from a sheargroup and conversely, letting $a*b=b\cdot a^{-1}$ takes you back.  On your way you may need at some point to show that $\casoverline{\bar a}=a$: setting $c=\bar a$ and $b=a$ in the third formula will do the trick (after you have established that $\bar e=e$).  This exercise may be good to look back to in the many instances where the inverse inserted when ``multiplying from the right by $a$'' is forced by transport considerations.}
\end{xca}
\begin{xca}
  Another and even leaner way to define abstract groups, highlighting how we can do away with both the inverse and the unit: a \emph{Furstenberg group}\footnote{%
    Named after Hillel Furstenberg who at the age of 20 published a paper doing this exercise.\footnotemark{}}\footcitetext{Furstenberg}
  is a nonempty set $S$ together with a function
  $\blank\circ\blank : S \to S \to S$, sending $a,b:S$ to $a\circ b:S$,
  with the property that
  \begin{enumerate}
  \item for all $a,b,c:S$ we have that $(a\circ c)\circ(b\circ c)=a\circ b$, and
  \item for all $a,c:S$ there is a $b:S$ such that $a\circ b=c$.
  \end{enumerate}
  Construct an equivalence from the type of Furstenberg groups to the type of
  abstract groups.\footnote{%
    Hint: show that the function $a\mapsto a\circ a$ is constant, with value, say, $e$.  Then show that $S$ together with the ``unit'' $e$, ``multiplication'' $a\cdot b\defequi a\circ(e\circ b)$ and ``inverse'' $b^{-1}\defequi e\circ b$ is an abstract group.}
\end{xca}

\section{Homomorphisms}
\label{sec:homomorphisms}

\begin{remark}\label{rem:homom-eqs}
Let $G$ and $H$ be groups, and suppose we have a pointed function $k : \BG \ptdto \BH$.
Suppose also, for simplicity (and without loss of generality),
that $\pt_\BH \jdeq k ( \pt_\BG ) $ and $k_\pt \jdeq \refl{\pt_\BH}$.
Applying \cref{def:ap} yields a function $f \defeq \ap k : \USymG \to \USymH$, which satisfies the following identities:
\begin{alignat*}2
  f ( \refl {\pt_\BG} ) & = \refl{\pt_\BH},  &\qquad&                            \\
  f (g ^ {-1})     & = (f (g))^{-1}         && \text {for any $g : \USymG$},    \\
  f (g' \cdot g)   & =  f (g') \cdot  f (g) && \text {for any $g, g' : \USymG$}.
\end{alignat*}
The first one is true by definition, the others follow from~\cref{lem:apcomp}.
These three identities assert that the function $\ap k$ \emph{preserves}, in a certain sense, the operations provided by \cref{lem:idtypesgiveabstractgroups} that
make up the abstract groups $\abstr(G)$ and $\abstr(H)$.
In the traditional study of abstract groups, these three identities play an important role and entitle one to call the function $f$ a
\emph{homomorphism of abstract groups}.\index{homomorphism}
\end{remark}

A slight generalization of the discussion above will be to suppose that we have a general pointed map with an arbitrary pointing path
$k_\pt : \pt_\BH \eqto k ( \pt_\BG ) $,
not necessarily given by reflexivity.  Indeed, that works out, thereby motivating the following definition.

\begin{definition}\label{def:grouphomomorphism}
  The type of \emph{group homomorphisms}\index{homomorphism!of groups}
  from $G:\typegroup$ to
  $H:\typegroup$ is defined to be\marginnote{%
    When it is clear from context that a homomorphism is intended,
    we may write $f : G \to H$.}
  \[
    \Hom(G,H)\defequi\Copy_{\mkgroup}(\BG\ptdto\BH),
  \]
  \ie it is a wrapped copy of the type of pointed maps of classifying spaces
  with constructor
  $\mkhom : (\BG \ptdto \BH) \to \Hom(G,H)$.%
  \glossary(924Omega__){$\protect\mkhom$}{homomorphism constructor, \cref{def:grouphomomorphism}}
  We again write $\B : \Hom(G,H) \to (\BG \ptdto \BH)$ for the destructor,
  and we call $\Bf$ the \emph{classifying map}\index{classifying map}
  of the homomorphism $f$.
\end{definition}

We would like to understand explicitly the effect of a general homomorphism $f$ from $G$ to $H$
on the underlying symmetries $\USymG$, $\USymH$,
again without assuming that pointing path of $\Bf$ is given by
reflexivity.
So we should first study how pointed maps affect loops:\marginnote{%
    \noindent\normalsize\begin{tikzpicture}
      \node (Y) at (0,-1.5) {$Y$};
      \draw (0,-1)
      .. controls ++(170:-1) and ++(180:1) .. (2,-1.5)
      .. controls ++(180:-1) and ++(270:1.5) .. (3.5,0.8)
      .. controls ++(270:-1.5) and ++(80:1.4)  .. (-1,1)
      .. controls ++(80:-1.4)  and ++(170:1) .. (0,-1);
      \node[dot,label=left:$\pt_Y$] (a) at (0,0) {};
      \node[dot,label=below:$k(\pt_X)$] (b) at (1.5,-.5) {};
      \node (ct) at (2.6,1.1) {$\ap{k_\div}(p)$};
      \draw[->] (a) .. controls ++(-20:1) and ++(170:1) .. node[auto,swap] {$k_\pt$} (b);
      \draw[->] (b) .. controls ++(20:1) and ++(-40:1) ..
      (2,1) .. controls ++(-40:-1) and ++(-80:-1) .. (b);
    \end{tikzpicture}}

\begin{definition}\label{def:loops-map}
  Given pointed types $X$ and $Y$ and a pointed function $k : X\ptdto Y$ (as defined in \cref{def:pointedtypes}),
  we define a function $\loops k : \loops X \to \loops Y$ by setting\footnote{%
    Recall~\cref{def:ap} for $\ap{}$, and that we may abbreviate
    $\ap{f}(p)$ by $f(p)$. Note also that $\loops k$ is pointed: 
    we can identify $\loops k(\refl{\pt_X})$ with $\refl{\pt_Y}$.}
  \[
    \loops k(p) \defeq k_\pt^{-1} \cdot \ap{k_\div}(p) \cdot k_\pt
    \text{,\quad for all $p: \pt_X \eqto \pt_X$.}\qedhere
  \]
  \glossary(924Omega){$\protect\loops k$}%
  {loop map of pointed map, \cref{def:loops-map}}
\end{definition}

\begin{remark}\label{rem:loops-map}
  If $k : X \ptdto Y$ has the reflexivity path $\refl{Y_\pt}$ as its
  pointing path, then we have an identification $\loops k \eqto \ap{k_\div}$.
\end{remark}

\begin{definition}\label{def:USym-hom}
  Given groups $G$ and $H$ and a homomorphism  $f$ from $G$ to $H$, 
  we define the function $\USymf : \USymG \to \USymH$
  by setting $\USymf \defeq \loops \Bf$.
  In other words, the homomorphism $\mkhom\Bf$
  induces $\loops\Bf$ as the map on underlying symmetries.
\end{definition}

\begin{lemma}\label{lem:grouphomomaxioms}
  Given groups $G$ and $H$ and a homomorphism $f : \Hom(G,H)$, the function $\USymf : \USymG \to \USymH$ defined above satisfies
  the following identities:
  \begin{alignat}2
    \label{gp-homo-unit} (\USymf) ( \refl {\pt_{\BG}} )
    &= \refl{\pt_{\BH}},   &\qquad&                                        \\
    \label{gp-homo-comp} (\USymf) (g ^ {-1})
    &= ((\USymf) (g))^{-1}                   && \text{for any $g : \USymG$,} \\
    \label{gp-homo-inv}  (\USymf) (g' \cdot g)
    &=  (\USymf) (g') \cdot  (\USymf) (g) && \text{for any $g, g' : \USymG$.}
  \end{alignat}
\end{lemma}

\begin{proof}
  We write $f \jdeq (f_\div,p)$, where $p : \pt_{\BH} \eqto f_\div (\pt_{\BG})$.
  By induction on $p$, which is allowed since $\pt_{\BH}$ is arbitrary,
  we reduce to the case where $\pt_{\BH} \jdeq f_\div (\pt_{\BG})$
  and $p\jdeq \refl{\pt_{\BH}}$.
  We finish by applying \cref{rem:homom-eqs} and \ref{rem:loops-map}.
\end{proof}

\begin{definition}\label{def:groupisomorphism}
  A homomorphism $f : G\to H$ is an \emph{isomorphism}\index{isomorphism!of groups} if its classifying map $\Bf$ is an equivalence.
  We let $\Iso(G,H)$ be the subset of isomorphisms in $\Hom(G, H)$.
\end{definition}

\begin{definition}\label{def:identity-group-homomorphism}
  If $G$ is a group, then we use \cref{def:pointedidentity} to define the \emph{identity homomorphism} $\id_G : G\to G$ by
  setting $\id_G \defeq \mkhom (\id_\BG)$.  The
  identity homomorphism is an isomorphism.
\end{definition}

\begin{remark}
  \label{remark:groupsasunivalenttype} From~\cref{xca:pointedequiv},
  we have an equivalence
  \[
    (G\eqto_\typegroup H)\equivto \Iso(G,H)
  \]
  between the identity type of the groups $G$ and $H$ and the 
  set of isomorphisms. We use the convention introduced in
  \cref{rem:univalence-transparent} also here. That is,
  we allow ourselves to also write $p : \Iso(G,H)$ for the isomorphism
  corresponding to an identification $p:G\eqto H$,
  and $\Bp : \BG \ptdweto \BH$ for the corresponding pointed equivalence
  of classifying types. Conversely, given an isomorphism
  $f : \Iso(G,H)$, we may denote the corresponding path
  also as $f:G\eqto H$.
\end{remark}


\begin{definition}\label{def:group-homomorphism-composition}
  If $G$, $G'$, and $G''$ are groups, and $f : G\to G'$ and $f' : G'\to G''$ are homomorphisms, then we use
  the definition of composition of pointed functions in \cref{def:pointedtypes} to define the \emph{composite homomorphism}\index{composition!of group homomorphisms}
  $f' \circ f : G \to G''$ by setting $f' \circ f \defeq \mkhom (\Bf' \circ \Bf)$.
\end{definition}

Recall from \cref{sec:pointedtypes},
that when there is little danger of confusion, we may drop the subscript
``$\div$'' when talking about the unpointed structure.

\begin{remark}\label{rem:Bf-convention}
  To construct a function $\varphi : \prod_{f:\Hom(G,H)}T(f)$,
  where $T(f)$ is a family of types parametrized by $f:\Hom(G,H)$,
  it suffices to consider the case $f \jdeq \mkhom\Bf$.\footnote{%
    We use the same notational convention regarding ``$\B$''
    applied to homomorphisms as we do for groups.}
\end{remark}

Identifications of homomorphisms $f\eqto_{\Hom(G,H)}f'$
are equivalent to identifications of pointed maps
$\Bf \eqto_{\BG\ptdto\BH} \Bf'$;
the latter are
(by \cref{lem:isEq-pair=} and the fact that $\BH$ is a groupoid)
given by identifications of (unpointed) maps
$h : \Bf_\div \eqto \Bf'_\div$ such that\marginnote{%
  \begin{tikzcd}[ampersand replacement=\&,column sep=small]
    \& \shape_H\ar[dl,eql,"{\Bf_\pt}"'] \ar[dr,eqr,"\Bf'_\pt"] \& \\
    \Bf_\div(\shape_G) \ar[rr,eql,"{h(\shape_G)}"'] \& \& Bf'_\div(\shape_G)
  \end{tikzcd}}
\[
  h(\shape_G)\Bf_\pt = \Bf'_\pt.
\]

We will later show that if $G$ and $H$ are groups, then $\Hom(G,H)$
is equivalent to the \emph{set} of ``abstract group homomorphisms''
from $\abstr(G)$ to $\abstr(H)$ (see \cref{lem:homomabstrconcr} below),
but it is instructive to give a direct proof of the following.
\begin{lemma}\label{lem:hom-is-set}
  The type of homomorphisms $\Hom(G,H)$
  is a set for all groups $G,H$.
\end{lemma}
\begin{proof}
  Given homomorphisms $f,f':\Hom(G,H)$, we use the equivalence just
  described,
  \[
    (f \eqto f') \equivto \sum_{h:\Bf_\div\eqto\Bf'_\div}
    h(\shape_G)\Bf_\pt = \Bf'_\pt \,.
  \]
  Thus our goal is to prove that any two elements $(h,!),(j,!)$ 
  of the right-hand side can be identified.
  By function extensionality, the type $h\eqto j$ is equivalent to
  the proposition $\prod_{t:\BG_\div} h(t) = j(t)$. So now we can use
  connectedness of $\BG_\div$, and
  only check the equality on the point $\shape_G$. By assumption,
  \begin{displaymath}
    h(\shape_G) = \Bf'_\pt \inv{\Bf_\pt} = j(\shape_G).
  \end{displaymath}
  This concludes the proof that $f\eqto f'$ is a proposition, or in other
  words that $\Hom(G,H)$ is a set.\footnote{%
    The same argument shows that the type $X\ptdto Y$ is a set
    whenever $X$ is connected and $Y$ is a groupoid.
    A more general fact is that $X \ptdto Y$ is an $n$-type
    whenever $X$ is $(k-1)$-connected and $Y$ is $(n+k)$-truncated,
    for all $k\ge0$ and $n\ge-1$.}
\end{proof}

\begin{example}%
  \label{ex:groups-morphisms}%
  \leavevmode
  \begin{enumerate}
  \item Consider two sets $S$ and $T$.  Recall from \cref{ex:groups}
    that $\conncomp \Set S \jdeq\sum_{X:\Set}\Trunc{S \eqto X}$ is the component
    of the groupoid $\Set$ containing $S$, and when pointed at $S$
    represents the permutation group $\SG_S$.  The map
    $\blank\coprod T:\conncomp \Set S \to \conncomp \Set {S\coprod T}$ sending $X$ to $X\coprod T$
    induces a group homomorphism $\SG_S\to\SG_{S\coprod T}$,
    pointed by the path $\refl {S\coprod T}:S\coprod T \eqto (\blank\coprod T)(S)$.
    Thought of as symmetries, this says that if you have a symmetry of
    $S$, then we get a symmetry of $S\coprod T$ (which doesn't do
    anything to $T$).

    Likewise, we have a map
    $\blank\times T:\conncomp \Set S \to \conncomp\Set {S\times T}$ sending $X$ to
    $X\times T$, inducing a group homomorphism
    $\SG_S\to\SG_{S\times T}$, pointed by the path
    $\refl {S\times T}: {S\times T} \eqto (\blank \times T)(S)$.
    Thought of as symmetries, this says that if you have a symmetry of
    $S$, then we get a symmetry of $S\times T$ (which doesn't do
    anything to the second component of pairs in $S\times T$).

    In particular, we get homomorphisms of symmetric groups
    $\SG_m\to\SG_{m+n}$ and $\SG_m\to\SG_{mn}$, induced by identifications
    $\Fin(m+n) \eqto \Fin(m) \coprod \Fin(n)$ and
    $\Fin(mn) \eqto \Fin(m) \times \Fin(n)$.\footnote{%
      The latter identification is somewhat arbitrary, but
      let's say it's defined using the lexicographic ordering
      on the product.}
\item Let $G$ be a group.  Since there is a unique map from $\BG$ to
  $\bn{1} $ (uniquely pointed by the reflexivity path of the unique
  element of $\bn 1$), we get a unique homomorphism from $G$ to the
  trivial group.  Likewise, there is a unique morphism from the
  trivial group to $G$, sending the unique element of $\bn 1$ to
  $\shape_G$, and pointed by $\refl {\shape_G}$;
  the uniqueness follows from~\cref{lem:contract-away},
  cf.\ \cref{lem:univ-cover-of-groupoid}.
\item If $G$ and $H$ are groups, the projections $\BG\gets \BG\times \BH\to \BH$ and inclusions $\BG\to\BG\times\BH\gets\BH$
  (\eg the inclusion $\BG\to\BG\times\BH$ is given by $z\mapsto(z,\shape_H)$)
  give rise to group homomorphisms between $G\times H$ and $G$ and $H$,
  namely projections $G\gets G\times H\to H$ and inclusions
  $G\to G\times H\gets H$.
\item In \cref{ex:cyclicgroups} we gave an example of an isomorphism, 
  namely one from the cyclic group $\CG_m$ to $\ZZ/m\ZZ$,
  and in~\cref{ex:Cm} we looked at $R_m : \B\ZZ \ptdto \BSG_m$,
  pointed by $\refl{\bn m}$,
  which induces a homomorphism $(\blank\mod m) : \ZZ \to \SG_m$
  factoring through $\ZZ/m\ZZ$ (and, equivalently, through $\CG_m$).\footnote{%
    Since the classifying type $\BCG_m$ is the $0$-image
    of the classifying map $R_m$ of the homomorphism $(\blank\mod m)$, 
    we'll later say that $\CG_m$ is the \emph{image} of this homomorphism,   
  cf.~\cref{subsec:ker}.}\qedhere
  \end{enumerate}
\end{example}

\begin{remark}
  In the examples above, we insisted on writing the path pointing a group
  homomorphism, even when this path was a reflexivity path. We now adopt
  the convention that there is no need to specify the path in this case. Thus, given a
  map $f:A \to B$ between connected groupoids and $a:A$, the group
  homomorphism $\Aut_A(a) \to \Aut_B(f(a))$ defined by
  $(f,\refl{f(a)})$ will simply be referred to as $f$.

  However, it is important to understand that different homomorphisms
  can have the same underlying unpointed function. Consider, for
  example, the group $\SG_3$, whose classifying space is
  $\BSG_3\defequi (\FinSet_3,\bn 3)$, and the symmetry
  $\tau:\USG_3$ that is defined (through
  univalence) by
  \[
    0\mapsto 1,\quad 1\mapsto 0,\quad 2 \mapsto 2, \qquad
    \text{\ie, $\tau$ is the transposition $(0\; 1)$.}
  \]
  Then the function $\id: \FinSet_3 \to \FinSet_3$ gives rise to two
  elements of $\Hom(\permgrp 3,\permgrp 3)$: the first one is
  $(\id,\refl{\bn 3})$, which is simply denoted $\id_{\SG_3}$;
  the second one is $(\id,\tau)$, which we will denote $\tilde\tau$
  temporarily. Let us prove $\id_{\SG_3} \neq \tilde \tau$, that
  is, we suppose $\id_{\permgrp 3} = \tilde \tau$
  and derive a
  contradiction. By~\cref{def:loops-map} we get
  $\sigma = \loops(\id_{\SG_3})(\sigma) = \loops(\tilde \tau)(\sigma) 
          = \tau^{-1} \sigma \tau$ for all $\sigma : \USG_3$,
  so $\tau$ commutes with every other element of
  $\USG_3$. This fails for the transposition $\sigma \defeq (1\;2)$,
  since $\sigma\tau(0) = 2$ while $\tau\sigma(0) = 1$. (See also
  \cref{exer:first examples}.)
\end{remark}

\begin{construction}\label{def:loops-compose}
  For pointed types $X,Y,Z$ and pointed maps $f : X \ptdto Y$
  and $g : Y \ptdto Z$, we get an identification of type
  \[
    \loops(g \circ f) \eqto_{(\loops X \to \loops Z)}
    \loops(g) \circ \loops(f).
  \]
\end{construction}

\begin{implementation}{def:loops-compose}
  Let $x$ denote the base point of $X$.
  By induction on $f_\pt$ and on $g_\pt$, we reduce to the case where $f_\pt \jdeq \refl{f(x)}$
  and $g_\pt \jdeq \refl{g(f(x))}$, and it suffices to identify $\ap{g \circ f}$ with $\ap g \circ \ap f$.
  By \cref{def:funext}, it suffices to identify $\ap{g \circ f}(p)$ with $\ap g ( \ap f (p))$ for each $p : \loops X$.
  For that purpose, it suffices to even identify $\ap{g \circ f}(p)$ with $\ap g ( \ap f (p))$ for any $x' : X$ and any $p : x \eqto x'$.
  Then by induction on $p$, it suffices to give an identification
  $\ap{g \circ f}(\refl x) \eqto \ap g ( \ap f (\refl x))$, and that can
  be done by reflexivity,
  by observing that both sides are equal, by definition, to $\refl{g(f(x))}$.
\end{implementation}

\begin{corollary}\label{cor:USym-compose}
For composable group homomorphisms
$\varphi : \Hom(G,H)$, $\psi:\Hom(H,K)$,
we get an identification
$\USym(\psi\circ\varphi) = \USym\psi \circ \USym\varphi$.
\end{corollary}

The following example expresses that $\ZZ$ is a ``free group with one generator''.

\begin{example}
  \label{ex:Zinitial}
  \cref{cha:circle} was all about the circle $S^1$ and its role as a
  ``universal symmetry'' and how it related to the integers.  In our
  current language, $\ZZ\jdeq\mkgroup(\Sc,\base)$ and much\footnote{%
  Not all: $\BG$ is a groupoid and not an arbitrary type,
  cf.~\cref{sec:inftygps}.} of the
  universality of $S^1$ is found in the following observation. If $G$ is a
  group, then \cref{cor:circle-loopspace} yields an equivalence of sets
  %the evaluation equivalence
  %$\ev_{\BG_\div}:(S^1\to \BG_\div)\we \sum_{y:\BG_\div}(y=y)$ of   
  \[
    \ev_{\BG}:\left((S^1,\base)\ptdto \BG\right)\equivto \USymG,
    \quad 
    %f_\pt^{-1}\ap{f_\div}(\Sloop)f_\pt
    \ev_{\BG}(f_\div,f_\pt)\defeq\loops(f_\div,f_\pt)(\Sloop).
  \]
  The domain of this equivalence is $\BHom(\ZZ,G)$.
  Hence, $\ev_{\BG}$ provides a way to
  identify $\Hom(\ZZ,G)$ with the underlying set $\USymG$.
  Like in \cref{lem:freeloopspace}, the inverse of $\ev_{\BG}$
  is denoted $\ve_{\BG}$ and satisfies $\ve_{\BG}(g)(\base)\jdeq\shape_G$ and
  $\ve_{\BG}(g)(\Sloop)= g$.
  Moreover, $\ve_{\BG}(g)$ is pointed by $\refl{\shape_G}$.
\end{example}

The following lemma states the ``naturality'' of $\ev_{\BG}$ 
in the previous example.
\begin{lemma}\label{lem:Znatural}
Let $G$ and $H$ be groups and $f: \Hom(G,H)$.
Then the following diagram commutes,
\[
  \begin{tikzcd}
    \Hom(\ZZ,G) \arrow[r, eqr, "\ev"] \arrow[d, "f\circ{\blank}"'] &
    \USymG \arrow[d, "\USymf"]\\
    \Hom(\ZZ,H) \arrow[r, eqr, "\ev"] & \USymH,
  \end{tikzcd}
\]
where the horizontal maps evaluate
the map on underlying symmetries at the loop
$\Sloop : \USym\ZZ$.
\end{lemma}

\begin{proof}
  Let $k:\Hom(\ZZ,G)$, giving $\USymk : \USym\ZZ \to \USymG$.
  Going across horizontally and then down,
  $k$ is mapped first to $\USymk(\Sloop)$,
  and then to $\USymf(\USymk(\Sloop))$.
  Going the other way takes $k$ to $\USym(f\circ k)(\Sloop)$,
  which is equal to $\USymf(\USymk(\Sloop))$
  by \cref{cor:USym-compose}.
\end{proof}

% \[
% \begin{tikzcd}
% (g,g_0) \arrow[r, mapsto, "\ev_{\BG}"] \arrow[d, mapsto, "{(f,f_0)\_}"] &
% g_0^{-1} g(\Sloop) g_0 \arrow[d, mapsto, "{(f,f_0)(\_)}"]\\
% (fg,f(g_0)f_0) \arrow[r, mapsto, "\ev_{\BH}"] & f_0^{-1} f(g_0)^{-1} f(g(\Sloop)) f(g_0) f_0 \\
% \end{tikzcd}
% \]


\begin{xca}\label{xca:BGtotype}
  Let $G$ be a group and $A$ a groupoid.  Use the definitions and
  \cref{xca:freemaps} to construct equivalences between the types:
  \begin{enumerate}
  \item $\BG_\div\to A$
  \item $\sum_{a:A}\sum_{f:\BG_\div \to A}a \eqto f(\shape_G)$
  \item $\sum_{a:A}(\BG\ptdto(A,a))$
  \item $\sum_{a:A}\Hom(G,\Aut_A(a))$\qedhere
  \end{enumerate}
\end{xca}

The definition of group homomorphism in \cref{def:grouphomomorphism} should be contrasted with the usual -- and somewhat more cumbersome -- notion of a group homomorphism $f\colon \mathcal G\to \mathcal H$ of abstract groups where we must ask of a function of the underlying sets that it in addition preserves the neutral element,
multiplication, and inverse operation.
In our setup this is simply true, as we saw in~\cref{lem:grouphomomaxioms}.
In terms of the abstract groups determined by $G$ and $H$, we can write these equations
as
\begin{alignat*}2
  \USymf ( e_G )
  &= e_H
  &\qquad& \\
  \USymf (g \cdot_G g') &= \USymf(g) \cdot_H \USymf(g')
  && \text{for all $g, g' : \USymG$,} \\
  \USymf (g ^ {-1})
  &= (\USymf (g))^{-1}
  && \text{for all $g : \USymG$.}
\end{alignat*}
Here we follow the usual custom of defining a homomorphism of abstract groups
just in terms of the first two:
\begin{definition}\label{def:abstrisfunctor}
  If $\mathcal G\defequi(S,e_{\mathcal G},\cdot_{\mathcal G},\iota_{\mathcal G})$ and $\mathcal H\defequi(T,e_{\mathcal H},\cdot_{\mathcal H},\iota_{\mathcal H})$ are two abstract groups, then the set of homomorphisms from $\mathcal G$ to $\mathcal H$ is\marginnote{%
    Both $e_{\mathcal H}=f(e_{\mathcal G})$ and
    $f(s\cdot_{\mathcal G}s')=_Tf(s)\cdot_{\mathcal H}f(s')$ are
    propositions; hence a homomorphism of abstract groups is uniquely determined
    by its underlying function of sets, and unless there is danger of
    confusion we may write $f$ instead of $(f,!)$.}
  \[
    \Hom^\abstr(\mathcal G,\mathcal H)
    \defequi\sum_{f:S\to T}(e_{\mathcal H}=_Tf(e_{\mathcal G}))\times
    \prod_{s,s':S}f(s\cdot_{\mathcal G}s')=_Tf(s)\cdot_{\mathcal H}f(s').
  \]
  If $G$ and $H$ are groups, the function
  \[
    \abstr:\Hom(G,H)\to\Hom^\abstr(\abstr(G),\abstr(H))
  \]
  is defined as the function $f\mapsto \abstr(f)\defequi(\USymf,!)$
  made explicit in \cref{def:USym-hom} and satisfying the
  properties by~\cref{lem:grouphomomaxioms}.
\end{definition}
\begin{xca}
  Note that the inverses play no r\^ole in the definition of a homomorphism of abstract groups.  Prove that if $(f,!):\Hom^\abstr(\mathcal G,\mathcal H)$,
  then the proposition $f(g^{-1})=(f(g))^{-1}$ holds for all $g:\mathcal G$,
  so that we don't have to require it separately.
\end{xca}
\begin{remark}
  Our definition of homomorphisms of abstract groups also makes sense for monoids
  as defined in~\cref{rem:monoids}, and with our definition it is immediate that
  a homomorphism of abstract groups also defines a homomorphism of the underlying
  monoids. It is possible, however to instead define the set of homomorphisms
  from $\mathcal G \jdeq (S,e_{\mathcal G},\cdot_{\mathcal G},\iota_{\mathcal G})$
  to $\mathcal H\jdeq(T,e_{\mathcal H},\cdot_{\mathcal H},\iota_{\mathcal H})$
  simply by
  \[
    \sum_{f:S\to T}
    \prod_{s,s':S}f(s\cdot_{\mathcal G}s')=_Tf(s)\cdot_{\mathcal H}f(s').\qedhere
  \]
\end{remark}
\begin{xca}
  Prove this by deriving $e_{\mathcal H}=f(e_{\mathcal G})$ from the above.
\end{xca}

\begin{xca}
Prove that composition of the functions on the underlying sets gives a composition of homomorphisms of abstract groups.

  Prove that if $f_0:\Hom(G_0,G_1)$ and $f_1:\Hom(G_1,G_2)$ then
$$\abstr(f_1f_0)=\abstr(f_1)\abstr(f_0)$$ and that $\abstr(\id_G)=\id_{\abstr(G)}$.
\end{xca}

\begin{example}
  \label{ex:conjhomo}
  Let $\mathcal G=(S,e,\mu,\iota)$ be an abstract group and let $g:S$.  In \cref{xca:conj} we defined $\conj^g:S\to S$ by setting $\conj^g(s)\defequi g\cdot s\cdot g^{-1}$ for $s:S$ and asked you to show that it ``preserves the group structure'', \ie represents a homomorphism
  \[
    \cong^g:\Hom^\abstr(\mathcal G,\mathcal G)
  \]
  called \emph{conjugation} by $g$\index{conjugation}.
  Actually, we asked for more: namely that conjugation by $g$ is 
  an isomorphism, and hence determines an identification
  (for which we used the same symbol) $\conj^g:\mathcal G\eqto\mathcal G$.

  If $\mathcal H$ is some other abstract group, transport along $\conj^g$
  gives an identification
  $\conj^g_*:\Hom(\mathcal H,\mathcal G) \eqto \Hom(\mathcal H,\mathcal G)$
  which should be viewed as ``postcomposing with conjugation''.
  Similar considerations go for elements in $\mathcal H$,
  giving rise to ``precomposition with conjugation''.
\end{example}

\begin{example}
\label{exa:conj-concrete}
 In terms of concrete groups one can think of conjugation as moving
 the shape of the concrete group along a path in the classifying type. 
 This path can in particular be a loop at the shape. More precisely,
 let $G$ be a group, $y$ an element of $\BG$, and $p$ a path of 
 type $\shape_G\eqto y$.
 Then $(\id_\BG,\inv p)$ is a pointed equivalence of type 
 $\BG \equivto_* (\BG_\div , y)$ and hence induces an isomorphism 
 from $G$ to $\mkgroup(\BG_\div , y)$.\footnote{%
 One may wonder why $\inv p$ in $(\id_\BG,\inv p)$.
 The reason is our convention for the direction of the
 pointing path of a pointed map in combination with the
 convention that $\conj^p$ is transport along $p$.}
 By \cref{remark:groupsasunivalenttype} we then get an 
 identification of these groups.
 Moreover, by path induction on $p$, the equivalence
 $\USym(\mkgroup(\id_\BG,\inv p))\jdeq\loops(\id_\BG,\inv p)$ 
 of type $(\sh_G\eqto\sh_G)\equivto(y\eqto y)$\footnote{%
 Note that $\USym(\mkgroup(\BG_\div,y)) \jdeq 
 \loops(BG_\div,y) \jdeq (y\eqto y)$.}
 can be identified with the map $g \mapsto p g \inv p$. 
 In the special case
 of $y\jdeq\sh_G$ this map is precisely $\conj^p$ from \cref{xca:conj}.
 \footnote{%
 One can also start from $\conj^p$ and ask for a pointed map 
 $f: \BG_\div \ptdto \BG_\div$ such that $\loops(f) = \conj^p$.
 We shall develop a general method for constructing
 such a map $f$  in~\cref{sec:homabsisconcr} below.}
 The more general form introduced here is also called conjugation.
 \index{conjugation}
\end{example}

The above example motivates and justifies the following definition of
a homomorphism from a group to its \emph{inner} automorphisms, that is, 
automorphisms that come from conjugation.\index{automorphism!inner}
Such automorphisms will further be discussed in \cref{sec:aut-group}.
Recall that $\BAut(G)$ is the connected component of $G$ in the type 
$\Group$, pointed at $G$.
 
\begin{definition}\label{def:inner-autos}
Let $G$ be a group. Define the homomorphism $\inn: G \to \Aut(G)$ by setting
\glossary(inn){$\protect\inn$}{homomorphism from $G$ to its inner automorphisms,
\cref{def:inner-autos}}
\begin{displaymath}
  \Binn : \BG \ptdto \BAut(G), \quad y \mapsto \mkgroup(\BG_\div , y),
\end{displaymath}
where the path pointing $\Binn$ is $p_{\inn} \defeq \refl{G} :  G \eqto \Binn (\shape_G)$.
Note that $p_{\inn}$ is well defined since $\Binn (\shape_G) \jdeq G$.
Notice furthermore that the codomain of $\Binn$ is correct: since $\BG$ is connected, 
the proposition $\Trunc{G \eqto \mkgroup(\BG_\div , y)}$ holds for all $y:\BG$, 
by the argument in \cref{exa:conj-concrete}.
\end{definition}

\section{The sign homomorphism}
\label{sec:sign-homomorphism}

In this section we're going to define the very important
\emph{sign homomorphism} $\sgn : \SG_n \to \SG_2$, defined for $n \ge 2$.
To do this, we need to assign to every $n$-element set $A$ a $2$-element set $\Bsgn(A)$.
\begin{marginfigure}
  \tikzset{->-/.style={
      decoration={
        markings,
        mark=at position .66 with {\arrow[line width=1.18pt]{>}}},postaction={decorate}}}
  \begin{tikzpicture}
    \def\myzero{0}
    \foreach \i in {0,1}
    \foreach \j in {0,1}
    \foreach \k in {0,1} {
      \pgfmathtruncatemacro{\x}{\j}
      \pgfmathtruncatemacro{\y}{mod(3 * \i + 2 * \j + 2 * \k,4)}
      \begin{scope}[xshift=50*\x,yshift=-40*\y]
        \node[dot] (n1\i\j\k) at (90:.5) {};
        \node[dot] (n2\i\j\k) at (210:.5) {};
        \node[dot] (n3\i\j\k) at (330:.5) {};
        \ifx\i\myzero
        \draw[->-] (n1\i\j\k)--(n2\i\j\k);
        \else
        \draw[->-] (n2\i\j\k)--(n1\i\j\k);
        \fi
        \ifx\j\myzero
        \draw[->-] (n2\i\j\k)--(n3\i\j\k);
        \else
        \draw[->-] (n3\i\j\k)--(n2\i\j\k);
        \fi
        \ifx\k\myzero
        \draw[->-] (n3\i\j\k)--(n1\i\j\k);
        \else
        \draw[->-] (n1\i\j\k)--(n3\i\j\k);
        \fi
      \end{scope}
    }
    \draw[dashed] (-.6,-2)--(2.4,-2);
  \end{tikzpicture}
  \caption{The two equivalence classes of directions of the complete graph
    on a $3$-element set.}
  \label{fig:sign-orderings-3}
\end{marginfigure}

We get this $2$-element set as a quotient of the set of all possible ways of
choosing an element from each $2$-element subset of $A$, 
where two different such
choices are deemed the same if they differ in an \emph{even} number of pairs.
Since choosing an element from a $2$-element set is equivalent to ordering it
(\eg chosen element first),
we can also talk about ways of ordering all possible $2$-element subsets of $A$,
or equivalently, ways of directing the complete graph on $A$.
\Cref{fig:sign-orderings-3} shows all $8$ ways of directing the complete graph on
a $3$-element set divided into the $2$ resulting equivalence classes.

To see that this really defines an equivalence relation, 
it helps to generalize a bit.
Thus, fix a finite set $E$, and let $P : E \to \BSG_2$ be a family 
of $2$-element sets with parameter type $E$.
\begin{definition}
  The parity relation $\sim$ on $\prod_{e:E}P(e)$ relates functions that disagree in an even number of points. That is, $f\sim g$ holds if and only if the
  subset $\setof{e:E}{f(e) \ne g(e)}$ has an even number of elements.\footnote{%
    This makes sense because any $2$-element set is decidable,
    and a subset of a finite set specified by a decidable predicate
    is itself a finite set. We may apply the usual set-theoretic
    operators, such as union and set difference, to these subsets.
    Note also that the parity relation is itself decidable.}
\end{definition}
\begin{lemma}
  The parity relation $\sim$ is an equivalence relation on the set $\prod_{e:E}P(e)$,
  and the quotient is a $2$-element set if $E$ is nonempty, otherwise it is
  a $1$-element set.
\end{lemma}
\begin{proof}
  The $\sim$ relation is clearly symmetric, and it is reflexive, since the empty set
  has an even number of elements.
  To show transitivity, let $f_1,f_2,f_3:\prod_{e:E}P(e)$.
  We can partition $E$ according to whether the $f_i$ agree or disagree:
  \[
    E_{ij} \defeq \setof{e:E}{f_i(e) = f_j(e)}, \quad
    F_{ij} \defeq \setof{e:E}{f_i(e) \ne f_j(e)}.
  \]
  By transitivity of equality, $E_{ij} \cap E_{jk} \subseteq E_{ik}$, for all $i,j,k$.
  Hence, the Venn diagram of these sets has the simplified form shown in the margin,\marginnote{%
    \begin{tikzpicture}
      \fill[opacity=0.6,casred] (330:.57735) arc(0:120:1) arc(180:330:1);
      \fill[opacity=0.6,casblue] (90:.57735) arc(120:240:1) arc(-60:60:1);
      \draw (330:.57735) arc(0:120:1);
      \draw (330:.57735) arc(-60:-180:1);
      \draw (90:.57735) arc(120:240:1);
      \draw (90:.57735) arc(60:-60:1);
      \draw (210:.57735) arc(180:60:1);
      \draw (210:.57735) arc(-120:0:1);
      \node at (0,0) {$D$};
      \node at (30:.75) {$E'_{13}$};
      \node at (150:.75) {$E'_{12}$};
      \node at (-90:.75) {$E'_{23}$};
      \node at (30:1.5) {$E_{13}$};
      \node at (150:1.5) {$E_{12}$};
      \node at (-90:1.5) {$E_{23}$};
    \end{tikzpicture}}
  where we set
  \[
    D \defeq \setof{e:E}{f_1(e)=f_2(e)=f_3(e)}, \quad
    E_{ij}' \defeq E_{ij} \setminus D.
  \]
  Here we also use that $E_{12} \cup E_{23} \cup E_{13} = E$ (as subsets of $E$),
  since of the three function values at any $e$ in $E$, two must agree.

  We now find $F_{12} = E'_{13} \cup E'_{23}$ (disjoint union),
  and similarly for $F_{13}$ and $F_{23}$.
  Taking cardinalities, we get
  \[
    \Card(F_{12})+\Card(F_{13})+\Card(F_{23})
    =2\bigl(\Card(E'_{12})+\Card(E'_{13})+\Card(E'_{23})\bigr),
  \]
  so if two of the $F_{ij}$'s have an even number of elements,
  then so does the third.
  We also see that at least one of the $F_{ij}$'s has even cardinality,
  so the quotient has at most $2$ elements.

  Clearly, if $E$ is empty, then $\prod_{e:E}P(e)$ is contractible,
  so the quotient is contractible.
  Assume now that $E$ is nonempty.
  To show the proposition that the quotient is a $2$-element set,
  we may assume that $E$ is the $n$-element set $\set{1,\dots,n}$ (since $n>0$),
  and (by induction on $n$) that each set $P(e)$ is $\set{\pm 1}$
  (our favorite $2$-element set for the moment).
  Then any function is equivalent to either the all $+1$-function
  or the function that is $-1$ at $1$ and $+1$ otherwise,
  according to how many times it takes the value $-1$.
\end{proof}

\begin{definition}\label{def:mu_E}
  Given a finite set $E$, we define a homomorphism 
  $\mu_E : \Hom(\SG_2^E,\SG_2)$ as follows. First note that
  the groupoid $E \to \BSG_2$ is connected; we can make it pointed 
  by taking the constant map to $\sh_{\SG_2}$ as base point.
  We denote the corresponding group by
  $\SG_2^E \defeq \mkgroup(E \to \BSG_2,\cst{\sh_{\SG_2}})$;
  it is an $E$-fold product of the group $\SG_2$.
  Our construction $P \mapsto \bigl(\prod_{e:E}P(e)\bigr)/\sim$ above,
  for $E$ nonempty, defines a map $(E \to \BSG_2) \to \BSG_2$,
  which can be pointed by the identification indicated in the proof above,
  and thus defines the desired homomorphism $\mu_E$.
  We also have this homomorphism when $E$ is empty,
  since then $\BSG_2^E$ is contractible, so $\SG_2^E$ is the trivial group.
  The definition of $\mu_E$ is uniform in the finite set $E$,
  as we can decide whether $E$ is empty or not.
\end{definition}

\begin{xca}
  Show that the set of elements of $\SG_2^E$ can be identified with $\set{\pm1}^E$,
  and under this identification, $\USym\mu_E$ maps a function $s : E \to \set{\pm1}$
  to the product of its values.\footnote{%
    Note that this works even when $E$ is empty,
    since the product of an empty collection of numbers is $+1$.}
\end{xca}

\begin{definition}\label{def:sign-ordering}
  A \emph{local ordering}\index{ordering!local} of a finite set $A$
  is an element of the set $\prod_{e:E(A)}P(e)$,
  where $E(A)$ is the set of $2$-element subsets of $A$,
  and $P : E(A) \to \BSG_2$ maps a $2$-element subset to the underlying $2$-element set.

  A \emph{sign ordering}\index{sign ordering}\index{ordering!sign}
  of a finite set $A$ is an element of
  $\bigl(\prod_{e:E(A)}P(e)\bigr)/\sim$,
  \ie the quotient of the set of local orderings
  modulo the parity relation.
\end{definition}

\begin{definition}\label{def:sgn}
  The \emph{sign homomorphism} $\sgn : \Hom(\SG_n,\SG_2)$%
  \glossary(sgn){$\protect\sgn$}{sign homomorphism, \cref{def:sgn}}
  is defined via the pointed map $\Bsgn : \BSG_n \ptdto \BSG_2$,
  where $\Bsgn(A) \defeq \B\mu_{E(A)}(P)$, with $P$ as in
  \cref{def:sign-ordering} and $\mu_{E(A)}$ as in \cref{def:mu_E}.
  We make $\Bsgn$ pointed using the total ordering 
  $0 < 1 < \cdots < n-1$ on the standard $n$-element set, 
  $\bn n \jdeq \sh_{\SG_n}$, to identify each $2$-element 
  subset with the standard $2$-element set,
  and using the pointedness of $\B\mu$.
\end{definition}
Something interesting happens when we consider 
permutations on other shapes in $\BSG_n$,
\ie arbitrary $n$-element sets $A$.
The same map, $\Bsgn$, can be considered as a map $\BAut(A) \to \BSG_2$,
but we can cannot make this pointed uniformly in $A$.\footnote{%
  Why not? A construction $p : \prod_{A:\BSG_n}(\Bsgn_\div(A) \eqto \sh_{\SG_2})$
  would amount to an identification of $\Bsgn$ with the constant map.}
However, the self-identifications of a $2$-element set $T$, $(T \eqto T)$,
\emph{can} be identified with $\set{\pm1}$,\footnote{%
  In this section, we identify $\USG_2$ with the set $\set{\pm1}$,
  which has a compatible abstract group structure given by multiplication.}
according to whether it transposes the elements of $T$, or not.
Hence, we can define the sign of any permutation of a finite set:
\begin{definition}\label{def:sgn-permutation}
  Let $A$ be a finite set, and let $\sigma$ be a permutation of $A$.
  If the cardinality of $A$ is $0$ or $1$,
  then the \emph{sign}\index{sign} of $\sigma$ is $+1$.
  Otherwise, the \emph{sign} of $\sigma$ is $\pm1$ according to whether
  $\Bsgn_\div(\sigma)$ swaps the elements of the $2$-element 
  set $\Bsgn_\div(A)$, or not.
  We write $\sgn(\sigma):\set{\pm1}$ for the sign of $\sigma$.
\end{definition}
For permutations of the standard $n$-element set, this is the same as the value
$\Usgn(\sigma) : \USG_2$. Note that $\sgn$ defines an abstract homomorphism from
$\Aut(A)$ to $\SG_2$ for each $A$, since it does so for $A \jdeq
\sh_{\SG_n}$. Even better, this abstract homomorphism comes from a concrete one
$\sgn^A : \Hom(\Aut(A),\SG_2)$ for each finite set $A$. Indeed, since
$T \eqto U$ is a $2$-element set for any $2$-element sets $T$ and $U$, we can
consider the map $\Bsgn^A_\div : \BAut(A) \to \BSG_2$ that maps
$B : \BAut(A)$ to $(\Bsgn_\div(A) \eqto \Bsgn_\div(B))$. The identification of
$\Bsgn^A_\div(A)$ with $\{\pm1\}$ mentioned above makes $\Bsgn^A_\div$ into a
pointed map $\Bsgn^A : \BAut(A) \ptdto \BSG_2$, i.e., it defines an homomorphism
$\sgn^A : \Hom(\Aut(A),\SG_2)$, as announced.%
\footnote{This is an instance of a more general construction, called {\em
    delooping} (see \cref{sec:delooping}). The formula for $\Bsgn^A_\div$ here is
  very simple since $\SG_2$ is a fairly simple group.} %

\begin{lemma}\label{lem:sign-properties}
  \begin{enumerate}
  \item\label{it:sign-transposition}
    The sign of a transposition is $-1$.
  \item\label{it:sign-cycle}
    The sign of a $k$-cycle is $(-1)^{k-1}$.
  \item\label{it:identity-even}
    The identity permutation can only be expressed as a product
    of an even number of transpositions.
  \end{enumerate}
\end{lemma}

\begin{proof}
  For \ref{it:sign-transposition},
  it suffices to consider the transposition $(1\;2)$ of a 
  standard $n$-element set $\set{1,2,\dots,n}$.
  Relative to the standard local ordering 
  ($1<2,1<3,\dots,1<n,2<3,\ldots,n-1<n$),
  the transposition only changes the ordering $1<2$ to $2<1$,
  thus differing at exactly one place.

  Now \ref{it:sign-cycle} follows via~\cref{xca:perm-prod-transpositions}.

  For \ref{it:identity-even}, assume $\id_A = (a_1\;b_1)\cdots(a_k\;b_k)$,
  and take the sign of both sides. Since $\sgn$ is a homomorphism,
  we get $+1 = (-1)^k$, so $k$ is even.
\end{proof}

\begin{corollary}\label{cor:sign-defined}
  If a permutation $\sigma$ is expressed as a product of transpositions in two ways,
  \[
    \sigma = (a_1\;b_1)\cdots(a_m\;b_m)
    = (c_1\;d_1)\cdots(c_n\;d_n),
  \]
  then the parity of $m$ equals that of $n$,
  and we have $\sgn(\sigma)=(-1)^m=(-1)^n$.
\end{corollary}

\begin{marginfigure}
  \begin{tikzpicture}
    \foreach \n in {1,2,3,4,5} {
      \node[dot,label=above:{$\n$}] (x\n) at (\n,1) {};
      \node[dot,label=below:{$\n$}] (y\n) at (\n,0) {};
    }
    \draw[->] (x1) -- (y2);
    \draw[->,commutative diagrams/crossing over] (x2) -- (y3);
    \draw[->,commutative diagrams/crossing over] (x3) -- (y1);
    \draw[->,commutative diagrams/crossing over] (x4) -- (y5);
    \draw[->,commutative diagrams/crossing over] (x5) -- (y4);
  \end{tikzpicture}
  \caption{A different representation of the permutation $\sigma$
    from~\cref{fig:cycle-decomposition}.}
  \label{fig:permutation-crossings}
\end{marginfigure}
\begin{xca}\label{xca:sign-by-crossings}
  Here's a different way of finding the sign of a permutation of the standard $n$-element set $\bn n$
  (or of any totally ordered $n$-element set
  -- but these are all uniquely identified with $\bn n$).

  For $\sigma : \bn n \equivto \bn n$, we call an ordered pair of elements $i,j$
  with $i<j$ but $\sigma(i)>\sigma(j)$ an \emph{inversion}.
  If we represent $\sigma$ graphically as in~\cref{fig:permutation-crossings},
  then inversions are crossings of the edges $(i,\sigma(i))$ and $(j,\sigma(j))$.
  Show that $\sgn(\sigma) = (-1)^{\mathrm{inv}(\sigma)}$,
  where $\mathrm{inv}(\sigma)$ is the number of inversions.
\end{xca}
\begin{remark}
  The two graphical representations~\cref{fig:cycle-decomposition,fig:permutation-crossings}
  each have their uses: In the former, the cycle decomposition is immediately
  visible, while permutations are easily composed using the latter style.
  Note that the number of inversions depend on the linear ordering,
  whereas the sign itself does not.
  \begin{marginfigure}
    \begin{tikzpicture}[scale=0.8]
      \foreach \x/\n in {0/1,1/2,2/1,3/2,4/1,5/2} {
        \node[dot,label=above:{$\n$}] (x\x) at (\x,2) {};
        \node[dot,label=below:{$\n$}] (y\x) at (\x,0) {};
      }
      \node at (1.5,1) {$\rightsquigarrow$};
      \node at (3.5,1) {$\rightsquigarrow$};
      \node[dot] (z0) at (0,1) {};
      \node[dot] (z1) at (1,1) {};
      \node[dot,gray!25] (z2) at (2,1) {};
      \node[dot,gray!25] (z3) at (3,1) {};
      \draw[->] (x0) -- (z1);
      \draw[->] (z1) -- (y0);
      \draw[->,commutative diagrams/crossing over] (x1) -- (z0);
      \draw[->,commutative diagrams/crossing over] (z0) -- (y1);
      \draw[->] (x2) .. controls (3,1) and (3,1) .. (y2);
      \draw[->,commutative diagrams/crossing over] (x3) .. controls (2,1) and (2,1) .. (y3);
      \draw[->] (x4) -- (y4);
      \draw[->] (x5) -- (y5);
    \end{tikzpicture}
    \caption{The composition $(1\;2)(1\;2) = \id_{\bn 2}$ illustrated
      in the style of~\cref{fig:permutation-crossings}, with first two, then no
      crossings.}
    \label{fig:permutation-crossings-isotopy}
  \end{marginfigure}
  We also remark that when we compose permutations in the latter style,
  we don't immediately see the number of crossings/inversions, but we can imagine
  ``pulling the strings taut'', whereby the parity of the number of crossings
  (and thus the sign) is preserved, as seen in~\cref{fig:permutation-crossings-isotopy}.
\end{remark}

\section{Infinity groups (\texorpdfstring{\inftygps}{-groups})}
\label{sec:inftygps}

Disregarding the requirement that the classifying type
of a group $G$ is a groupoid (so that $\USym G$ is a set)
we get the simpler notion of \inftygps:
\begin{definition}\label{def:inftygps}
  The type of $\infty$-groups is
  \[
    \typeinftygp\defequi \Copy(\UUpconn),
    \quad\text{where}\quad
    \UUpconn\defeq \sum_{A:\UU} A\times \isconn(A)
  \]
  is the type of pointed, connected types.

  As for groups, we have the constructor 
  $\mkgroup : \UUpconn \to \typeinftygp$
  and the destructor $\clf : \typeinftygp \to \UUpconn$.
\end{definition}

\begin{remark}\label{rem:pointedtypes}
  Just as ``group'' is a synonym for ``pointed, connected groupoid''
  (wrapped with $\mkgroup$),
  ``$\infty$-group'' is a synonym for ``pointed, connected type''
  (wrapped with $\mkgroup$).
  As for pointed, connected groupoids,
  we suppress the propositional information from the notation,
  and write $(A,a)$ instead of $(A,a,!)$ for an pointed, connected type.
\end{remark}

\begin{definition}\label{def:classifyingspace}
  Given $G:\typeinftygp$,
  the underlying pointed type $\BG : \UUp$
  is called the  \emph{classifying type} of $G$ and $\shape_G\defequi \pt_{\BG}$
  is called the \emph{designated shape}.
\end{definition}

\begin{definition}
  For any type $A$ with a specified point $a$,
  we define the \emph{automorphism $\infty$-group} of $a:A$ by
  \[
    \Aut_A(a) \defeq \mkgroup (A_{(a)},(a,!)),
  \]
  \ie $\Aut_A(a)$ is the $\infty$-group with classifying type
  $\BAut_A(a) \jdeq (A_{(a)},(a,!))$,
  the connected component of $A$ containing $a$, pointed at $a$.
\end{definition}

\begin{remark}\label{rem:autinfgp}
  It can certainly happen that the connected component of $A$ containing $a$
  is groupoid, even though $A$ itself is not a groupoid.
  For example, consider a type universe $\UU$ and a \emph{set} $S:\UU$.
  Then $\conncomp\UU S$ is a groupoid, and the automorphism $\infty$-group
  $\Aut_\UU(S)$ is an ordinary group.

  Because we have an inclusion $\UUp^{=1} \hookrightarrow \UUp^{>0}$,
  we get a corresponding inclusion $\Group \hookrightarrow \typeinftygp$.
\end{remark}

\begin{definition}
  A homomorphism of $\infty$-groups is a pointed function of classifying types, \ie
  given two $\infty$-groups $G$ and $H$,we define
  \[
    \Hom(G,H)\defequi\Copy(\BG\ptdto\BH).
  \]
  Given $f \jdeq \mkhom\Bf: \Hom(G,H)$, we call
  $\Bf : \BG\ptdto\BH$ the \emph{classifying map} of $f$.
\end{definition}

\section{$G$-sets}
\label{sec:gsets}

One of the goals of \cref{sec:Gsetforabstract} is to prove that the types of groups and abstract groups are equivalent.
In doing that, we are invited to explore how abstract groups should be thought of as symmetries and introduce the notion of a $G$-set.
However, this takes a pleasant detour where we have to explore the most important feature of groups: they \emph{act} on things (giving rise to symmetries)!

Before we handle the more complex case of abstract groups,
let us see what this looks like for groups.

\begin{definition}
  For $G$ a group, a \emph{$G$-set} is a function
  $$X : \BG\to\Set,$$
and $X(\shape_G)$ is referred to as the \emph{underlying set}.
If $p:x=y$ in $\BG$, then the transport function $X(x)\to X(y)$ induced
by $X(p)\defeq\ap{X}(p) : X(x)=X(y)$ is also denoted by $X(p)$.
We denote $X(p)(a)$ by $p\cdot_X a$.
The operation $\cdot_X$ is called the \emph{group action} of $X$.
When $X$ is clear from the context we may leave out the
subscript $X$.\footnote{%
Note that in this case $\cdot: (x=y)\to X(x) \to X(y)$.
See \cref{def:principaltorsor} for a special case
where $\cdot_X$ is indeed path composition.}
In particular, if $g:\USym G$,
then $X(g)$ is a permutation of the underlying set of $X$.

The type of $G$-sets is
\[
  \GSet\defequi(\BG\to\Set).\qedhere
\]
\end{definition}
\marginnote{
  Much of what follows will work equally well for $\infty$-groups; if $G$ is an infinity group, a \emph{$G$-type} is a function $X : \BG\to\UU.$
}
If $x:\BG$, then $X(x)$ is a ``twisted'' version of the underlying set.
\begin{remark}
  The reader will notice that the type of $G$-sets is equivalent to the
type of \coverings over $\BG$.
The reason we have allowed ourselves two names is that our focus is different: for a $G$-set $X:\BG\to\Set$ we focus on the sets $X(z)$, whereas when talking about \coverings the first projection $\sum_{z:\BG}X(z)\to \BG$ takes center stage.  Each focus has its advantages.
\end{remark}

\begin{example}\label{def:principaltorsor}
  If $G$ is a group, then
$$\princ G:\BG\to\Set,\qquad\princ G(z)\defequi\pathsp{\shape_G}(z)\defequi(\shape_G=z)$$ is a $G$-set called the \emph{principal $G$-torsor}.
We've seen this family before in the guise of the (preimages of the) ``universal \covering'' of \cref{def:universalcover}!
\marginnote{The term ``$G$-torsor'' will reappear several times and will mean nothing but a $G$-type in the component of $\princ G$ -- a ``twisted'' version of $\princ G$.}

There is nothing sacred about starting the equality $\shape_G = z$ in $\shape_G$.
Let
$$\pathsp{\blank}:\BG\to\GSet$$ denote the map sending $y:\BG$ to the $G$-set $\pathsp y$.
Applying $\pathsp{\blank}$ to a path $q:y=y'$
induces an equivalence from $\pathsp y$ to $\pathsp {y'}$ that sends $p:y=z$ to $pq^{-1}:y'=z$. As a matter of fact, \cref{lem:BGbytorsor} will identify $\BG$ with the type of $G$-torsors via the map $\pathsp{\blank}$, simply denoted as $\pathsp{}$,
using the full transport structure of the identity type $\pathsp y(z)\defequi(y=z)$.
\end{example}

\begin{example}\label{def:adjointrep}
  If $G$ is a group (or \inftygp), then
$$\Ad_G:\BG\to\UU,\qquad\Ad_G(z)\defequi(z=z)$$ is a $G$-set (or $G$-type) called the \emph{adjoint $G$-set (or $G$-type)}.
\marginnote{The name ``adjoint'' comes from how transport works in this case; if $p:y=z$, then $\Ad_G(p):(y=y)=(z=z)$ is given by conjugation:
$$\Ad_G(p)(q)=pqp^{-1}:z=z,$$ the picture
$$\xymatrix{y\ar@{=}[r]^p_\to\ar@{=}[d]_q^\downarrow&z\ar@{=}[d]^{\Ad_G(p)(q)}_\downarrow\\
y\ar@{=}[r]^p_\to&z}$$
is a mnemonic device illustrating that it couldn't have been different, and should be contrasted with the picture for $\princ G (p):(\shape_G=y)=(\shape_G=z)$:
$$\xymatrix{\shape_G\ar@{=}[r]^{\refl{\shape_G}}_\to\ar@{=}[d]_q^\downarrow&\shape_G\ar@{=}[d]^{\princ G(p)(q)}_\downarrow\\
  y\ar@{=}[r]^p_\to&\,z.}$$
}
Notice that by the induction principle for the circle,
$$\sum_{z:\BG}\Ad_G(z)=\sum_{z:\BG}(z=z)$$
is equivalent to the type of (unpointed!) maps $\Sc\to\BG$, known in other contexts as the \emph{free loop space} of $\BG$, an apt name given that it is the type of ``all symmetries in $\BG$.''
The first projection $\sum_{z:\BG}\Ad_G(z)\to \BG$ correspond to the function $(\Sc\to\BG)\to\BG$ given by evaluating at $\base$.
\end{example}
\begin{example}
  \label{ex:HomHGasGset}
  Recall that a homomorphism $f:\Hom(H,G)$ consists of an unpointed map $F:\BH_\div\to \BG_\div$ together with a $p_f:\shape_G=F(\shape_H)$, so if, for $x:\BH$ and $y:\BG$, we define
$$\Hom(H,G)(x,y)\defequi\sum_{F:\BH_\div\to \BG_\div}(y=F(x))$$
we see that $\Hom(H,G)$ may be considered to be a $H\times G$-set
$$\Hom(H,G) : \BH\times \BG\to\Set.$$
We will be particularly interested in the restriction to $G$, giving a $G$-set for which we recycle the notation:
$$\Hom(H,G)(y)\defequi\Hom(H,G)(\shape_H,y)\defequi \sum_{F:\BH_\div\to \BG_\div}(y=F(\shape_H)).$$
\end{example}
\begin{xca}
  \label{xca:HomZGvsAdG}
  Provide an identification between the $G$-sets
$\Ad_G$  and $\Hom(\ZZ,G)$
of \cref{def:adjointrep} and \cref{ex:HomHGasGset}.
\marginnote{%
Hint: This is similar to \cref{ex:Zinitial}:
identify $\Hom(\ZZ,G)(y)$ with $\sum_{z:\BG}\sum_{p:z=z}(y=z)$ and
consider the map to $y=y$ sending $(z,p,q)$ to $q^{-1}p\,q$.
}
\end{xca}


\begin{example}\label{def:trivGset}
  If $G$ is a group and $X$ is a set, then
$$\mathrm{triv}_GX(z)\defequi X$$ is a $G$-set.
Examples of this sort (regardless of $X$) are called \emph{trivial $G$-sets}.
\end{example}

\begin{remark}
  \label{remark:GsetsareGsets}
  A $G$-set $X$ is often presented by focusing on the underlying set $X(\shape_G)$
and providing it with a structure relating it to $G$ determining
the entire function $X : \BG\to\Set$.

More precisely, since $\BG$ is connected, a $G$-set $X : \BG\to\Set$ factors
through the component $\conncomp \Set {X(\shape_G)} \defequi \sum_{Y:\Set}\Trunc{X(\shape_G)=Y}$
which contains the point $X(\shape_G)$.
Since $B\Sigma_{X(\shape_G)}\defequi(\conncomp \Set {X(\shape_G)},X(\shape_G))$ the $G$-set $X$ can,
without loss of information, be considered as a homomorphism from $G$ to
the permutation group $\Sigma_{X(\shape_G)}$ of $X(\shape_G)$,
that is, a pointed map
$$\BG\ptdto\BSigma_{X(\shape_G)}.$$

Conversely, if $X$ is any set \emph{and} we have a homomorphism
from $G$ to $\Sigma_X$, \ie a pointed map $(f,p) : \BG\ptdto \BSigma_{X}$),
then the composite
$$\xymatrix{\BG\ar[r]^-{f}&\conncomp \Set X \ar[r]^{\fst}&\Set}$$
is a $G$-set, and the value at $\shape_G$ is identified with $X$.
\marginnote{%
We must be careful not to focus too much on the underlying set.
For instance, even though the underlying set of both $\Ad_G$ and $\princ G$ is $\USym G$, in general  $\Ad_G$ and $\princ G$  are very different $G$-sets.
To drive this point home, compare the illustrations of transport along a $p:\USym G$ for the two:
$$\xymatrix{\shape_G\ar@{=}[r]^p_\to\ar@{=}[d]_q^\downarrow&\shape_G\ar@{=}[d]^{\Ad_G(p)(q)}_\downarrow\\
  \shape_G\ar@{=}[r]^p_\to&\shape_G} $$%\qquad
$$\xymatrix{\shape_G\ar@{=}[r]^{\refl{\shape_G}}_\to\ar@{=}[d]_q^\downarrow&\shape_G\ar@{=}[d]^{\princ G(p)(q)}_\downarrow\\
\shape_G\ar@{=}[r]^p_\to&{\hphantom{.}}\shape_G.}$$
A third $G$-set with underlying set $\USym G$ is $\mathrm{triv}_G(\USym G)$.}

The constructions in the previous two paragraphs yields the following equivalence:
\[
\GSet \equivto \sum_{X:\Set} \BG \ptdto \BSigma_X.\qedhere
\]
\end{remark}

\begin{xca}
Show:  if $X$ is a type family with parameter type $\BG$ and $X(\shape_G)$ is a set,
then $X$ is a $G$-set.
\end{xca}

\begin{xca}
  Prove that a group $G$ is abelian group if and only if the $G$-sets $\Ad_G$ and $\mathrm{triv}_G(\USym G)$ are identical.
\end{xca}

\sususe{Transitive $G$-sets}
\label{sec:transitiveGsets}
We end the section with some observations regarding so-called transitive $G$-sets which will be valuable when we move on to discussing subgroups.
Classically, a $\abstr(G)$-set (a notion \emph{we} have yet not defined) $\mathcal X$ is said to be \emph{transitive} if there exists a $b:\mathcal X$ such that for all $a:\mathcal X$ there exists a $g:\mathcal X$ with $a=g\cdot b$.  In our world this translates to
\begin{definition}\label{def:transitiveGset}
  A $G$-set $X:\BG\to\Set$ is \emph{transitive}\index{transitive $G$-set} if the proposition
  \[
    \istrans(X) \defequi \prod_{y:\BG}
    \exists_{b:X(y)} \prod_{a:X(y)} \exists_{g:y=y} a=g\cdot b
  \]
  holds.
\end{definition}
\begin{remark}

Note that the mention of $y$ is redundant in the definition: by
connectedness (cf.~\cref{xca:component-connected}) it is enough to
demand
\begin{displaymath}
  \exists_{b:X(\shape_G)}\prod_{a:X(\shape_G)}\exists_{g:\USym G}a=g\cdot b.
\end{displaymath}
In other words, $X$ is transitive if and only if there exists a
$b:X(\shape_G)$ such that the map $-\cdot b:\USym G\to X(\shape_G)$ is
surjective.

Yet another equivalent way of expressing that $X$ is transitive
is to say that $X(\shape_G)$ is nonempty and for any $a,b:X(\shape_G)$
there exists some $g:\UG$ with $a = g\cdot b$.
\end{remark}

\begin{lemma}
  \label{lem:conistrans}
  A $G$-set  is transitive if and only if the associated set bundle is connected.
\end{lemma}
\begin{proof}
  Consider a $G$-set $X:\BG\to\Set$ and the associated \covering
  $f:\tilde X\to\BG$ where $\tilde X\defequi\sum_{y:\BG}X(y)$ and $f$
  is the first projection.  Now, $\tilde X$ is connected if and only
  if there exists a $y:\BG$ and a $b:X(y)$ such that for
  all $z:\BG$ and $a:X(z)$ there exists a $g:y=z$ such that $a=g\cdot b$.
  Since $\BG$ is connected, this is equivalent to asserting that there
  exists a $b:X(\shape_G)$ such that for all $a:X(\shape_G)$ there exists
  a $g:\USym G$ such that $a=g\cdot b$.
\end{proof}

Recall that for type families $X,X':T\to\UU$, and
$f:\prod_{y:T}X(y)\to X'(y)$, we write $f_y:X(y)\to X'(y)$ (instead of
the more correct $f(y)$) for its evaluation at $y:T$.
\begin{lemma}
  \label{lem:evisinjwhentransitive}
  Let $X,X':\BG\to\Set$ be $G$-sets. Let $y:\BG$ and $b:X(y)$. Suppose that $X$
  is transitive. Then the evaluation map
$$\mathrm{ev}:(X=X')\to X'(y),\qquad \mathrm{ev}(f)\defequi f_y(b)$$
is injective.
\end{lemma}
\begin{proof}
  In view of function extensionality, our claim is that the evaluation
  map $\ev:\prod_{x:\BG}(X(x)=X(x))\to X(y)$ given by the same formula
  is injective; that is all $f$s with the same value $f_y(b)$ are
  identical.

  For $a:X'(y)$, consider an $f:X=X'$ with $f_y(b)=a$. Let $z:\BG$ and
  $c:X(z)$.  For any $g:y=z$ such that $g\cdot b=c$ we have
  $f_z(c)=f_z(g\cdot b)=g \cdot f_y(b)=g \cdot a$: the value does not
  depend on $f$. Since we try to prove a proposition we are done.
\end{proof}

\subsection{Actions in a type}
\label{sec:actions}
Oftentimes it is interesting not to have an action on a set, but on an element in any given type (not necessarily the type of sets).  For instance, a group can act on another, giving rise to the notion of the semidirect product in \cref{sec:Semidirect-products}.  We will return these more general types of actions many times.

\begin{definition}\label{action}
  If $G$ is any (possibly higher) group and $A$ is any type of objects,
  then we define an \emph{action} by $G$ in %the world of elements of
  $A$ as a function
  \[
    X : \BG \to A.\qedhere
  \]
\end{definition}

The particular object of type $A$ being acted on is $X(\shape_G):A$,
and the action itself is given by transport.
This generalizes our earlier definition of $G$-sets, $X : \BG \to \Set$.

\begin{definition}\label{std-action}
  The \emph{standard action} of $G$ on its designated shape $\shape_G$ is obtained by
  taking $A \defeq \B G$ and $X \defeq \id_{\B G}$.
\end{definition}

\begin{example}
  An action of $G$ on its set $\USym G$ of symmetries is provided by taking $X$ to be the principal torsor $\princ G$ as defined in
  \cref{def:principaltorsor}.
\end{example}

Notice that the type $\BG \to A$ is equivalent to the type
\[
  \sum_{a:A}\hom(G,\Aut_A(a)),
\]
that is, the type of pairs of an element $a : A$,
and a homomorphism from $G$ to the automorphism group of $A$.
This equivalence maps an action $X:\BG\to A$ to the pair consisting of $X(\shape_G)$
and the homomorphism represented by the pointed map from $\B G$ to the pointed component $A_{(a)}$ given by $X$.
% .  arising
% from corestricting $X$ to factor through the component of $A$ containing $a$
% together with the trivial proof that this map takes $\shape_G:\BG$ to $a$.

Because of this equivalence,
we define a \emph{$G$-action on $a:A$}
to be a homomorphism from $G$ to $\Aut_A(a)$.


Many times we are particularly interested in actions on types,
i.e., $A$ is a universe:
\[
  X : \BG \to \UU.
\]
In this case we can talk about fixed points and orbits as follows.
\begin{definition}
  \label{def:orbittype}\label{def:fixedpointtye}
  If $X\colon G\to\UU$, then  \emph{orbit type}\index{orbit type} of the action as
  \footnote{We use superscripts and subscripts many places and truncations of orbit types, and to distinguish the orbits and fixed points are decorated with ``$hG$'', following a convention in homotopy theory.}
\[
  X_{hG} \defeq \sum_{z:\BG} X(z),
\]
and the type of \emph{fixed points}\index{fixed point type} as
\[
  X^{hG} \defeq \prod_{z:\BG} X(z).
\]
The \emph{set of orbits}\index{set!of orbits}\index{orbit set} is the set-truncation of the orbit type,
\[
  X / G \defeq \Trunc{X_{hG}}_0.
\]
We say that the action is \emph{transitive} if $X / G$ is contractible.
\end{definition}
Notice that this notion of transitive coincides with the one we introduced in \cref{def:transitiveGset}: that $X/G$ is contractible exactly encodes that there is just one ``orbit'': there is a $b:X(\shape_G)$ so that for any $a:X(\shape_G)$ there is a $g:UG$ such that $a=g\cdot b$.


\section{The classifying type is the type of torsors}
This section can be seen as a motivation for the use of torsors.
In \cref{sec:Gsetforabstract} we'll use this concept to prove that the type of groups and the type of abstract groups are equivalent by classifying abstract groups in terms of their pointed connected groupoid of torsors.  To see how this might work it is good to start with the case of a (concrete) group $G$.  In the end we want the torsors of $\abstr(G)$ to be equivalent to $\BG$, so to get the right definition we should first explore what the torsors of $G$ look like and prove \cref{lem:BGbytorsor} showing that $\BG$ is equivalent to the type of $G$-torsors.
\label{sec:torsors}
\begin{definition}
  \marginnote{This works equally well with $\infty$-groups: $G$-torsors are in that case $G$-types in the component of the principal torsor.  There is no conflict with the case when the $\infty$-group $G$ is actually a group since then any $G$-type in the component of the principal $G$-torsor will be a $G$-set.
}
  Given a group  $G$, the type of {\em$G$-torsors} is
$$\typetorsor_G\defequi\sum_{X:\GSet}\Trunc{\princ G=X},$$
where $\princ G$ is the principal $G$-torsor of \cref{def:principaltorsor}.
\end{definition}


\begin{remark}
  For $G$ a group, the type of $G$-torsors is just another name for the component of the type of \coverings of $\BG$ containing the universal \covering.

Observe that for a group $G$, $\typetorsor_G$ is a connected groupoid (admittedly in a higher universe) and so -- by specifying the base point $\princ G$ -- it represents a group!  Guess which one!
\end{remark}

  For $z:\BG$, recall the definition of $\pathsp z:\BG\to\Set$ as the
  $G$-set with $\pathsp z(y)\defequi(z=y)$ (so that in particular
  $\princ G\defequi\pathsp{\shape_G}$).  Note that $\pathsp z$ is a $G$-torsor.

 \begin{definition}
  \label{def:BG2TorsG} Let $$\pathsp{}:\BG\to_*(\typetorsor_G,\princ G)$$ be the pointed map given by sending $z:\BG$ to $\pathsp z$ and by the identification $\refl{\pathsp{\shape_G}}:\pathsp{\shape_G}=\princ G$.
\end{definition}
If $G$ is not clear from the context, we may choose to write $\pathsp{}^G$ instead of $\pathsp{}$.

\begin{example}\label{ex:pathsptransport}
  For $y,z:\BG$ we make the induced map
$$\pathsp{}:(y=z)\to (\pathsp y=\pathsp z),
$$
or rather its composite with the equivalence to $\prod_{x:\BG}\pathsp y(x)=\pathsp z(x)$,
explicit.
For $q:y=z$,  the transport
$\pathsp q:\prod_{x:\BG}\pathsp y(x)=\pathsp z(x)$
is obtained
by sending $p:\pathsp y(x)\defequi (y=x)$ to
\marginnote{In a picture,
$$\xymatrix{y\ar@{=}[r]^q_\to\ar@{=}[d]^{p}_\downarrow&z\ar@{=}[d]^{\pathsp q(p)}_\downarrow\\
x\ar@{=}[r]^{\refl x}_\to&\,x.}$$}
$$\pathsp q(p)\defequi pq^{-1}:\pathsp z(x)\defequi(z=x).$$
\end{example}
\begin{lemma}\label{lem:pathsptransportiseq}
  For  $y,z:\BG$ the induced map  (\ie transport) of identity types
$$\pathsp{}:(y=z)\to (\pathsp y=\pathsp z)$$
is an equivalence.
\end{lemma}
\begin{proof}
  We craft an inverse $Q:(\pathsp y=\pathsp z) \to (y=z)$ for
  $\pathsp{}$. Given an identity $f:\pathsp y = \pathsp z$, the map
  $f_y: (y=y) \to (z=y)$ maps the reflexivity path $\refl y$ to a path
  $f_y(\refl y):z=y$, and we define
  \begin{displaymath}
    Q(f) \defequi \inv{f_y(\refl y)}
  \end{displaymath}
  First, $Q$ is an inverse on the right for $\pathsp{}$ as
  $\pathsp {Q(f)}$ is equal to the map $p \mapsto p f_y(\refl y)$, and
  by induction on $p:y=x$, $p f_y(\refl y) = f_x(p)$ (indeed this is
  true for $p\jdeq \refl y$). This means that $\pathsp {Q(f)} =
  f$. Next, we show that $Q$ is an inverse on the left for
  $\pathsp{}$: indeed for any $q:y=z$
  $\inv{\pathsp{q}(\refl y)} = \inv{(\refl y \inv q)} = q$; in other
  words $Q(\pathsp q)=q$.
\end{proof}


\begin{theorem}\label{lem:BGbytorsor}
  If $G$ is a group (or \inftygp), then the function
$$\pathsp{}:\BG\to(\typetorsor_G,\princ G),\qquad z\mapsto \pathsp z\defequi(x\mapsto(z=_{\BG}x))$$
is an equivalence.
Univalence then allows us to derive an identity
$$\bar{\pathsp{}}:G\eqto\Aut_{\GSet} (\princ G)$$
of groups (or $\infty$-groups).
\end{theorem}

\begin{proof}
  Since both $\typetorsor_G$ and $\BG$ are connected, it suffices by
  \cref{cor:fib-vs-path} to show that each
  $\ap {\pathsp{}}:(y=z)\to(\pathsp y=\pathsp z)$ is an
  equivalence. One prove first that $\ap {\pathsp{}}$ is indeed equal
  to the function
  $$\pathsp{}:(y=z)\to(\pathsp y= \pathsp z)$$
  made explicit in \cref{ex:pathsptransport}. It is done by induction
  on $q:y=z$, as indeed
  \begin{displaymath}
    \ap {\pathsp{}}(\refl y) \jdeq \refl {\pathsp y} = (p\mapsto p\inv{\refl y}).
  \end{displaymath}
  Then \cref{lem:pathsptransportiseq} states exactly that $\ap P$ is
  an equivalence.
\end{proof}

\subsection{Homomorphisms and torsors}
\label{sec:homotor}
In view of the equivalence $\pathsp{}^G$ between $\BG$ and $(\typetorsor_G,\princ G)$ of \cref{lem:BGbytorsor} one might ask what a group homomorphism  $f:\Hom(G,H)$ translates to on the level of torsors.  Off-hand, the answer is $(\pathsp{}^H)\Bf(\pathsp{}^G)^{-1}$, but we can be more concrete than that.  We do know that for $x:\BG$ the $G$-torsor $\pathsp x^G$ should be sent to $\pathsp {\Bf(x)}^H$, but how do we express this for an arbitrary $G$-torsor?
\begin{definition}
  \label{def:restrictandinduce}
  Let $f:\Hom(G,H)$ be a group homomorphism.  If $Y:\BH\to\Set$ is an $H$-set then the \emph{restriction} $f^*Y$ of $Y$ to $G$ is the $G$-set given by precomposition
$$f^*Y\defequi Y\, f:\BG\to\Set.$$

If $X:\BG\to\Set$ is a $G$-set and $y:\BH$ define
the \emph{induced $H$-type}
\marginnote{%
  Note that the induced $H$-type may or may not be an $H$-\emph{set}.
  As an example, consider the homomorphism $\cy 2:\Hom(\ZZ,\Sigma_2)$ discussed above, given by sending $\base:S^1$ to $\bn 2:\FinSet_2$ and $\Sloop$ to the twist.
}
\marginnote{%
  If we consider $\cy 2$ also as a $\ZZ$-set (by including $\FinSet_2$ in the type of all sets), the induced $\Sigma_2$-set $\Sigma_2\times_{\ZZ}\cy 2:\FinSet_2\to\Set$ is given by
  $$y\mapsto \Sigma_{z:S^1}(\cy 2(z)=y)\times \cy 2(z),$$
  and it is instructive to see that the symmetry of $(\base,\refl{\bn 2},0)$
  induced by $\Sloop^2$ is not identical to $\refl{}$,
  % \footnote{I have yet to write a nice exposition of this ``instructive'' point: one application of $\Sloop$ takes you to $(\base,tw,1)$}
  and so the induced $\Sigma_2$-type in question is \emph{not} a set.
}\marginnote{%
  This situation is common in algebra and is often referred to by saying that some construction is not ``exact''.
}
$f_*\BH\to\UU$ by
$$f_*X(y)\defequi\sum_{x:\BG}(\Bf x =y)\times X(x).$$
\end{definition}

For $X$ being the principal $G$-torsor  $\princ G$, the contraction of $\sum_{x:\BG}(\shape_G=x)$ induces an equivalence
$$\eta_y:f_*\princ G(y)=\sum_{x:\BG}(\Bf(x)=y)\times(\shape_G=x)\simeq (\Bf(x)=y)\oldequiv\princ{\Bf(x)}^H(y).$$  The resulting identity $\bar\eta:f_*\princ G=\princ{\Bf(x)}^H$ shows that for every $G$-torsor $X$ the $H$-type $f_*X$ is an $H$-torsor.

Summing up:
\begin{lemma}
  \label{lem:inducedtorsor}
   Let $f:\Hom(G,H)$ be a group homomorphism.
   If $X$ is a $G$-torsor, then the induced $H$-type $f_*X$ is an $H$-torsor and so we get an induced map
   $$f_*:\typetorsor_G\to\typetorsor_H.$$
   The identity
$\bar{\eta}:f_*\pathsp x^G=\pathsp{\Bf(x)}^H$
shows that
$$\xymatrix{\BG\ar[r]^{\Bf}\ar[d]^{\pathsp{}^G}&\BH\ar[d]^{\pathsp{}^H}\\
\typetorsor_G\ar[r]^{f_*}&\typetorsor_H}$$
commutes.
\end{lemma}
\begin{remark}
  \label{rem:inducedGsetfromabstracthomomorphisms}
  Notice that our construction of the induced $G$-set works equally well for a homomorphism $\phi:\Hom^\abstr(\abstr(G),\abstr(H))$:
  if $X:\BG\to\Set$ is a $G$-set, then we define the $H$-set $\phi_*X:\BH\to\Set$ by
  $$\phi_*X(y)\defequi(\shape_H=y)\times_{\USym G}X(\shape_G)$$
  to be the set quotient of $(\shape_H=y)\times X(\shape_G)$ by the relation $(p,x)\sim(p\, \phi(q)^{-1},X(q)x)$ for all $q:\shape_G=pt_G$.
  Just as above, for $X$ the principal $G$-torsor we get an identity  $\eta_\phi:\phi_*\princ G=\princ H$ which, when evaluated at $y:\BH$, corresponds under univalence to the equivalence
$$(\shape_H=y)\times_{\USym G}\USym G\to (\shape_H=y)$$
sending $[p,q]:(\shape_H=y)\times_{\USym G}\USym G$ to $p\,\phi(q):(\shape_H=y)$.
\end{remark}


\section{Groups; concrete vs.~abstract% -- same gem, different wrapping
}
\label{sec:Gsetforabstract}

We use \cref{lem:BGbytorsor} as our inspiration for trying to construct a group from an abstract group.
That is, in total analogy, we define the torsors for an abstract group,
and it will then be a relative simple matter to show that the processes of
\begin{enumerate}
\item forming the abstract group of a group and
\item taking the group represented by the torsors of an abstract group
\end{enumerate}
 are inverse to each other.
\marginnote{%
Note that we have not considered an ``abstract'' counterpart of the concept of $\infty$-group, so all we do in this section is set-based.
}
\begin{definition}
\label{def:abstrGtorsors}
If ${\agp G}=(S,e,\mu,\iota)$ is an abstract group, a \emph{$\agp G$-set}%
\index{Gset@$\agp G$-set (of abstract group)}
is a set $\mathcal X$ together with a homomorphism
$\agp G\to\abstr(\Sigma_{\mathcal X})$
from $\agp G$ to the (abstract) permutation group of $\mathcal X$:
$$Set_{\agp G}^\abstr\defequi \sum_{\mathcal X:\Set}\Hom_\abstr({\agp G},\abstr(\Sigma_{\mathcal X})).$$

The \emph{principal ${\agp G}$-torsor} $\princ {\agp G}^\abstr$ is the ${\agp G}$-set consisting of the underlying set $S$ together with the homomorphism ${\agp G}\to\abstr(\Sigma_{S})$ with underlying function of sets $S\mapsto (S=S)$ given by sending $g:S$ to $\mathrm{ua}(s\mapsto s\cdot g^{-1})$.

The type of \emph{${\agp G}$-torsors} is
$$\typetorsor_{\agp G}^\abstr\defequi\sum_{S:\Set_{\agp G}^\abstr}\Trunc{\princ {\agp G}^\abstr=S}.$$
\end{definition}
\begin{example}
  If $G$ is a group we can unravel the definition and see that an $\abstr(G)$-set consists of
  \begin{enumerate}
  \item a set $S$,
  \item a function $f:\USym G\to (S=S)$
  \item such that $f(e_G)=\refl{S}$ and for all $p,q:\USym G$ we have that $f(p\, q)=f(p)\,f(q)$.
  \end{enumerate}

\end{example}


To help reading the coming proofs we introduce some notation that is redundant, but may aid the memory in cluttered situations:  Let $x,y,z$ be elements in some type, then
\marginnote{We recognize $\preinv$ from \cref{lem:pathsptransportiseq} as the induced map of identity types $\pathsp{}\colon (y=z)\to(\pathsp y=\pathsp z)$ evaluated at $x$, while post-composition $\post$ is transport in the family $\pathsp x$.}
\begin{align*}
%  \pre:(x=y)\to ((y=z)=(x=z)),\qquad&\pre(q)(p)\defequi pq\\
  \preinv:(y=x)\to ((y=z)=(x=z)),\quad&\preinv(q)(p)\defequi\pathsp qp\defequi pq^{-1}\\
  \post:(y=z)\to ((x=y)=(x=z)),\quad&\post(p)(q)\defequi\post_pq\defequi pq\\
  %\adjoint:(x=y)\to((x=x)=(y=y)),\qquad&\adjoint(q)(p)\defequi\adjoint_qp\defequi qpq^{-1}
\end{align*}


\begin{example}\label{ex:qG}
  If $G$ is a group, then for any $x:\BG$ the principal $G$-torsor \emph{evaluated at $x$}, \ie the set $\princ Gx\defequi(\shape_G=x)$, has a natural structure of an $\abstr(G)$-set by means of
  $$\preinv:\USym G\to ((\shape_G=x)=(\shape_G=x))$$ and the fact that $\preinv(e_G)\defequi\refl{\shape_G=x}$ and that for $p,q:\USym G$ we have that
  \marginnote{\ie if $r\colon \shape_G=x$ we have that
$\preinv(p\, q)(r)=r(p\,q)^{-1}=r\,q^{-1}p^{-1}=\preinv(p)\preinv(q)(r)$  -- demonstrating why we chose $\preinv$: without the inverse this would have gone badly wrong.}
  $$\preinv(p\,q)=\preinv(p)\preinv(q).$$


That this $\abstr(G)$-set is an $\abstr(G)$-torsor then follows since $\BG$ is connected (any $\shape_G=x$ will serve as a proof of $(\shape_G=x,\preinv,!)=\princ{\abstr(G)}^\abstr$).

Though it sounded like we made a choice ending up with $\preinv$; we really didn't -- it is precisely what happens when you abstract the homomorphism $G\to\Sigma_{\princ G(x)}$:
you get the function of identity types
$$\USym G\to (\princ G(x)=\princ G(x))$$
which by the very definition of transport for $\princ G$ is $\preinv$.
\end{example}

\begin{definition}
  If ${\agp G}$ is an abstract group, then the \emph{concrete group $\concr({\agp G})$ associated with ${\agp G}$} is the group given by the pointed connected groupoid $(\typetorsor_{\agp G}^\abstr,\princ {\agp G})$.
\end{definition}
We give the construction of \cref{ex:qG} a short name since it will occur in important places.
\begin{definition}
  Let $G$ be a group.
  The group homomorphism
  $$q_G:\Hom(G,\concr(\abstr(G)))$$
  is defined in terms of the pointed map by the same name
$$q_G:\BG\to_* (\typetorsor^\abstr_{\abstr(G)},\princ {\abstr(G)}),\quad q_G(z)=(\princ G(z),\preinv,!).$$
\end{definition}

\begin{lemma}
  \label{lem:Groupsareidentitytypes}
For all groups $G$, the pointed function $q_G:G\to_*\concr(\abstr(G))$
is a  equivalence.
\end{lemma}
\begin{proof}
  To prove that $q_G$ is an equivalence it is, by \cref{cor:fib-vs-path}\ref{conn-fib-vs-path}, enough to show that if $x,y:\BG$ then the induced map
$$q_G:(x=_{\BG}y)\to (q_G(x)=q_G(y))
$$
is an equivalence.
  Now, $q_G(x)=q_G(y)$ is equivalent to the set
$$
((\shape_G=x),\preinv)=_{\abstr(G)\text{-set}}((\shape_G=y),\preinv)$$
which in turn is equivalent to
$$\sum_{f:(\shape_G=x)=(\shape_G=y)}f\preinv=\preinv f
$$
 ($f\preinv=\preinv f$ is shorthand for $\prod_{q:\shape_G=x}\prod_{p:\shape_G=p}f(pq^{-1})=f(p)q^{-1}$ and the rest of the data is redundant at the level of symmetries) and under these identities $q_G$ is given by
$$(\post,!):(x=y)\to \sum_{f:(\shape_G=x)=(\shape_G=y)}f\preinv=\preinv f.$$
Given an element
$(f,!):\sum_{f:(\shape_G=x)=(\shape_G=y)}f\preinv=\preinv f$, the preimage
$(\post,!)^{-1}(f,!)$ is equivalent to the set
$\sum_{r:x=y}(f=\post_r)$.  But if $(r,!),(s,!): \sum_{r:x=y}(f=\post_r)$, then for all $p:\shape_G=x$ we get that $r\,p=f(p)=s\,p$, that is $r=s$, so that the preimage is in fact a proposition.
To show that the preimage is contractible, it is enough to construct a function $(\shape_G=x)\to \sum_{r:x=y}(f=\post_r)$, and sending $p$ to $f(p)p^{-1}$ will do.
\end{proof}

\begin{example}
  \label{ex:abstrconcrG}
  Let ${\agp G}=(S,e,\mu,\iota)$ be an abstract group.
Then the underlying set of $\abstr(\concr({\agp G}))$ is $\princ {\agp G}^\abstr=_{\typetorsor^\abstr_{\agp G}}\princ {\agp G}^\abstr$.
Unraveling the definitions we see that this set is equivalent to
$$\sum_{p:S=S}\prod_{q,s:S}(p(s\,q^{-1})=p(s)\,q^{-1}).
$$
Setting $s\defequi e$ and renaming $t\defequi q^{-1}$ in the last equation, we see that $p(t)=p(e)t$; that is $p$ is simply multiplication with an element $p(e):S$.  in other words, the function
$$r_{\agp G}:S\to  \sum_{p:S=S}\prod_{q,s:S}(p(s\,q^{-1})=p(s)\,q^{-1}),\qquad r_{\agp G}(u)\defequi(u\cdot\,,!)
$$
is an equivalence of sets, which we by univalence is converted into an identity.
The abstract group structure of $\abstr(\concr({\agp G}))$ is given by it being the symmetries of $\princ {\agp G}^\abstr$; translated to $\sum_{p:S=S}\prod_{q,s:S}(p(s\,q^{-1})=p(s)\,q^{-1})$ this corresponds via the first projection to the symmetries of $S$.
This means that we need to know that if $u,v:S$ and consider the two symmetries $u\cdot,v\cdot:S=S$, then their composite (the operation on the symmetry on $S$) is equal to $(u\cdot v)\cdot:S=S$ (the abstract group operation), but this is true by associativity ($u\cdot(v\cdot s)=(u\cdot v)\cdot s$).  That $r_{\agp G}$ also sends $e:S$ to $\refl S$ is clear.
Hence our identity $r_{\agp G}$ underlies an identity of abstract groups
$$r_{\agp G}:{\agp G}=_{\typegroup^\abstr}\abstr(\concr({\agp G})).$$
\end{example}

This shows that every abstract group encodes the symmetries of something essentially unique.  Summing up the information we get
\begin{theorem}
  \label{thm:Groupsareidentitytypes}
  Let ${\agp G}$ be an abstract group. Then
$$\abstr:\typegroup\to\typegroup^\abstr$$ is an equivalence.
\end{theorem}

\section{Homomorphisms; abstract vs.~concrete}
\label{sec:homabsisconcr}

Now that we know that the type of groups is identical to the type of abstract groups, it is natural to ask if the notion of group homomorphisms also coincide.

They do, and we provide two independent and somewhat different arguments.  Translating from group homomorphisms to abstract group homomorphisms is easy: if $G$ and $H$ are groups, then we defined
$$\abstr:\Hom(G,H)\to\Hom^\abstr(\abstr(G),\abstr(H))$$
in \cref{def:abstrisfunctor} as the function which takes a homomorphism, aka a pointed map $f=(\Bf_\div,p_f):\BG\ptdto\BH$ to the induced map of identity types
$$\US f\defequi \mathrm{ad}_{p_f}\ap{\Bf_\div}:\USym G\to\USym H$$
 together with the proofs that this is an abstract group homomorphism from $\abstr(G)$ to $\abstr(H)$, c.f~\cref{def:abstrisfunctor}.


Going back is somewhat more involved, and it is here we consider two approaches.
The first is a compact argument showing directly how to reconstruct a pointed map $\Bf:\BG\ptdto\BH$ from an abstract group homomorphism from $\abstr(G)$ to $\abstr(H)$, the second translates back and forth via our equivalence between abstract and concrete groups.



The statement we are after is


\begin{lemma}
  \label{lem:homomabstrconcr}
  If $G$ and $H$ are groups, then
$$\abstr:\Hom(G,H)\to\Hom^\abstr(\abstr(G),\abstr(H))$$
is an equivalence.
\end{lemma}
and the next two subsections offer two proofs.



\sususe{``Delooping'' a group homomorphism}
\label{sec:delooping} %after Coquand, after Deligne
We now explore the first approach.
It might be helpful to review \cref{lem:S1-delooping}
for a simple example of delooping in the special case of the circle.
Here we elaborate the general case.

\begin{proof}
  Suppose we are given an abstract group homomorphism
$$f:\Hom^\abstr(\abstr(G),\abstr(H))$$
and we explain how to build a map $g:\BG_\div \rightarrow \BH_\div$ with
a path $p:\shape_H = g(\shape_G)$ such that $p f(\omega) = g(\omega) p$
for all $\omega:\shape_G = \shape_G$ (so that $g$ is a ``delooping'' of $f$, that is, $f=\abstr(g)$).
\marginnote{We will thus have displayed a map $\mathrm{deloop}:\Hom^\abstr(\abstr(G),\abstr(H))\to\Hom(G,H)$ with $\abstr\,\mathrm{deloop}=\refl{}$. We leave it to the reader to prove that $\mathrm{deloop}\,\abstr=\refl{}$. }

To get an idea of our strategy, let us assume the problem solved. The map $g:\BG_\div\rightarrow \BH_\div$
will then send any path $\alpha:{\shape_G} = x$ to a path $g(\alpha):g({\shape_G}) = g(x)$
and so we get a family of paths $p(\alpha) \defequi g(\alpha) p$ in ${\shape_H} = g(x)$ such that
$$p(\alpha\omega) = g(\alpha)g(\omega)p
  = g(\alpha)pf(\omega) = p(\alpha)f(\omega)$$
for all $\omega:{\shape_G} = {\shape_G}$ and $\alpha : {\shape_G} = x$.

This suggests to introduce the following family
$$
C(x)~:=~ \sum_{y:\BH_\div}\sum_{p:({\shape_G}=x)\rightarrow ({\shape_H} = y)}~~~\prod_{\omega:{\shape_G}={\shape_G}}\prod_{\alpha:{\shape_G}=x}~
 p(\alpha\omega) = p(\alpha)f(\omega)
$$
 An element of $C(x)$ has three components, the last component being
 a proposition since $\BH_\div$ is a groupoid.

 The type $C({\shape_G})$ has a simpler description. An element of $C({\shape_G})$ is
 a pair $y,p$ such that $p(\alpha\omega) = p(\alpha)f(\omega)$ for
 $\alpha$ and $\omega$ in ${\shape_G}={\shape_G}$.
 Since $f$ is an abstract group homomorphism, this condition
 can be simplified to $p(\omega) = p(1_{\shape_G})f(\omega)$, and the map $p$
 is completely determined by $p(1_{\shape_G})$.
 Thus $C({\shape_G})$ is equal to $\sum_{y:\BH_\div}{\shape_H} = y$ and is contractible.


 It follows that we have
 $$
 \prod_{x:\BG_\div}~ ({\shape_G} = x)\rightarrow\iscontr~ C(x)
 $$
and so, since $\iscontr~C(x)$ is a proposition
 $$
 \prod_{x:\BG_\div}~ \Trunc{a = x}\rightarrow\iscontr~ C(x)
 $$
 Since $\BG_\div$ is connected, we have
 $\prod_{x:\BG_\div}\iscontr~ C(x)$
 and so, in particular, we have an element of $\prod_{x:\BG_\div}C(x)$.

 We get in this way a map $g:\BG_\div\rightarrow \BH_\div$
 together with a map $p:(a=x)\rightarrow ({\shape_H} = g(x))$ such that
 $p (\alpha\omega) = p(\alpha) f(\omega)$
 for all $\alpha$ in ${\shape_G}=x$ and $\omega$ in ${\shape_G}={\shape_G}$.
We have, for $\alpha:{\shape_G}=x$
$$\prod_{x':\BG_\div}\prod_{\lambda:x=x'}~p(\lambda\alpha) = g(\lambda)p(\alpha)$$
since this holds for $\lambda = 1_x$.
In particular, $p(\omega) = g(\omega)p(1_{\shape_G})$.

We also have $p(\omega) = p(1_{\shape_G})f(\omega)$, hence
$p(1_{\shape_G})g(\alpha) =  f(\alpha)p(1_{\shape_G})$
for all $\alpha:\shape_G=\shape_G$ and we have found a delooping of $f$.

%Security copy if things go wrong. BID: delete by May 1
%   Let $(X,a)$ and $(Y,b)$ be two pointed connected $1$-types.
% We suppose given a abstract group homomorphism
% $$f:a = a\rightarrow b = b$$
% and we explain how to build a map $g:X \rightarrow Y$ with
% a path $p:b = g(a)$ such that $p f(\omega) = g(\omega) p$
% for all $\omega:a = a$. (So $g$ is a ``delooping'' of $f$.)

% \medskip

% Let us assume the problem solved. The map $g:X\rightarrow Y$
% will then send any path $\alpha:a = x$ to a path $g(\alpha):g(a) = g(x)$
% and so we get a family of paths $p(\alpha) = g(\alpha) p$ in $b = g(x)$ such that
% $$p(\alpha\omega) = g(\alpha)g(\omega)p
%   = g(\alpha)pf(\omega) = p(\alpha)f(\omega)$$
% for all $\omega:a = a$ and $\alpha : a = x$.

% \medskip

% This suggests to introduce the following family
% $$
% C(x)~:=~ \sum_{y:Y}\sum_{p:(a=x)\rightarrow (b = y)}~~~\prod_{\omega:a=a}\prod_{\alpha:a=x}~
%  p(\alpha\omega) = p(\alpha)f(\omega)
% $$

%  An element of $C(x)$ has three components, the last component being
%  a proof since $Y$ is a $1$-type.

%  The type $C(a)$ has a simpler description. An element of $C(a)$ is
%  a pair $y,p$ such that $p(\alpha\omega) = p(\alpha)f(\omega)$ for
%  $\alpha$ and $\omega$ in $a=a$. Since $f$ is a group morphism, this condition
%  can be simplified to $p(\omega) = p(1_a)f(\omega)$, and the map $p$
%  is completely determined by $p(1_a)$.
%  Thus $C(a)$ is equal to $\sum_{y:Y}b = y$ and is contractible.

%  \medskip

%  It follows that we have
%  $$
%  \prod_{x:X}~ a = x\rightarrow\iscontr~ C(x)
%  $$
% and so, since $\iscontr~C(x)$ is a proposition
%  $$
%  \prod_{x:X}~ \Trunc{a = x}\rightarrow\iscontr~ C(x)
%  $$
%  Since $X$ is connected, we have
%  $\prod_{x:X}\iscontr~ C(x)$
%  and so, in particular, we have an element of $\prod_{x:X}C(x)$.

%  We get in this way a map $g:X\rightarrow Y$
%  together with a map $p:(a=x)\rightarrow (b = g(x))$ such that
%  $p (\alpha\omega) = p(\alpha) f(\omega)$
%  for all $\alpha$ in $a=x$ and $\omega$ in $a=a$.
% We have, for $\alpha:a=x$
% $$\prod_{x':X}\prod_{\lambda:x=x'}~p(\lambda\alpha) = g(\lambda)p(\alpha)$$
% since this holds for $\lambda = 1_x$.
% In particular, $p(\omega) = g(\omega)p(1_a)$.

% We also have $p(\omega) = p(1_a)f(\omega)$, hence
% $p(1_a)g(\alpha) =  f(\alpha)p(1_a)$
% for all $\alpha:a=a$ and we have found a delooping of $f$.
\end{proof}


\sususe{The concrete vs. abstract homomorphisms via torsors.}
\label{sec:absconctorsor}

The second approach to \cref{lem:homomabstrconcr} is as follows:


\begin{proof}
  The equivalence of $\pathsp{}^G:\BG\we(\typetorsor_G,\princ G)$ of \cref{lem:BGbytorsor} gives an equivalence
$$\pathsp{}:\Hom(G,H)\we((\typetorsor_G,\princ G)\to_*(\typetorsor_H,\princ H))
$$
Consider the map
$$A:((\typetorsor_G,\princ G))\to_*(\typetorsor_H,\princ H)\to \Hom^\abstr(\abstr(G),\abstr(H))$$
given by letting $A(f,p)$ be the composite
$$\xymatrix{\USym G\ar@{=}[d]^{\pathsp{}^G}_\downarrow&&&
  \USym H\ar@{=}[d]^{\pathsp{}^H}_\downarrow\\
  (\princ G=\princ G)\ar[r]^-f&
  (f\princ G=f\princ G)\ar@{=}[rr]^-{q\mapsto p^{-1}qp}_\to&&
  (\princ H=\princ H)
}$$
(together with the proof that this is an abstract group homomorphism).  We
are done if we show that $A$ is an equivalence.
\marginnote{The reason to complicate $\abstr$ this way is that it gets easier to write out the inverse function.}

If $(\phi,!):\Hom^\abstr(\abstr(G),\abstr(H))$ and $X:\BG\to\Set$ is a $G$-torsor, recall the induced $H$-torsor $\phi_*X$ from \cref{rem:inducedGsetfromabstracthomomorphisms} and the identity $\eta_\phi:\phi_*\princ G=\princ H$.
Let
$$B: \Hom^\abstr(\abstr(G),\abstr(H))\to ((\typetorsor_G,\princ G)\to_*(\typetorsor_H,\princ H)$$
be given by $B(\phi,!)=(\phi_*X,\eta_\phi)$

We show that $A$ and $B$ are inverse equivalences.  Given an abstract group homomorphism $(\phi,!):\Hom^\abstr(\abstr(G),\abstr(H))$, then $AB(\phi,!)$ has as underlying set map
$$\xymatrix{\USym G\ar@{=}[d]^{\pathsp{}^G}_\downarrow&&&
  \USym H\ar@{=}[d]^{\pathsp{}^H}_\downarrow\\
  (\princ G=\princ G)\ar[r]^-{\phi_*}&
  (\phi_*\princ G=\phi_*\princ G)\ar@{=}[rr]^-{q\mapsto \eta_\phi^{-1}q\eta_\phi}_\to&&
  (\princ H=\princ H),
}$$
and if we start with a $g:\USym G$, then $\pathsp{}^G$ sends it to $\pathsp g^G\oldequiv\preinv (g)$.  Furthermore, $\phi_*\preinv (g)$ is $[\id,\preinv (g)]$ which is sent to $\preinv (\phi(g))$ in $\princ H=\princ H$ which corresponds to $\phi(g):\USym H$ under $\pathsp{}^H$.  In other words, $AB(\phi,!)=(\phi,!)$.  The composite $BA$ is similar.
\end{proof}


\section{Monomorphisms and epimorphisms}
\label{sec:monoepi}

In set theory we say that a function $f:B\to C$ of sets is an injection if for all $b,b':B$ we have that $f(b)=f(b')$ implies that  $b=b'$.  This conforms with our definitions.
%\footnote{This continues to be true in type theory, but since equality needs not be unique, we should in addition require that the two identities $p, f(\sigma(p)):f(b)=f(b')$ are equal.}
Furthermore, since giving a term $b:B$ is equivalent to giving a (necessarily constant) function $c_b:\bn 1\to B$, we could alternatively say that a function $f:B\to C$ is an injection if and only if for any two $g,h:\bn 1\to B$ such that $fg=fh$ we have that $g=h$.  In fact, by function extensionality we can replace $\bn 1$ by any set $A$ (two functions are identical if and only if they have identical values at every point).

Similarly, a function $f:B\to C$ is surjective if for all $c:C$ the preimage $f^{-1}(c)=\sum_{b:B}c=f(b)$ is non-empty.  A smart way to say this is to say that the first projection from $\sum_{c:C}\Trunc{f^{-1}(c)}$ to $C$ is an equivalence.  Since $B$ is always equivalent to $\sum_{c:C}f^{-1}(c)$, we see that for a surjection $f:B\to C$ and family of propositions $P:C\to \Prop$, the propositions $\prod_{c:C}P(c)$ and $\prod_{b:B}Pf(b)$ are equivalent.  In particular, if $g,h:C\to D$ are two functions into a set $D$ the proposition $\prod_{c:C}(g(c)=h(c))$ is equivalent to $\prod_{b:B}(gf(b)=hf(c))$.

From this we condense the following characterizations of injections and surjections of sets which will prove to generalize nicely to other contexts.
% In other words, an injection between sets is a function $f:B\to C$ such that for any set $A$ and functions $g,h:A\to B$ such that $fg=fh:A\to C$
% $$\xymatrix{A\ar[r]^f&B\ar@<1ex>[r]^g\ar@<-1ex>[r]_h&C}$$
% we necessarily have that $g=h$.
\begin{lemma}
  \label{lem:injofsetsaremono}Let $f:B\to C$ be a function between sets.
  \begin{enumerate}
  \item the function is an injection of and only if for any set $A$ and functions $g,h:A\to B$,
$$\xymatrix{A\ar@<1ex>[r]^g\ar@<-1ex>[r]_h&B\ar[r]^f&C},$$  then $fg=fh:A\to C$ implies $g=h$
\item the function is an injection of and only if for any set $D$ and functions $g,h:C\to D$,
$$\xymatrix{B\ar[r]^f&C\ar@<1ex>[r]^g\ar@<-1ex>[r]_h&D},$$  then $gf=hf:A\to C$ implies $g=h$.
  \end{enumerate}
\end{lemma}


By \cref{lem:injofsetsaremono} there is a pleasing reformulation which highlights that injections/surjections of sets are characterized by injections of sets of functions: a function of sets $f:B\to C$ is
\begin{enumerate}
\item  an injection if and only if for any set $A$ postcomposition by $f$ given an injection from $A\to B$ to $A\to C$
\item a surjection if and only if for any set $D$ precomposition by $f$ gives an injection from $B\to D$ to $B\to D$.
\end{enumerate}

This observation about sets translates fruitfully to other contexts and in particular to groups.  To make it clear that we talk about group homomorphisms (and not about the underlying unpointed functions of connected groupoids) we resort to standard categorical notation.
\begin{definition}\label{def:monomorphism}
Given groups $G,H$, a homomorphism $f: \Hom(G,H)$ is called a\label{def:epimorphism}
\begin{enumerate}
\item \emph{monomorphism}\index{monomorphism!of groups} if for any group $F$,
  postcomposition by $f$ is an injection from $\Hom(F,G)$ to $\Hom(F,H)$, and an
\item \emph{epimorphism}\index{epimorphism!of groups} if for any group $I$,
  precomposition by $f$ is an injection from $\Hom(H,I)$ to $\Hom(G,I)$.
\end{enumerate}
The corresponding families of propositions are called
\[
  \ismono,\isepi:\Hom(G,H)\to\Prop.\qedhere
\]
\end{definition}

\marginnote{$$\xymatrix{\USym G\ar[d]^\simeq\ar[r]^{\US f}&\USym H\ar[d]^\simeq\\
    \Hom(\ZZ,G)\ar[r]^{f_*}\ar[d]^\simeq_\abstr&\Hom(\ZZ,H)\ar[d]^\simeq_\abstr\\
    \Hom^{\abstr}(\ZZ,\abstr(G))\ar[r]^{\abstr f_*}&\Hom^{\abstr}(\ZZ,\abstr(H))
 }$$
commutes (we've written $\ZZ$ also for $\abstr(\ZZ$) since otherwise it wouldn't fit.}
We've seen that for any group $G$, the underlying set $\USym G\defequi(\shape_G=\shape_G)$ of $\abstr(G)$ is equivalent to the set of homomorphisms $\Hom(\ZZ,G)$ which in turn is equivalent to the set of abstract homomorphisms $\Hom^{\abstr}(\abstr(\ZZ),\abstr(G))$ and that abstraction preserves composition.
Hence, if $f:\Hom(G,H)$ is a group homomorphism, then saying that
$\US f$ is an injection is equivalent to saying that postcomposition by $f$ is an injection $\Hom(\ZZ,G)\to\Hom(\ZZ,H)$.
In this observation, the integers $\ZZ$ plays no more of a r\^ole than $\bn 1$ does in \cref{lem:injofsetsaremono}; we can let the source vary over any group $F$:


\begin{lemma}\label{lem:eq-mono-cover}
Let $G$ and $H$ be groups and $f: \Hom(G,H)$ a homomorphism.
The following propositions are equivalent:\label{lem:eq-epi-conn}
\begin{enumerate}
\item\label{it:mono} $f$ is a monomorphism;
\item\label{it:injection} $\US f:\USym G\to\USym H$ is an injection;
\item\label{it:cover} $\Bf_\div:\BG_\div\to \BH_\div$ is a \covering.
\end{enumerate}
\end{lemma}

\begin{proof}
  We have already seen that condition~\ref{it:mono} implies condition~\ref{it:injection} (let $F$ be $\ZZ$).
    Conversely, suppose that \ref{it:injection} holds and $F$ is a group.  Consider the commutative diagram
$$\xymatrix{\Hom(F,G)\ar[r]\ar[d]&\Hom(F,H)\ar[d]\\
  (\Hom(\ZZ,F)\to\Hom(\ZZ,G))\ar[r]&(\Hom(\ZZ,F)\to\Hom(\ZZ,H)),}$$
where the vertical maps are the injections from the sets of (abstract) homomorphism to the sets of functions of underlying sets and the horizontal maps are postcomposition with $f$.  Since the bottom function is by assumption is an injection, so is the upper one.
\footnote{ Alternatively:  and $g,h:\Hom(F,G)$.  Then $fg=fh$ implies that for all $p:\Hom(\ZZ,F)$ we have by associativity that $f(gp)=(fg)p=(fh)p=f(hp)$, and so, by assumption, that $gp=hp$.
  Again, by function extensionality (of functions $\Hom(\ZZ,F)\to\Hom(\ZZ,G)$), this is exactly saying that $\US g$ is identical to $\US h$.}

  The equivalence of \ref{it:cover} and \ref{it:injection} follows
immediately from \cref{cor:fib-vs-path}\ref{set-fib-vs-path}, using
that $\BG$ is connected and $f$ is pointed and the equivalence between $\Hom(G,H)$ and $\BG\ptdto \BH$.
\end{proof}

Similarly, we have:
\begin{lemma}\label{lem:epi-surj}
  The following propositions are equivalent:
\begin{enumerate}[label=(\arabic*')]
\item\label{it:epi} $f$ is an epimorphism;
\item\label{it:surjection} $\US f:\USym G\to\USym H$ is a surjection.
\item\label{it:connfib} $\Bf_\div:\BG_\div\to \BH_\div$ has connected fibers.
\end{enumerate}
\end{lemma}

\begin{proof}
  The equivalence of \ref{it:surjection} and \ref{it:connfib} is immediate.

  For the rest, the easy direction is that \ref{it:surjection} implies \ref{it:epi}:
  (TODO)

  The harder direction, that \ref{it:epi} implies \ref{it:surjection},
  is a corollary of the following lemma, which states that monos are equalizers.
  Indeed, we can factor any $f : \Hom(G,H)$ via the image as a surjection followed
  by a mono:
  \[
    \begin{tikzcd}[cramped]
      G \ar[r,"q"] & \im(f) \ar[r,"i"] & H
    \end{tikzcd}
  \]
  If $f$ is an epi, then so is $i$. But $i$ is an equalizer,
  \[
    \begin{tikzcd}[cramped]
      \im(f) \ar[r,"i"] & H\ar[r,shift left,"\varphi"]
      \ar[r,shift right,"\psi"'] & L,
    \end{tikzcd}
  \]
  so as an epi, $\varphi i = \psi i$ implies $\varphi = \psi$, so $i$
  is an equalizer of already equal homomorphisms, so $i$ is an isomorphism,
  which implies that $f$ is surjective.
\end{proof}

\begin{lemma}\label{lem:monos-are-equalizers}
  Every monomorphism $i : H \to G$ is an equalizer.\footnote{%
    This proof follows an idea by \citeauthor{TrimbleEpisSurjective}\footnotemark{}.}%
  \footcitetext{TrimbleEpisSurjective}
\end{lemma}
\begin{proof}[Proof draft.] Consider the projection $\pi : G \to G/H$ to the set of cosets.
  Let $j : G/H \to A$ be an injection into a group $A$.
  (We could for instance let $A$ be the free (abelian) group on $G/H$. [Add xref to statement that inclusion of generators in an injection.])

  Consider the group $W \defeq \Aut_E(\sh_G,\cst{\sh_A})$, where
  \[
    E \defeq \sum_{t : \BG}\bigl((\sh_G \eqto t) \to \BA\bigr).
  \]
  We have two homomorphisms $\varphi,\psi : G \to W$ with the same underlying map,
  $t \mapsto (t , \cst{\sh_A})$, but with different pointing paths:
  \[
    \varphi_\pt \defeq \refl{\sh_G,\cst{\sh_A}}, \quad
    \psi_\pt \defeq (\refl{\sh_G}, j\pi).
  \]
  The equalizer of $\varphi$ and $\psi$ thus consists of all $g:\UG$
  such that $j\pi(gg') = j\pi(g')$ for all $g':\UG$. Since $j$ is injective,
  this is equivalent to $\pi(gg')=\pi(g')$ for all $g':\UG$, and this holds
  if and only if $g$ belongs to $H$.
\end{proof}

\subsection{Any symmetry is a symmetry in $\Set$}
\label{sec:groupssubperm}


The correspondence between groups and abstract groups allows for a cute proof of what is often stated as ``any group is a permutation group'', which in our parlance translates to ``any symmetry is a symmetry in $\Set$''.
% \footnote{which reminds me of the following: my lecturer in cosmology once tried to publish a paper about rotating black holes, only to have it rejected because it turned out that it was his universe, not the black hole, that was rotating}

Recall the principal $G$-torsor $\princ G:\BG\to\Set$.
Since $\princ G(\shape_G)\defequi \USym G$ this defines a pointed function $\rho_G:\BG\to_* \BSigma_{\USym G}\defequi(\conncomp \Set {\USym G},\USym G)$,
\marginnote{the letter $\rho$ commemorates the word ``regular''} \ie a homomorphism from $G$ to the permutation group
$$\rho_G:\Hom(G,\Sigma_{\USym G}).$$
\begin{theorem}[Cayley]
  \label{lem:allgpsarepermutationgps}
  \marginnote{By \cref{lem:eq-mono-cover} ``$\rho_G$ is a monomorphism'' means that the induced map $\rho_G^\abstr$ from the symmetries of $\shape_G$ in $\BG_\div$ to the symmetries of $\USym G$ in $\Set$ is an injection, \ie ``any symmetry is a symmetry in $\Set$''.}Let $G$ be a group. Then
  $\rho_G:\Hom(G,\Sigma_{\USym G})  $ is a monomorphism.
\end{theorem}
\begin{proof}
  In view of \cref{lem:eq-mono-cover} we need to show that $\rho_G:\BG\to \conncomp \Set {\USym G}$ is a
  \covering.
  Under the identity
  $$\bar{\pathsp{}}:\BG=(\typetorsor_G,\princ G)\oldequiv (\conncomp{\Set}{\USym G},\USym G)$$ of
  \cref{lem:BGbytorsor}, $\rho_G$ translates to the
  evaluation map
  $$\mathrm{ev}_{\shape_G}:\conncomp{(\BG\to\Set)}{\princ G}\to\conncomp{\Set}{\USym G},\qquad
  \mathrm{ev}_{\shape_G}(E)=E(\shape_G).$$
  We must show that the preimages
  $\inv{\ev_{\shape_G}}(X)$ for $X:\Sigma_{\USym G}$ are sets.  This
  fiber is equivalent to
  $\sum_{E:\conncomp{(\BG\to\Set)}{\princ G}}(X=E(\shape_G))$ which is a
  set precisely when $\sum_{E:\BG\to\Set}(X=E(\shape_G))$ is a set.  We
  must then show that if $(E,p),(F,q):\sum_{E:\BG\to\Set}(X=E(\shape_G))$,
  then the type $(E,p)=(F,q)$, which is equivalent
  \marginnote{Note that if $r:\shape_G=x$, then
  $\phi(x)=F(r)qp^{-1}E(r)^{-1}$, in a picture
  \begin{displaymath}
    \xymatrix{&E(pt_G)\ar@{=}[r]^{E(r)}_\to\ar@{=}[dd]_{\phi(pt_G)}^\downarrow&E(x)\ar@{=}[dd]_{\phi(x)}^\downarrow\\
      X\ar@{=}[ur]^p_{\rotatebox{35}{\footnotesize$\to$}}\ar@{=}[dr]^q_{\rotatebox{-35}{\footnotesize$\to$}}&&\\
      &F(\shape_G)\ar@{=}[r]^{F(r)}_\to&F(x)},
  \end{displaymath}
and so $\phi(x)$ (which by nature is independent of such an
$r:\shape_G=x$) is uniquely determined by $(E,p)$ and $(F,q)$. The text says this formally.}
to
  $$\prod_{x:\BG}\sum_{\phi(x):E(x)=F(x)}\phi(\shape_G)=qp^{-1},$$
  is a proposition.
If $\phi,\psi:((E,p)=(F,q))$, we
  must show that $\phi=\psi$ and since that for $x:\BG$ both $E(x)$ and
  $F(x)$ are sets, it is enough to show that the proposition
  $\phi(x)=\psi(x)$ is not empty.  Let
  $f:(\shape_G=x)\to(\phi(x)=\psi(x))$ be given by letting $f(r)$ be the
  composite of the identities $\phi(x)=F(r)qp^{-1}E(r)^{-1}=\psi(x)$
  given above.  Since $\BG$ is connected, and $\phi(x)=\psi(x)$ is a
  proposition, one can consider that $\shape_G=x$ is not empty, and we
  are done.
\end{proof}


\section{Abelian groups}
\label{sec:abelian-groups}

%% Remove/modify once the rest of the section is being refactored with
%% new notation/style for identity types.
Recall that given a pointed type $X$, we coerce it silently to its
underlying unpointed type $X_\div$ whenever this coercion can be
inferred from context. For example, given a group $G$, the type
$\BG\weq \BG$ can not possibly mean anything but
$\BG_\div\simeq \BG_\div$ as the operator ``$\weq$'' acts on bare
types. To refer to the type of pointed equivalences (that is the
pointed functions whose underlying functions are equivalences), we
shall use the notation $\BG \ptdweto \BG$.%

\subsection{Center of a group}
\label{sec:center-group}

\begin{definition}
  Let $G$ be a group. The {\em center} of $G$, denoted
  $\grpcenter(G)$, is the group
  $\Aut_{(\BG_\div\eqto\BG_\div)}(\refl{\BG_\div})$.%
  \marginnote{%
    We work transparently through the equivalence
    \begin{displaymath}
      (\BG_\div=\BG_\div) \weq (\BG \weq \BG)
    \end{displaymath}
    so that $\id_{\BG_\div}$ is freely used in place of
    $\refl {\BG_\div}$ when convenient.%
  }%
\end{definition}

There is a natural map
$\ev_{\shape_G} : (\BG_\div\eqto\BG_\div) \to \BG_\div$ defined by
$\ev_{\shape_G}(\varphi)\defequi \varphi(\shape_G)$, where the path
$\varphi$ is coerced to a function through univalence. In particular,
$\ev_{\shape_G}(\refl{\BG_\div}) \jdeq \shape_G$. It makes the
restriction of this map to the connected component of
$\refl{\BG_\div}$ a pointed map. In other words, it defines a group
homomorphism
\begin{displaymath}
  \grpcenterinc G : \Hom(\grpcenter(G), G).
\end{displaymath}
such that $\B \grpcenterinc G \defequi \ev_{\shape_G}$. We will now
justify the name {\em center} for $\grpcenter(G)$, and connect it to
the notion of center for abstract groups in ordinary mathematics. The
homomorphism $\grpcenterinc G$ induces a homomorphism of abstract
groups from $\abstr(\grpcenter(G))$ to $\abstr(G)$. By induction on
$p:\refl{\BG_\div} \eqto \varphi$ for
$\varphi:\BG_\div \eqto \BG_\div$, one proves that
$\ap{\B \grpcenterinc G}(p) = p(\shape_G)$: indeed, this is true when
$p\jdeq \refl {\refl{\BG_\div}}$. One proves furthermore, again by
induction on $p:\refl{\BG_\div} \eqto \varphi$, that
$\ap \varphi = (q\mapsto \inv{p(\shape_G)} q p(\shape_G))$. In
particular, when $\varphi \jdeq \refl{\BG_\div}$, it shows that for
every $p:\refl{\BG_\div}\eqto\refl{\BG_\div}$, the following proposition
holds:
\begin{displaymath}
  \prod_{g:\USym G }p(\shape_G) g = g p(\shape_G)
\end{displaymath}
In other words, $\abstr{(\grpcenterinc G)}$ maps elements of
$\abstr(Z(G))$ to elements of $\abstr(G)$ that commute with every
other elements. (The set of these elements is usually called the
center of the group $\abstr(G)$ in ordinary group theory.)

\begin{lemma}
  \label{lemma:center-is-subgroup}%
  The map $\B \grpcenterinc G$ is a \covering over $\BG$.
\end{lemma}
\begin{proof}
  One wants to prove the proposition
  $\isset(\inv{(\B\grpcenterinc G)}(x))$ for each $x:\BG$. By
  connectedness of $\BG$, it reduces to showing the proposition only
  at $x\jdeq \shape_G$. However,
  \begin{displaymath}
    \inv{(\B\grpcenterinc G)}(\shape_G) \defequi \sum_{\varphi:{\B\grpcenter(G)}}{\shape_G \eqto \varphi(\shape_G)}
  \end{displaymath}
  Recall that $\B\grpcenter(G)$ is the connected component of
  $\refl{\BG_\div}$ in $\BG_\div \eqto \BG_\div$. In particular, if
  $(\varphi,p)$ and $(\psi,q)$ are two elements of the type on the
  right hand-side above, %  their identity type
  % $(\varphi,p)\eqto(\psi,q)$ is equivalent to their identity type in
  % $\BG_\div \eqto \BG_\div$, or in other words
  the characterization of identity types in sum types gives an
  equivalence:
  \begin{displaymath}
    ((\varphi,p) \eqto (\psi,q)) \equivto \sum_{\pi:\varphi\eqto\psi}\pi(\shape_G) p = q.
  \end{displaymath}
  We shall prove that the type on the right is a proposition, and it goes as
  follows:
  \begin{enumerate}
  \item for $\pi:\varphi\eqto\psi$, the type $\pi(\shape_G) p = q$ is a
    proposition; hence $\sum_{\pi:\varphi\eqto\psi}\pi(\shape_G) p = q$ is a
    subset of the set $\varphi \eqto \psi$, so for elements $(\pi,!)$ and
    $(\pi',!)$ of the subset, we have to prove $\pi=\pi'$,
  % \item for all $x:\BG$, $\varphi(x)=\psi(x)$ is a set, hence for
  %   $\pi,\pi':\varphi=\psi$, the type $\pi=\pi'$ is a proposition,
  \item because $\pi=\pi'$ is a proposition, by connectedness of $\BG$, it is
    enough to prove $\pi(\shape_G)=\pi'(\shape_G)$,
  \item finally the propositional condition on $\pi$ and $\pi'$ allows us to
    conclude that $\pi(\shape_G)= q\inv p = \pi'(\shape_G)$.
  \end{enumerate}
\end{proof}

\begin{corollary}
  \label{lemma:center-inc-inj-on-paths}%
  The induced map
  $\abstr {(\grpcenterinc G)}: \abstr(\grpcenter(G)) \to \abstr(G)$ is
  injective.
\end{corollary}

The following result explains how every element of the ``abstract
center'' of $G$ is picked out by $\abstr{(\grpcenterinc G)}$.
\begin{lemma}
  \label{lemma:center-inc-surj-on-paths}%
  Let $g:\USym G$ and suppose that $gh=hg$ for every
  $h:\USym G$. The fiber $\inv{(\ap {\B\grpcenterinc G})}(g)$ contains
  an element.
\end{lemma}
\begin{proof}
  One must construct an element $\hat g:\refl{\BG_\div} = \refl{\BG_\div}$ such
  that $g=\hat g(\shape_G)$. We shall use function extensionality and produce an
  element $\hat g(x):x\eqto x$ for all $x:\BG$ instead. Note that $x\eqto x$ is
  a set, and that connectedness of $\BG$ is not directly applicable here. We
  will use a technique that has already proven useful in many situations in the
  book, along the lines of the following sketch:
  \begin{enumerate}
  \item for a given $x:\BG$, if such a $\hat g(x):x\eqto x$ existed, it would
    produce an element of the type $T(\hat g(x))$ for a carefully chosen type
    family $T$,
  \item aim to prove $\iscontr(\sum_{u:x\eqto x}T(u))$ for any $x:\BG$,
  \item this is a proposition, so connectedness of $\BG$ can be applied
    and only $\iscontr(\sum_{u:\USym G}T(u))$ needs to be proven,
  \item hopefully, $\sum_{u:\USym G}T(u)$ reduces to an obvious
    singleton type.
  \end{enumerate}
  Here, for any $x:\BG$, we define the type family $T: (x\eqto x) \to \UU$
  by
  \begin{displaymath}
    T(q) \defequi \prod_{p:\shape_G\eqto x} (pg=qp).
  \end{displaymath}
  And we claim that $\sum_{q:x\eqto x}T(q)$ is contractible for any
  $x:\BG$. Because this is a proposition, one only need to check that it holds
  on one point of the connected type $\BG$, say $x\jdeq \shape_G$. We consider
  the following composition of equivalences:
  \begin{displaymath}%
    \begin{aligned}
      \sum_{q:\USym G}T(q) &\jdeq
      \sum_{q:\USym G}\prod_{p:\USym G}(pg=qp)
      \\
      &\equivto \sum_{q:\USym G}\prod_{p:\USym G}(g=q)
      \\
      &\equivto \sum_{q:\USym G}\USym G\to (g=q)
      \\
      &\equivto \sum_{q:\USym G}\Trunc{\USym G}\to (g=q)
      \\
      &\equivto \sum_{q:\USym G} (g=q)
      \\
      &\equivto 1
    \end{aligned}
  \end{displaymath}%
  % \marginnote[-10\baselineskip]{%
  In that composition, the first equivalence is using that $g$ commutes with
  every other element $p:\USym G$, so that $pg \inv p = g$. The second
  equivalence acknowledges the fact that the codomain $(g=q)$ does not depend on
  $p$ anymore, so that the dependent function type inside the sum is a simple
  function type. The third equivalence uses the universal property of
  propositional truncation under the sum. The fourth equivalence is the
  evaluation at $\trunc{\refl {\shape_G}}$ under the sum. The last equivalence
  is the contractibility of singleton types.%
  % }%

  We have just shown that for all $x:\BG$, the type $\sum_{q:x\eqto x}T(q)$ is
  contractible. We define now $\hat g(x):x\eqto x$ as the chosen center of
  contraction of that type. More precisely, by connectedness of $\BG$, the
  inverse $\inv\varphi$ of the exhibited equivalence
  $\varphi:\sum_{q:\USym G}T(q) \equivto 1$ produces a dependent function of
  type $\prod_{x:\BG}1\equivto \sum_{q: x\eqto x}T(q)$, and $\hat g$ is the
  pointwise evaluation at the unique element $\triv$ of $1$. In particular,
  $\hat g (\shape_G) = \inv\varphi (\triv) = g$ as wanted.
\end{proof}

Together, \cref{lemma:center-inc-inj-on-paths} and
\cref{lemma:center-inc-surj-on-paths} show that
$\abstr{(\grpcenterinc G)}$ establishes an equivalence
\begin{equation}
  %\left( \id_{\BG_\div} = \id_{\BG_\div} \right)
  \USym \grpcenter(G) \equivto \sum_{g:\USym G}\prod_{h:\USym G}gh=hg
\end{equation}
In yet other words,
$\B \grpcenter(G)\defequi \conncomp{(\BG_\div \eqto \BG_\div)}
{\refl{\BG_\div}}$ is (equivalent to) the classifying type of a
group whose abstract group is the ``abstract center'' of $\abstr(G)$.

The following lemma is then immediate:
\begin{lemma}
  \label{def:abelian-groups}%
  A group $G$ is {\em abelian} if and only if $\grpcenterinc G$ is an
  isomorphism of groups.
\end{lemma}

%% TRANSFORM AS REMARK ON ALTERNATIVE DEF:
%%
% Directly from the definition and the computations above, one see that
% a group $G$ is abelian if and only if it satisfies the following
% property:
% \begin{displaymath}
%   \prod_{g,h:\USym G}gh=hg
% \end{displaymath}
% which is the ordinary definition of an abstract abelian group in
% ordinary group theory.
\begin{remark}
  In the style of this book, we could have
  used~\cref{def:abelian-groups} directly as the definition of abelian
  groups. However, the definition of $\grpcenterinc G$ would have been
  too intricate to give properly as early as~\cref{def:abgp}.
\end{remark}

\subsection{Universal cover and simple connectedness}
\label{sec:univ-cover-simple}
%% TO BE MOVED?

%% CHANGE THAT:
% \begin{itemize}
% \item for any pointed type $X$, the pointed type $\loopspace X$ is
%   defined as $(\pt_X = \pt_X)$ with designated point $\refl {\pt_X}$,
% \item the {\em abstract fundamental group} $\fundgrp(X)$ of a pointed type
%   $X$ is the set truncation $\setTrunc{\loopspace X}$,
% \item equivalently, in presence of groupoid truncations
%   $\grpdTrunc{\blank}$, the {\em (concrete) fundamental group}
%   $\fundgrpd(X)$ of a pointed type $X$ is the pointed type
%   $\conncomp{\left(\grpdTrunc X\right)}{\grpdtrunc{\pt_X}}$,
% \item a simply connected type is a connected pointed type $X$ such
%   that $\pi_1(X)$ (equivalently $\fundgrpd(X)$) is contractible.
% \end{itemize}
%%
Let us say that a pointed type $(A,a)$ is {\em simply connected} when
both $A$ and $a\eqto a$ are connected types.

\begin{definition}
  \marginnote{%
    The definition of the universal cover is reminiscent of the notion of
    connected component: instead of selecting elements that are merely equal to
    a fixed element $a$, the universal cover selects elements together with mere
    witnesses of the equality with $a$.%
  }%
  Let $A$ be a type and $a:A$ an element. The {\em universal cover} of $A$ at
  $a$ is the type
  \begin{displaymath}
    \univcover A a \defequi \sum_{x:A}\setTrunc{a\eqto x}.
  \end{displaymath}
\end{definition}
When needed, we will consider $\univcover A a$ as a pointed type, with
distinguished point $(a,\settrunc{\refl a})$. Note that when $A$ is a
groupoid, then the set truncation is redundant and the universal cover
of $A$ at $a$ is then the singleton at $a$. In particular, groupoids
have contractible universal covers.

The identity types in $\univcover A a$ can be understood easily once
we introduce the following function for elements $x,y,z:A$:
\begin{displaymath}
  \blank\cdot\blank : \setTrunc{y\eqto z} \times \setTrunc{x\eqto y} \to \setTrunc{x\eqto z}.
\end{displaymath}
It is defined as follows: given $\chi : \setTrunc{y\eqto z}$, we want to define
$\chi\cdot\blank$ in the set $\setTrunc{x\eqto y} \to \setTrunc{x\eqto z}$,
hence we can suppose $\chi\jdeq\settrunc q$ for some $q:y\eqto z$; now given
$\pi:\setTrunc{x\eqto y}$, one want to define $\settrunc q \cdot \pi$ in the set
$\setTrunc{x\eqto z}$, hence one can suppose $\pi\jdeq\settrunc p$ for some
$p:x\eqto y$; finally, we define
\begin{displaymath}
  \settrunc{q} \cdot \settrunc{p} \defequi \settrunc{q\cdot p}.
\end{displaymath}
Then one proves, by induction on $p:x\eqto y$, that
$\trp[\setTrunc{a\eqto\blank}]p$ is equal to the function
$\alpha\mapsto \settrunc{p}\cdot \alpha$. In particular, there exists an
equivalence from the type of path between two points $(x,\alpha)$ and
$(y,\beta)$ of the universal cover $\univcover A a$ to sum type, analagous to
the identification of paths in sum types:
\begin{equation}
  \label{eq:id-types-universal-cover}%
  \left((x,\alpha) \eqto (y,\beta)\right)
  \equivto \sum_{p:x\eqto y}\settrunc{p} \cdot \alpha = \beta.
\end{equation}

This description allows us to prove the following lemma.
\begin{lemma}
  \label{lemma:universal-cover-simply-connected}%
  Let $A$ be a type and $a:A$ an element. The universal cover
  $\univcover A a$ is simply connected.
\end{lemma}
\begin{proof}
  First, we prove that $\univcover A a$ is connected. It has a point
  $(a,\settrunc{\refl a})$ and, for every $(x,\alpha):\univcover A a$, one wants
  $\Trunc{(a,\settrunc{\refl a}) \eqto (x,\alpha)}$. This is proposition, hence
  a set, so that one can suppose $\alpha \jdeq \settrunc p$ for a path
  $p:a\eqto x$. Now, the proposition
  $\settrunc p \cdot \settrunc {\refl a} = \settrunc p$ holds. So one can use
  the inverse of the equivalence of~\cref{eq:id-types-universal-cover} to
  produce a path $(a,\settrunc{\refl a}) \to (x,\alpha)$.

  Next, we prove that $(a,\settrunc{\refl a}) \eqto (a,\settrunc{\refl a})$ is
  connected. One uses again the equivalence
  of~\cref{eq:id-types-universal-cover} to produce a composition of
  equivalences:
  \begin{align*}
    \left((a,\settrunc{\refl a}) \eqto (a,\settrunc{\refl a})\right)
    &\equivto \sum_{p:a=a}\left( \settrunc p = \settrunc{\refl a} \right)
    \\
    &\equivto \sum_{p:a=a}\left( \Trunc {p \eqto \refl a} \right)
  \end{align*}
  In other words, $(a,\settrunc{\refl a}) \eqto (a,\settrunc{\refl a})$ is
  equivalent to the connected component of $\refl a$ in $a\eqto a$. In
  particular, it is connected.
\end{proof}

\begin{lemma}
  \label{lemma:universal-cover-is-universal}
  Let $A$ be a type pointed at $a:A$. The projection $\fst : \univcover A a \ptdto A$ is a universal \covering{} in the sense of~\cref{def:univ-cover}.
\end{lemma}
\begin{proof}
  Let $f : B \ptdto A$ be a pointed \covering{}. We need to show that the type of pointed functions $\varphi : \univcover A a \ptdto B$ together
  with an identification $q : \fst \eqto f \varphi$ is contractible. However, such a $\varphi$ is uniquely determined by the family of functions
  $\varphi_x : \setTrunc{ a \eqto x } \to \inv f (x)$ for $x : A$. For each $x : A$, $\inv f (x)$ is a set, so $\varphi_x$ is uniquely
  determined by $\varphi_x \circ \settrunc\blank : a \eqto x \to \inv f (x)$. By induction on $p : a \eqto x$, we prove that
  $\varphi_x (\settrunc p) = \trp [\inv f] p (b , f_0) $ where $b$ is the element pointing $B$ and $f_0$ the path pointing $f$. Indeed, for
  $p \jdeq \refl a$, we get $\varphi_a (\settrunc {\refl a}) \jdeq (\varphi (\settrunc {\refl a}) , q_{\settrunc {\refl a}}) = (b , f_0)$
  because $q$ is an indentification $\fst \eqto f \varphi$ of pointed functions.
\end{proof}

\subsection{Abelian groups and simply connected $2$-types}
\label{sec:abel-groups-simply}

We will now give an alternative characterization of the type of
abelian groups, more in line with the geometrical intuition we are
trying to build in this chapter. Recall that a type $A$ is called a
{\em $2$-truncated type}, or {\em $2$-type} for short, when the
identity type $x\eqto y$ is a groupoid for every $x,y:A$.

%% OLD
%%
% We also settle some notations that should ease the reading of the
% proof of the next result. For any type $A:\UU$, we define
% \begin{displaymath}
%   \univcover \UU A \defequi \sum_{X:\UU}\setTrunc{A=X}.
% \end{displaymath}
% This is the analog of the connected component of $\UU$ at $A$ but with
% a set truncation involved. In particular, $\univcover \UU A$ is {\em
%   not} a subtype of $\UU$. To understand identity types better in this
% type $\univcover \UU A$, let us introduce the following function for
% any types $X,Y,Z:\UU$:
% \begin{displaymath}
%   \blank\cdot\blank : \setTrunc{Y=Z} \times \setTrunc{X=Y} \to \setTrunc{X=Z}.
% \end{displaymath}
% It is defined as follows: given $a: \setTrunc{Y=Z}$, we want to define
% $a\cdot\blank$ in the set $\setTrunc{X=Y} \to \setTrunc{X=Z}$, hence
% we can suppose $a\jdeq\settrunc p$ for some $p:Y=Z$; now given
% $b:\setTrunc{X=Y}$, one want to define $\settrunc p \cdot b$ in the
% set $\setTrunc{X=Z}$, hence one can suppose $b\jdeq\settrunc q$ for some
% $q:X=Y$; finally, we define
% \begin{displaymath}
%   \settrunc{q} \cdot \settrunc{p} \defequi \settrunc{q\cdot p}.
% \end{displaymath}
% Then one proves, by induction on $\varphi:X=Y$, that
% $\trp[\setTrunc{A=\blank}]\varphi$ is equal to the function
% $a\mapsto \settrunc{\varphi}\cdot a$. In particular, one gets an
% equivalence between the type $(X,a) = (Y,b)$ of identities between
% elements $(X,a), (Y,b): \univcover\UU A$ and the type
% $\sum_{\varphi:X=Y}\settrunc{\varphi} \cdot a = b$.

% From this, we deduce two important properties of $\univcover\UU A$:
% \begin{itemize}
% \item The type $\univcover\UU A$ is connected. Indeed, for any
%   $(X,a):\univcover \UU A$, one wants to prove the proposition
%   $\Trunc{(A,\refl A) = (X,a)}$. A proposition being in particular a
%   set, one can suppose that $a\jdeq \settrunc p$ for some
%   $p:A=X$. Then
%   \begin{displaymath}
%     !:\settrunc p \cdot \settrunc{\refl A} = \settrunc{p},
%   \end{displaymath}
%   and the pair $(p,!)$ is an element of $(A,\refl A) = (X,a)$ whose
%   propositional truncation allows us to conclude.
% \item Consider $\univcover \UU A$ as pointed at
%   $(A,\settrunc{\refl A})$. Then $\univcover\UU A$ is simply
%   connected. Indeed, one has an equivalence:
%   \begin{displaymath}
%     \loopspace {\univcover\UU A}
%     \weq \sum_{\varphi:A=A}\left( \settrunc{\varphi} = \settrunc{\refl A}\right)
%     \weq \sum_{\varphi:A=A}\Trunc{\varphi = \refl A}
%   \end{displaymath}
%   which proves that $\loopspace {\univcover\UU A}$ is the connected
%   component of $\refl A$ in $A=A$.
% \end{itemize}

\begin{theorem}\label{thm:abelian-groups-weq-sc2types}%
  The type $\typeabgroup$ of abelian groups is equivalent to the type
  of pointed simply connected $2$-types.
\end{theorem}
\begin{proof}
  Define the map $\BB : \typeabgroup \to \UUp$ by
  $\BB G\defequi \univcover{\UU}{\BG_\div}$.\footnote{%
    This is slightly misleading: If $G$ is an abelian group in
    universe $\UU$, then this definition makes $\BB G$ a pointed type
    in a successor universe, which is not what we want.  The solution
    is to note that $\BB G$ is a locally $\UU$-small type, which as a
    connected type is the image of the base point map
    $\pt : \bn{1} \to \BB G$, so it's an essentially $\UU$-small type
    by the Replacement~\cref{pri:replacement}.  So really, $\BB G$
    should be the $\UU$-small type equivalent to
    $\univcover{\UU}{\BG_\div}$.}  Proving that $\BB G$ is a $2$-type
  is equivalent to proving the proposition $\isset(p\eqto q$) for all
  $p,q:x\eqto y$ and all $x,y:\BB G$. One can then use connectedness
  of $\BB G$ and restrict to only show that $p\eqto q$ is a set for
  all path
  $p,q:(\BG_\div,\settrunc{\id_{\BG_\div}})\eqto ({\B
    G}_\div,\settrunc{\id_{\BG_\div}})$. Recall that there is a
  canonical equivalence of type:
  \begin{equation}\label{eq:}
    \left(
      (\BG_\div,\settrunc{\id_{\BG_\div}})\eqto (\BG_\div,\settrunc{\id_{\BG_\div}})
    \right)
    \equivto
    \sum_{r:\BG_\div \eqto \BG_\div}\trp r (\settrunc{\id_{\BG_\div}}) \eqto \settrunc{\id_{\BG_\div}}
  \end{equation}
  Under that equivalence, $p$ and $q$ can be rewritten as $(p_0,!)$
  and $(q_0,!)$ with $p_0,q_0 : \BG_\div\eqto \BG_\div$ and the
  elements $!$ are proofs of the proposition
  $\trp {p_0} {(\settrunc{\id_{\BG_\div}})} =
  \settrunc{\id_{\BG_\div}}$ and
  $\trp {q_0} {(\settrunc{\id_{\BG_\div}})} =
  \settrunc{\id_{\BG_\div}}$ respectively. As a consequence, the
  proposition $\isset(p\eqto q)$ is equivalent to the proposition
  $\isset(p_0\eqto q_0)$. As part of the definition of the group $G$,
  the type $\BG_\div$ is a $1$-type, hence $\BG_\div\eqto \BG_\div$ is
  also a $1$-type through univalence. This means that
  $\isset(p_0\eqto q_0)$ holds.

  So one gets a map, denoted again $\BB$ abusively,
  \begin{displaymath}
    \BB : \typeabgroup \to \UUsctwo
  \end{displaymath}
  where the codomain $\UUsctwo$ is the type of pointed simply
  connected $2$-types, that is
  \begin{displaymath}
    \UUsctwo \defequi \sum_{(A,a):\UUp}\left(
      \isconn(A) \times \isconn(a\eqto a) \times \isgrpd(a\eqto a)
    \right)
  \end{displaymath}
  We shall now provide an inverse for this map. Given a pointed simply
  connected $2$-type $(A,a)$, one can construct a group, denoted
  $\loopspace (A,a)$, with classifying type:
  \begin{displaymath}
    \B\loopspace (A,a) \defequi (a\eqto a,\refl a).
  \end{displaymath}
  Indeed, this pointed type is connected because $(A,a)$ is simply
  connected, and it is a $1$-type because $A$ is a $2$-type. Moreover,
  $\loopspace (A,a)$ is abelian. To see it, let us use the bare
  definition of abelian groups (cf.\ ~\cref{def:abgp}). We shall then
  prove that for all elements $g,h:\refl a \eqto \refl a$, the
  proposition $gh=hg$ holds. This property holds in even more
  generality and is usually called ``Eckmann-Hilton's argument''. It
  goes as follows: for $x,y,z:A$, for $p,q:x\eqto y$ and
  $r,s:y \eqto z$ and for $g:p\eqto q$ and $h:r\eqto s$, one prove
  \begin{equation}
    \label{eq:horizontal-comp}%
    \ap{\blank\cdot q}(h) \cdot \ap{r\cdot\blank}(g)
    = \ap{s\cdot \blank}(g) \cdot \ap{\blank\cdot p}(h).
  \end{equation}
  This equality takes place in $r\cdot p \eqto s\cdot q$ and is better
  represented by the diagram in~\cref{fig:horizontal-comp}.
  \begin{figure}[h]
    \begin{sidecaption}
      {%
        Visual representation of~\cref{eq:horizontal-comp}. The vertical
        dotted lines denotes composition.%
      }[fig:horizontal-comp]
      \centering%
      \begin{tikzpicture}[node distance=4em, baseline=(basenode.base)]
        \node[] (x1) {$x$};
        \node[right of=x1] (y1) {$y$};
        \node[right of=y1] (z1) {$z$};
        \node[below of=x1] (x2) {$x$};
        \node[right of=x2] (y2) {$y$};
        \node[right of=y2] (z2) {$z$};
        \draw[bend left] (x1) to node[above] (p) {\footnotesize$p$} (y1);
        \draw[bend right] (x1) to  node[below] (q1) {\footnotesize$q$} (y1);
        \draw[bend left] (y1) to node[above] (r1) {\footnotesize$r$} (z1);
        \draw[bend left] (y2) to node[above] (r2) {\footnotesize$r$} (z2);
        \draw[bend right] (y2) to  node[below] (s) {\footnotesize$s$} (z2);
        \draw[bend right] (x2) to node[below] (q2) {\footnotesize$q$} (y2);
        \draw[double, shorten >=.1em, shorten <=.1em] (p) to node[right] {\footnotesize$g$} (q1);
        \draw[double, shorten >=.1em, shorten <=.1em] (r2) to node[right] {\footnotesize$h$} (s);
        \draw[gray,densely dotted] (x1) to node (basenode){} (x2) (y1) to (y2) (z1) to (z2);
      \end{tikzpicture}%
      =%
      \begin{tikzpicture}[node distance=4em, baseline=(basenode.base)]
        \node[] (x1) {$x$};
        \node[right of=x1] (y1) {$y$};
        \node[right of=y1] (z1) {$z$};
        \node[below of=x1] (x2) {$x$};
        \node[right of=x2] (y2) {$y$};
        \node[right of=y2] (z2) {$z$};
        \draw[bend left] (x2) to node[above] (p) {\footnotesize$p$} (y2);
        \draw[bend right] (x2) to  node[below] (q1) {\footnotesize$q$} (y2);
        \draw[bend right] (y2) to node[above] (r1) {\footnotesize$s$} (z2);
        \draw[bend left] (y1) to node[above] (r2) {\footnotesize$r$} (z1);
        \draw[bend right] (y1) to  node[below] (s) {\footnotesize$s$} (z1);
        \draw[bend left] (x1) to node[above] (p2) {\footnotesize$p$} (y1);
        \draw[double, shorten >=.1em, shorten <=.1em] (p) to node[right] {\footnotesize$g$} (q1);
        \draw[double, shorten >=.1em, shorten <=.1em] (r2) to node[right] {\footnotesize$h$} (s);
        \draw[gray,densely dotted] (x1) to node (basenode){} (x2) (y1) to (y2) (z1) to (z2);
      \end{tikzpicture}%
    \end{sidecaption}
  \end{figure}%
  %
  One prove such a result by induction on $h$. Indeed, when
  $h\jdeq \refl r$, then both sides of the equation reduces through
  path algebra to $\ap {r\cdot\blank} (g)$. Now we are interested in
  this result when $x,y,z$ are all equal to $a$ by definition, and $p,q,r,s$
  are all equal to $\refl a$ by definition. In that case, one has that
  $\ap {\refl a\cdot \blank}$ and $\ap {\blank\cdot\refl a}$ both act
  trivially, and the equation becomes: $h\cdot g = g \cdot h$.

  One still has to prove that the function $\loopspace$ is an inverse
  for $\BB$. Given an abelian group $G$, the proof
  of~\cref{lemma:universal-cover-simply-connected} gives an
  equivalence between $\B\loopspace {(\BB G)}$ and the connected
  component of $\refl {\BG_\div}$ in $\BG_\div\eqto \BG_\div$. By
  definition, this is the classifying type of $\grpcenter(G)$. Being
  abelian, $G$ is isomorphic to its center
  (\cref{def:abelian-groups}), and so it yields an element of
  $\loopspace {(\BB G)} \eqto_{\typegroup} G$. %
  \marginnote[-1.5\baselineskip]{%
    If $X \ptdweto Y$ denote the type of pointed equivalences between
    pointed types $X,Y:\UUp$, then the univalence axiom implies that
    there is an equivalence
    \begin{displaymath}
      (X=Y) \weq (X \ptdweto Y).
    \end{displaymath}%
  }%
  Conversely, take a pointed simply connected $2$-type $(A,a)$. We
  want to produce a pointed equivalence
  $\Phi : (A,a) \equivto \BB (\loopspace {(A,a)}) $. One should first
  notice that the function
  \begin{fullwidth}
    \begin{equation}
      \label{eq:loopspace-A-abelian}%
      \ev^a_{refl a}{\B\loopspace \left( \BB (\loopspace {(A,a)}) \right)}
      \jdeq \conncomp{((a\eqto a)\eqto (a\eqto a))}{\refl{a\eqto a}} \to (a\eqto a,\refl a).
    \end{equation}
  \end{fullwidth}
  that maps a path
  \begin{displaymath}
    (p,!):(a\eqto a,\settrunc{\refl{a\eqto a}})\eqto (a\eqto a,\settrunc{\refl{a\eqto a}})
  \end{displaymath}
  to the evaluation $p(\refl a): a\eqto a$ is an equivalence, because
  $\loopspace (A,a)$ is an abelian group.

  %% OLD MATERIAL, can still be useful.
  %%
  % We will now provide
  % \begin{displaymath}
  %   \Phi : \BB {(\loopspace {(A,a)})} \ptdto (A,a)
  % \end{displaymath}
  % such that $\loopspace(\Phi)$ is the previous equivalence.
  % To be able to
  % express $\Phi$, we need a small gadget about truncations of
  % function
  % types: for types $X,Y:\UU$, given an element
  % $f_0:\setTrunc{X\to Y}$, one constructs a map
  % $\lceil f_0 \rceil : \setTrunc X \to \setTrunc Y$; the type of
  % $\lceil f_0 \rceil$ being a set, one might as well suppose that
  % $f_0 \jdeq \settrunc f$ for some $f:X\to Y$; then we set
  % $\lceil f_0 \rceil (\settrunc x) = \settrunc{f(x)}$, which
  % suffices
  % in order to define $\lceil f_0 \rceil$ entirely because its
  % codomain
  % $\setTrunc Y$ is a set. If we assume the axiom of
  % choice\footnote{What is the status of AC in this book??}, then
  % $\lceil \blank \rceil$ is injective when $Y$ is a set.
  %%
  We will now define a pointed map
  $\Phi : (A,a) \ptdto \BB (\loopspace {(A,a)})$, and prove
  subsequently that this is an equivalence. Let $T : A \to \UU$ be the
  type family (of sets) define by
  \begin{displaymath}
    T(a') \defequi \sum_{\alpha:\setTrunc{(a\eqto a)\weq(a\eqto a')}}
    \prod_{p:a\eqto a'}\alpha=\settrunc {p\cdot\blank}
  \end{displaymath}
  We claim that $T(a')$ is contractible for all $a':A$. By
  connectedness of $A$, it is equivalent to show that $T(a)$ is
  contractible. However,
  \begin{align*}
    T(a)
    &\jdeq \sum_{\alpha:\setTrunc{(a\eqto a)\equivto(a\eqto a)}}\prod_{p:a\eqto a}
      \alpha = \settrunc {p\cdot \blank}
    \\
    &\weq \sum_{\alpha:\setTrunc{(a\eqto a)\equivto(a\eqto a)}} \alpha = \settrunc{\id_{a=a}}
    \\
    &\weq 1
  \end{align*}
  Then, we define $\Phi (a')$ to be the element
  $(a\eqto a', \kappa_{a'}):\univcover \UU {a\eqto a}$ where
  $\kappa_{a'}$ is the first projection of the center of contraction
  of $T(a')$. In particular, following the chain of equivalences
  above, $\Phi(a)$ is defined as
  $(a\eqto a, \settrunc{\refl {a\eqto a}})$, hence $\Phi(a)$ is
  trivially pointed by a reflexivity path. To verify that $\Phi$, thus
  defined, is an equivalence, one can use connectedness of
  $\BB(\loopspace (A,a))$ and only check that
  $\inv\Phi(a\eqto a,\settrunc{\refl {a\eqto a}})$ is
  contractible. However, there is a canonical equivalence of type:
  \begin{displaymath}
    \inv\Phi(a\eqto a,\settrunc{\refl {a\eqto a}}) \equivto \sum_{a':A}
    \sum_{\varphi : (a\eqto a) \equiv (a\eqto a')}\settrunc{\varphi} = \kappa_{a'}.
  \end{displaymath}
  So we will show that the type on the right hand-side is
  contractible. For an element $a':A$ together with
  $\varphi: (a\eqto a) \equiv (a\eqto a')$ such that the proposition
  $\settrunc \varphi = \kappa_{a'}$ holds, a path between
  $(a,\id_{a\eqto a},!)$ and $(a',\varphi,!)$ consists of a path
  $p:a\eqto a'$ and a path $q:(x\mapsto p x) \eqto \varphi$. We have a
  good candidate for $p$, namely $p\defequi \varphi(\refl
  a):a\eqto a'$. However we don't have quite $q$ yet. Consider, for any
  $a':A$, the function
  \begin{displaymath}
    \ev_{\refl a}^{a'} :
    \left(
      (a\eqto a, \settrunc{\refl{a\eqto a}} ) =
      (a\eqto a', \kappa_{a'} )
    \right)
    \to (a\eqto a')
  \end{displaymath}
  defined as $(\psi,!) \mapsto \psi(\refl a)$.  Note that
  $\ev_{\refl a}^{a}$ is precisely the equivalence
  $\B\loopspace{(\BB\loopspace(A,a))}_\div \equiv (a=a)$ described
  in~\cref{eq:loopspace-A-abelian}. Hence, by connectedness of $A$,
  one gets that the proposition $\isEq(\ev_{\refl a}^{a'})$ holds for
  all $a':A$. In particular, because the propositions
  $\settrunc \varphi = \kappa_{a'}$ and
  $\settrunc {p\cdot\blank} = \kappa_{a'}$ holds, one gets elements
  $(\varphi,!)$ and $(x\mapsto px,!)$ in the domain of
  $\ev_{\refl a}^{a'}$. Their images $\ev_{\refl a}^{a'}(\varphi,!)$
  and $\ev_{\refl a}^{a'}(x\mapsto px,!)$ are both identifiable with
  $p$. By composition, we obtain a path
  $(x\mapsto px,!)\eqto (\varphi,!)$ in the domain. The first
  component provide the path $q:(x\mapsto px) \eqto \varphi$ that we
  wanted.
\end{proof}

\subsection{Higher deloopings}

The function $\BB$ defined in the proof
of~\cref{thm:abelian-groups-weq-sc2types} provides a delooping of
$\BG$ whenever $G$ is abelian. That is, there is an identification
$\loops \BB G \eqto \BG$. A systematic way of obtaining such
deloopings has been developed by David W\"{a}rn\footcite{Warn-EM},
that can be applied here to give an alternative definition of $\BB G$,
and to obtain further deloopings of it.

\begin{definition}[W\"{a}rn]
  Given a pointed type $X$, the type of {\em $X$-torsors} is
  \begin{displaymath}
    TX \defequi \sum_{Y : \UU} \Trunc{Y} \times \left( \prod_{y:Y}(Y,y) \ptdweto X \right).
  \end{displaymath}
  The type of {\em pointed $X$-torsors} is
  $TX_\ast \defequi \sum_{t : TX}\fst t$.
\end{definition}
The usefulness of these definitions in the context of deloopings comes
from the following proposition.
\begin{lemma}[W\"{a}rn]
  Let $X$ be a pointed type. If $TX_\ast$ is contractible, then for
  any pointed $X$-torsors $(t,y)$, the pointed type $(TX,t)$ is a
  delooping of $X$.
\end{lemma}
\begin{proof}
  Suppose $(t,y)$ is a center of contraction for $TX_\ast$. By
  contracting away (\cref{lem:contract-away}) in two different ways,
  we obtained a composition of equivalences:
  \begin{displaymath}
    (t \eqto t) \equivto \sum_{u : TX}\fst u \times (t \eqto u) \equivto \fst t 
  \end{displaymath}
  that maps $\refl t$ to $y$. In other words, this equivalence,
  trivially pointed, presents $(TX, t)$ as a delooping of
  $(\fst t, y)$. Moreover, the $X$-torsor $t$ comes by definition with
  an identification $(\fst t,y) \ptdweto X$. So in the end, we have an
  equivalence $(TX, t) \ptdweto X$.
\end{proof}

\begin{exercise}\label{xca:sections-as-dependent-functions}
  Recall that a {\em section} (see~\cref{def:surjection} and its
  accompanying footnote) of a function $f:A \to B$ is a function
  $s: B \to A$ together with an identification $f\circ s \eqto \id_B$.
  Construct an equivalence from the type $\secfun f$ of sections of
  $f$ to the type $\prod_{b:B}\sum_{a:A}b \eqto f(a)$.
\end{exercise}

Consider the evaluation function
$\ev_{X_\div,Y} : (X_\div \eqto Y) \to Y$ (defined by path-induction,
sending $\refl X$ to the distinguished point of $X$). In other words,
the function $\ev_{X_\div,Y}$ takes an identification of $X_\div$ with
$Y$ and returns the point in $Y$ corresponding to the distinguished
point of $X$ under this identification.  Applying
\cref{xca:sections-as-dependent-functions} to $\ev_{X_\div,Y}$ we get
an equivalence of type
\begin{displaymath}
  TX \equivto \sum_{Y : \UU} \Trunc{Y} \times \secfun(\ev_{X_\div,Y}).
\end{displaymath}
This alternative description of the type of $X$-torsors is the key
ingredient to compare W\"arn's delooping of the classifying type of
an abelian group with our.

\begin{lemma}\label{lem:warn-abelian-group}
  For any abelian group $G$, the type $T(\BG)$ can be identified with
  $\BB G$.
\end{lemma}
\begin{proof}
  Let $G$ be an abelian group. We first construct, for each type
  $Y$, a function
  $f_Y : \Trunc{Y} \times \secfun(\ev_{\BG_\div,Y}) \to
  \setTrunc{\BG_\div \eqto Y}$, and then prove that $f_Y$ is an
  equivalence. Given a type $Y$ and an element
  $(!,s) : \Trunc{Y} \times \secfun(\ev_{X_\div,Y})$, we can easily
  prove that $Y$ is connected: being connected is a proposition, so
  we can assume that we have an actual $y:Y$ and then
  $s(y) : \BG_\div \eqto Y$ proves that $Y$ is as connected as
  $\BG_\div$ is. Consequently $s$ must send $Y$ into one of the
  connected component of $\BG_\div \eqto Y$, that we choose to be
  $f_Y(!,s)$. With this definition, the fiber of $f_Y$ at any given
  $c : \setTrunc{\BG_\div \eqto Y}$ can be identified with the type
  of sections $s$ of $\ev_{\BG_\div,Y}$ with values in $c$. However,
  for any $Z$ and $p: \BG_\div \eqto Z$ the restriction of the
  evaluation
  $\ev_{\BG_\div,Z}\restriction_p : \conncomp{(\BG_\div \eqto Z)} p
  \to Z$ is an equivalence: indeed, by induction, we only have to
  show it for $p\jdeq \refl {\BG_\div}$, in which case
  $\ev_{\BG_\div,\BG_\div}\restriction_{\refl {\BG_\div}}$ is
  exactly the map $\B\grpcenterinc G$ defined in
  \cref{sec:center-group}, which is an equivalence since $G$ is
  abelian by \cref{def:abelian-groups}. Thus, given any $p$, the
  fiber of $f_Y$ at $\settrunc p$ is contractible. Being
  contractible is a proposition, hence a set, so it follows that the
  fiber of $f_Y$ at any $c:\setTrunc{\BG_\div \eqto Y}$ is
  contractible. In other words, $f_Y$ is an equivalence, as
  announced. We have thus a chain of equivalences:\footnote{Notice
    that the construction of an equivalence
    $TX \equivto \univcover \UU {X_\div}$ that we carried for
    $X\jdeq\BG$ relies only on $X_\div$ being connected and
    $\ev_{X_\div,X_\div}\restriction_{\refl {X_\div}}$ being an
    equivalence. Such types $X$ are called {\em central} and are
    studied in details by~\citeauthor{2301.02636}\footnotemark{}.}.%
  \footcitetext{2301.02636}
  \begin{displaymath}
    T(\BG) \equivto \sum_{Y : \UU} \Trunc{Y} \times \secfun(\ev_{X_\div,Y})
    \equivto \sum_{Y : \UU} \setTrunc{\BG_\div \eqto Y} \jdeq \BB G
  \end{displaymath}
\end{proof}

Notice that where W\"arn's method shines, compared to our, is in
producing further delooping $\B^n G$ for $n\geq 3$.


\section{$G$-sets vs $\abstr(G)$-sets}
\label{sec:Gsetsabstrconcr}
\marginnote{Recall from \cref{def:abstrGtorsors} that the type of $\abstr(G)$-set is
  $$\Set_{\abstr(G)}^\abstr\defequi \sum_{\mathcal X:\Set}\Hom_\abstr({\abstr(G)},\abstr(\Sigma_{\mathcal X})).$$}

Given a group $G$ it should by now come as no surprise that the type of $G$-sets is equivalent to the type of $\abstr(G)$-sets.
According to \cref{lem:homomabstrconcr}
$$\abstr:\Hom(G,\Sigma_{\mathcal X})\to\Hom^\abstr(\abstr(G),\abstr(\Sigma_{\mathcal X}))$$
is an equivalence, where the group $\Sigma_{\mathcal X}$ (as a pointed connected groupoid) is the component of the groupoid $\Set$, pointed at $\mathcal X$.  The component information is moot since we're talking about pointed maps from $\BG$ and we see that $\Hom(G,\Sigma_{\mathcal X})$ is equivalent to $\sum_{F:\BG_\div\to\Set}(\mathcal X=F(\shape_G))$.  Finally,
$$\mathrm{pr}:\sum_{\mathcal X}\sum_{F:\BG_\div\to\Set}(\mathcal X=F(\shape_G))\we
(\BG_\div\to\Set),\quad \mathrm{pr}(\mathcal X,F,p)\defequi F
$$
is an equivalence (since $\sum_{\mathcal X}(\mathcal X=F(\shape_G))$ is contractible).
Backtracking these equivalences we see that we have established
\begin{lemma}
  \label{lem:actionsconcreteandabstract}
  Let $G$ be a group.  Then the map
  $$\ev_{\shape_G}:\GSet\to\Set^\abstr_{\abstr(G)},\qquad \ev_{\shape_G}(X)\defequi(X(\shape_G),a_X)
$$
is an equivalence, where the homomorphism $a_X:\Hom^\abstr(\abstr(G), \abstr(\Sigma_{X(\shape_G)}))$ is given by transport $X:\USym G\defequi(\shape_G=\shape_G)\to (X(\shape_G)=X(\shape_G))$.
\end{lemma}
If $X$ is a $G$-set, $g:\USym G$ and $x:X(\shape_G)$, we seek forgiveness for writing $g\cdot x:X(\shape_G)$ instead of $\cast(a_X(g))(x)$.\footnote{and I ask forgiveness for strongly disliking the use of ``$\cast$'' as a name for some tacitly understood map!}

\begin{example}
  \label{ex:abstrandconj}
  Let $H$ and $G$ be groups.  Recall that the set of homomorphisms from $H$ to $G$ is a $G$-set in a natural way:
$$\Hom(H,G):\BG\to\Set,\quad \Hom(H,G)(y)\defequi \sum_{F:\BH_\div\to \BG_\div}(y=F(\shape_H)).$$

What abstract $\abstr(G)$-set does this correspond to?
In particular, under the equivalence $\abstr:\Hom(H,G)\to\Hom^\abstr(\abstr(H),\abstr(G))$, what is the corresponding action of $\abstr(G)$ on the abstract homomorphisms?

The answer is that $g:\USym G$ acts on $\Hom^\abstr(\abstr(H),\abstr(G))$ by postcomposing with conjugation $\conj^g$ by $g$ as defined in \cref{ex:conjhomo}.

Let us spell this out in some detail:
If $(F,p):\Hom(H,G)(\shape_G)\defequi
 \sum_{F:\BH_\div\to \BG_\div}(\shape_G=F(\shape_H))$ and $g:\USym G$, then $g\cdot(F,p)\defequi(F,p\,g^{-1})$.  If we show that the action of $g$ sends $\abstr(F,p)$ to $\conj^g\circ\abstr(F,p)$ we are done.

Recall that $\abstr(F,p)$ consists of the composite
$$\xymatrix{\USym H\ar[r]^-{F^=}&(F(\shape_H)=F(\shape_G))\ar[rr]^-{t\mapsto p^{-1}t\,p}&&\USym G},$$
(\ie $\abstr(F,p)$ applied to $q:\USym H $ is  $p^{-1}F^=(q)\,p$)  together with the proof that this is an abstract group homomorphism.
We see that $\abstr(F,p\,g^{-1})$ is given by conjugation:
$q\mapsto(p\,g^{-1})^{-1}F^=(q)\,(p\,g^{-1})=g\,(p^{-1}F^=(q)\,p)\,g^{-1}$, or in other words $\conj^g\circ\abstr(F,p)$.
\end{example}
For reference we list the conclusion of this example as a lemma:
\begin{lemma}\label{lem:abstrandconj}
  If $H$ and $G$ are groups, then the equivalence of \cref{lem:actionsconcreteandabstract} sends the $G$-set $\Hom(H,G)$ to the $\abstr(G)$-set $\Hom^\abstr(\abstr(H),\abstr(G))$ with action given by postcomposing with conjugation by elements of $\abstr(G)$.
\end{lemma}

If $f:\Hom(G,G')$ is a homomorphism, then precomposition with $\Bf:\BG\to \BG'$ defines a map $$f^*:(G'\text{-}\Set)\to(G\text{-}\Set).$$
\marginnote{Recall that \cref{lem:eq-mono-cover} told us that $f$ is an epimorphism precisely when $\USym f$ is a surjection.}
We will have the occasion to use the following result which essentially says that if $f:\Hom(G,G')$ is an epimorphism, then $f^*$ embeds the type of $G'$-sets as some of the components of the type of $G$-sets.
\begin{lemma}
  \label{lem:epifullyfaithful}
  Let $G$ and $G'$ be groups and let $f:\Hom(G,G')$ be an epimorphism.
  Then the map $f^*:(G'\text{-}\Set)\to(G\text{-}\Set)$ (induced by precomposition with $\Bf:\BG\to \BG'$) is ``fully faithful'' in the sense that if $X,Y$ are $G'$-sets, then
$$f^*:(X=Y)\to(f^*X=f^*Y)
$$
is an equivalence.
\end{lemma}
\begin{proof}
  Evaluation at $\shape_G$  yields an injective map
$$\mathrm{ev}_{\shape_G}:(f^*X=f^*Y)\to(X(f(\shape_G)=Y(f(\shape_G)))$$ and the composite
$$\mathrm{ev}_{\shape_G}f^*=\mathrm{ev}_{f(\shape_G)}:(X=Y)\to(X(f(\shape_G)=Y(f(\shape_G)))$$
 is the likewise injective, so $f^*:(X=Y)\to(f^*X=f^*Y)$ is injective.

For surjectivity, let $F':f^*X=f^*Y$ and write, for typographical convenience, $a:X(f(\shape_G)=Y(f(\shape_G))$ for $\mathrm{ev}_{\shape_G}F'\defequi F'_{\shape_G}$.
By the equivalence between $G$-sets and $\abstr(G)$-sets, $F'$ is uniquely pinned down by $a$ and the requirement that for all $g'=f(g)$ with $g:\USym G$ the diagram
$$\xymatrix{X(f(\shape_G))\ar@{=}[r]^{X({g'})}\ar@{=}[d]_{a}&
  X(f(\shape_G))\ar@{=}[d]_{a}\\
  Y(f(\shape_G))\ar@{=}[r]^{Y({g'})}&Y(f(\shape_G))}
$$
commutes.  Likewise, (using transport along the identity $p_f:\shape_{G'}=f(\shape_G)$) an $F:X=Y$ in the preimage of $a$ is pinned down by the commutativity of the same diagram, but with $g':f(\shape_G)=f(\shape_G)$ arbitrary (an a priori more severe requirement, again reflecting injectivity).   However, when $f:\USym G\to\USym {G'}$ is surjective these requirements coincide, showing that $f^*$ is an equivalence.


% Fix for the moment an  $a:X(f(\shape_G)=Y(f(\shape_G))$

% Now, by transport along the identity $p_f:\shape_{G'}=f(\shape_G)$ and the equivalence between $G'$-sets and $\abstr(G')$-sets, an identity $F':X=Y$ of $G'$-sets is uniquely pinned down by an identity $F'_{f(\shape_G)}:X(f(\shape_G)=Y(f(\shape_G))$ together with the proposition that for all $g':f(\shape_G)=f(\shape_G)$ the diagram $$\xymatrix{X(f(\shape_G))\ar@{=}[r]^{X_{g'}}\ar@{=}[d]_{F'_{f(\shape_G)}}&
%   X(f(\shape_G))\ar@{=}[d]_{F'_{f(\shape_G)}}\\
%   Y(f(\shape_G))\ar@{=}[r]^{Y_{g'}}&Y(f(\shape_G))}
% $$
% commutes.  Likewise, an identity $F:f^*X=f^*Y$ is given by exactly the same data, except that the diagram is only required to commute for $g'=f(g)$ for all $g:\USym G$.  But when $f:\USym G\to\USym {G'}$ these requirements coincide.


% ; $F:X=Y$ is in the preimage of $a:X(f(\shape_G)=Y(f(\shape_G))$ if and only if $a=F_{f(\shape_G)}$ and for all $g':f(\shape_G)=f(\shape_G)$ the diagram
% $$\xymatrix{X(f(\shape_G))\ar@{=}[r]^{X_{g'}}\ar@{=}[d]_{F_{f(\shape_G)}}&
%   X(f(\shape_G))\ar@{=}[d]_{F_{f(\shape_G)}}\\
%   Y(f(\shape_G))\ar@{=}[r]^{Y_{g'}}&Y(f(\shape_G))}
% $$
% commutes.  However, since $f$ is surjective there is a $g:\USym G$ so that $g'=f(g)$.  Therefore, anything in $f^*X=f^*Y$ which is in the preimage of $a$ is in the image of $f^*:X=Y$ and we have shown that $f^*$ is also a surjection.
\end{proof}

\section{Semidirect products}
\label{sec:Semidirect-products}{\color{red} just moved without proofreading BID 211116}

In this section we describe a generalization of the product of two group, called the {\em semidirect} product, which can be constructed from an
action of a group on a group.  Like the product, it consists of pairs, both at the level of concrete groups and of abstract groups, as we shall
see.

We start with some preliminaries on paths between pairs.
Lemma \cref{lem:isEq-pair=} above takes a simpler form when $y$ and $y'$ are values of a family $x \mapsto f(x)$
of elements of the family $x \mapsto Y(x)$, as the following lemma shows.

\begin{lemma}\label{lem:pathpairsection}
  Suppose we are given a type $X$ and a family of types $Y(x)$ parametrized by the elements $x$ of $X$.
  Suppose we are also given a function $f : \prod_{x:X} Y(x)$.
  For any elements $x$ and $x'$ of $X$,
  there is an equivalence of type
  $$\left ( (x,f(x)) = (x',f(x')) \right ) \weq (x=x') \times (f(x) = f(x)),$$
  where the identity type on the left side is between elements of $\sum_{x:X} Y(x)$.
\end{lemma}

\begin{proof}
  By \cref{lem:isEq-pair=} and by composition of equivalences, it suffices to establish an equivalence of type
  $$\left( \sum_{p:x=x'} \pathover {f(x)} Y p {f(x')} \right) \weq (x=x') \times (f(x) = f(x)).$$
  Rewriting the right hand side as a sum over a constant family, it suffices to find an equivalence of type
  $$\left( \sum_{p:x=x'} \pathover {f(x)} Y p {f(x')} \right) \weq \sum_{p:x=x'} (f(x) = f(x)).$$
  By \cref{lem:fiberwise} it suffices to establish an equivalence of type
  $$ \left( \pathover {f(x)} Y p {f(x')} \right) \weq (f(x) = f(x))$$
  for each $p:x=x'$.  By induction on $x'$ and $p$ we reduce to the case where $x'$ is $x$ and $p$ is $\refl x$, and it suffices to establish an
  equivalence of type
  $$ \left( \pathover {f(x)} Y {\refl x} {f(x)} \right) \weq (f(x) = f(x)).$$
  Now the two sides are equal by definition, so the identity equivalence provides what we need.
\end{proof}

The lemma above shows how to rewrite certain paths between pairs as pairs of paths.  Now we wish to establish the formula for composition of
paths, rewritten in terms of pairs of paths, but first we introduce a convenient definition for the transport of loops in $Y(x)$ along paths in
$X$.

\begin{definition}\label{def:pathsectionaction}
  Suppose we are given a type $X$ and a family of types $Y(x)$ parametrized by the elements $x$ of $X$.
  Suppose we are also given a function $f : \prod_{x:X} Y(x)$.
  For any elements $x$ and $x'$ of $X$ and for any identity $p : x = x'$, define a function $(f(x') = f(x')) \to (f(x) = f(x))$, to be denoted
  by $q' \mapsto {q'} ^ p$, by induction on $p$ and $x'$, reducing to the case where $x'$ is $x$ and $p$ is $\refl x$, allowing us to
  set ${q'} ^{ \refl x } \defeq q'$.
\end{definition}

We turn now to associativity for the operation just defined.

\begin{lemma}\label{def:pathsectionactionassoc}
  Suppose we are given a type $X$ and a family of types $Y(x)$ parametrized by the elements $x$ of $X$.
  Suppose we are also given a function $f : \prod_{x:X} Y(x)$.
  For any elements $x$, $x'$, and $x''$ of $X$, for any identities $p : x = x'$ and $p' : x' = x''$,
  and for any $q : f x'' = f x''$,
  there is an identification of type $ ( q ^{ p' }) ^ p = q ^{( p' \cdot p )}$.
\end{lemma}

\begin{proof}
  By induction on $p$ and $p'$, it suffices to show that $ ( q ^{ \refl y }) ^ { \refl y } = q ^{( \refl y \cdot \refl y )}$, in which both sides are
  equal to $q$ by definition.
\end{proof}

Observe that the operation depends on $f$, but $f$ is not included as part of the notation.

The next lemma contains the formula we are seeking.

\begin{lemma}\label{lem:pathpairsectionmult}
  Suppose we are given a type $X$ and a family of types $Y(x)$ parametrized by the elements $x$ of $X$.
  Suppose we are also given a function $f : \prod_{x:X} Y(x)$.
  For any elements $x$, $x'$, and $x''$ of $X$, and for any two identities $e : (x,f(x)) = (x',f(x'))$ and $e' : (x',f(x')) = (x'',f(x''))$,
  if $e$ corresponds to the pair $(p,q)$ with $p : x = x'$ and $q : f x = f x$ under the equivalence of \cref{lem:pathpairsection},
  and $e'$ corresponds to the pair $(p',q')$ with $p' : x' = x''$ and $q' : f x' = f x'$,
  then $e' \cdot e$ corresponds to the pair $(p' \cdot p , ({q'} ^ p) \cdot q)$.
\end{lemma}

\begin{proof}
  By induction on $p$ and $p'$ we reduce to the case where $x'$ and $x''$ are $x$ and $p$ and $p'$ are $\refl x$.
  It now suffices to show that $e' \cdot e$ corresponds to the pair $(\refl x , q' \cdot q)$.
  Applying the definition of the map $\Phi$ in the proof of \cref{lem:isEq-pair=} to our three pairs, we see that it suffices to show that
  $\left( \apap g {\refl x} {q'} \right) \cdot \left( \apap g {\refl x} {q} \right) = \apap g {\refl x} {q' \cdot q}$, with $g$, as there, being the function $ g(x)(y) \defeq (x,y)$.
  By \cref{def:applfun2comp} it suffices to show that $\left( \ap {g(x)} {q'} \right) \cdot \left( \ap {g(x)} {q} \right) = \ap {g(x)} {(q' \cdot q)}$, which follows from
  compatibility of $\ap {g(x)}$ with composition, as in~\cref{lem:apcomp}.
\end{proof}

The lemma above will be applied mostly in the case where $x'$ and $x''$ are $x$, but if it had been stated only for that case, we would not have
been able to argue by induction on $p$ and $p'$.

\begin{definition}\label{def:semidirect-product}
  Given a group $G$ and an action $\tilde H : \BG \to \typegroup$ on a group $H \defeq \tilde H(\shape_G)$, we define a group called the {\em
    semidirect product} as follows.
  $$G \ltimes \tilde H \defeq \mkgroup { \sum_{t:\BG} \B \tilde H(t) }$$
  Here the basepoint of the sum is taken to be the point $(\shape_G,\shape_H)$.
  (We deduce from \cref{lem:level-n-utils}, \cref{level-n-utils-sum}, that $\sum_{t:\BG} \B \tilde H(t)$ is a groupoid.
  See \cref{xca:connected-trivia-1} for a proof that
  $\sum_{t:\BG} \B \tilde H(t)$ is connected.)
\end{definition}

Observe that if the action of $G$ on $H$ is trivial, then $\tilde H(t) \jdeq H$ for all $t$ and $G \ltimes \tilde H \jdeq G \times H$.

Projection onto the first factor gives a homomorphism $p \defeq \mkgroup \fst : G \ltimes \tilde H \to G$.
Moreover, there is a homomorphism $s : G \to G \ltimes \tilde H$ defined by
$ s \defeq \mkgroup {\left( t \mapsto (t,\shape_{\tilde H(t)}) \right) }$, for $t : \B G$.
The two maps are homomorphisms because they are made from basepoint-preserving maps.
The map $s$ is a \emph{section} of $p$ in the sense the $p \circ s = \id_G$.
There is also a homomorphism $j : H \to G \ltimes \tilde H$ defined by $j \defeq \mkgroup { \left( u \mapsto (\shape_G,u) \right) }$, for $u : \B H$.

\begin{lemma}
  The homomorphism $j$ above is a monomorphism, and it gives the same (normal) subgroup of $G \ltimes \tilde H$ as the kernel $\ker p$ of $p$.
\end{lemma}
\footnote{{\color{red}MUST BE MOVED TO THE SUBGROUP CHAPTER}}

\begin{proof}
  See \ref{def:kernel} for the definition of kernel.  According to \cref{lem:fst-fiber(a)=B(a)}, the map $\B H \to (\B p)^{-1}(\shape_G)$ defined by
  $ u \mapsto ((\shape_G,u), \refl{\shape_G}) $ is an equivalence.  This establishes that the fiber $(\B p)^{-1}(\shape_G)$ is connected and thus serves as
  the classifying type of $\ker p$.  Pointing out that the composite map $H \xrightarrow{\isom} \ker p \to G \ltimes \tilde H$ is $j$ and using
  univalence to promote the equivalence to an identity gives the result.
\end{proof}

Our next goal is to present the explicit formula for the multiplication operation in $\USym { G \ltimes \tilde H }$.
First we apply \cref{lem:pathpairsection} to get a bijection $\USym { G \ltimes \tilde H } \weq \USym G \times \USym H$.
Now use that to transport the multiplication operation of the group $\USym { G \ltimes \tilde H }$ to the set $\USym G \times \USym H$.
Now \cref{lem:pathpairsectionmult} tells us the formula for that transported operation is given as follows.
$$ (p',q') \cdot (p,q) = (p' \cdot p , ({q'} ^ p) \cdot q) $$
In a traditional algebra course dealing with abstract groups, this formula is used as the definition of the multiplication operation
on the set $\USym G \times \USym H$, but then one must prove that the operation satisfies the properties of \cref{def:abstractgroup}.
The advantage of our approach is that the formula emerges from the underlying logic that governs how composition of paths works.


\section{The pullback}
\label{sec:pullback}
Given two functions $f:B\to D$ and $g:C\to D$ with common target, the ``pullback'' which we will now define should be thought about as the type of all pairs of elements $(b,c):B\times C$ so that $f(b)=g(c)$.  This construction is important in many situations also beyond group theory.

\begin{definition}
  \label{def:pullback}
  Let $B, C, D$ be types and let $f:B\to D$ and $g:C\to D$ be two maps.
The \emph{pullback}\index{pullback} of $f$ and $g$ is the type
$$\prod(f,g)\defequi\sum_{(b,c):B\times C}(f(b)=_Dg(c))$$
together with the two projections $\prj_B:\prod(f,g)\to B$ and $\prj_C:\prod(f,g)\to C$ sending $(b,c,p):\prod(f,g)$ to $b:B$ or $c:C$.  If $f$ and $g$ are clear from the context, we may write $B\times_DC$ instead of $\prod(f,g)$ and summarize the situation by the diagram
$$\xymatrix{B\times_DC\ar[r]^{\prj_C}\ar[d]^{\prj_B}&C\ar[d]^g\\B\ar[r]^f&\,D.}$$
\end{definition}
\begin{xca}
  \marginnote{Illustrating the exercise: if the solid diagram commutes there is a unique dotted arrow so that the resulting diagram commutes:
    $$\xymatrix{A\ar@{.>}[dr]\ar[drr]\ar[ddr]&&\\
    &B\times_DC\ar[r]\ar[d]&C\ar[d]\\&B\ar[r]&D}
  $$}
  \label{xca:univpropofpullback}
  Let $f:B\to D$ and $g:C\to D$ be two maps with common target.  If $A$ is a type show that
  \begin{align*}
    (A\to B)\times_{(A\to D)}(A\to C)\to &(A\to B\times_DC)\\
(\beta,\gamma,p:f\beta=g\gamma)\,\mapsto\,&(a\mapsto (f(a),g(a),p(a):f\beta(a)=g\gamma(a)))
  \end{align*}
 is an equivalence.
\end{xca}
In view of \cref{xca:univpropofpullback} we will say that we have a \emph{pullback diagram}\index{pullback diagram}
$$\xymatrix{A\ar[d]^{g'}\ar[r]^{f'}&C\ar[d]^g\\B\ar[r]^f&D}$$
to indicate that we have an element in $(A\to B)\times_{(A\to D)}(A\to C)$ such that the resulting map $A\to B\times_DC$ is an equivalence.

\begin{example}
  \marginnote{Preimage as a pullback: $$\xymatrix{f^{-1}(d)\ar[d]\ar[r]&\bn1\ar[d]^d\\B\ar[r]^f&D}$$}
  If $g:\bn 1\to D$ has value $d:D$ and $f:B\to D$ is any map, then $\prod(f,g)\oldequiv B\times_D\bn 1$ is equivalent to the preimage $f^{-1}(d)\defequi\sum_{b:B}d=f(b)$.
\end{example}
\begin{example}
  \label{ex:pullbackandgcd}
  Much group theory is hidden in the pullback.  For instance, the greatest common divisor $\gcd(a,b)$ of $a,b:\NN$ is another name for the number of components you get if you pull back the $a$-fold and the $b$-fold \coverings of the circle: we % will see in \cref{lem:iso2} we
  have a pullback
$$\xymatrix{S^1\times\B C_{\gcd(a,b)}\ar[d]\ar[r]& S^1\ar[d]^{(-)^b}\\
S^1\ar[r]^{(-)^a}&\,S^1}
$$
(where $C_n$ was the cyclic group of order $n$).
To get a geometric idea, think of the circle as the unit circle in the complex numbers so that the $a$-fold \covering is simply taking the $a$-fold power.  With this setup, the pullback should consist of pairs $(z_1,z_2)$ of unit length complex numbers with the property that $z_1^a=z_2^b$.  Let $a=a'\gcd(a,b)$ and $b=b'\gcd(a,b)$. Taking an arbitrary unit length complex number $z$, then the pair $(z^{b'},z^{a'})$ is in the pull back (since $a'b=ab'$).  But so is $(\zeta z^{b'},z^{a'})$, where $\zeta$ is any $\gcd(a,b)$\th root of unity.  Each of the $\gcd(a,b)$-choices of $\zeta$ contributes in this way to a component of the pullback.  In more detail: identifying the cyclic group $C_{\gcd(a,b)}$ of order $\gcd(a,b)$ with the group of $g$\th roots of unity, the top horizontal map $S^1\times C_{\gcd(a,b)}\to S^1$ sends $(z,\zeta)$ to $z^{a'}$ and the left vertical map sends $(z,\zeta)$ to the product $\zeta z^{b'}$.

Also the least common multiple $\lcm(a,b)=a'b$ is hidden in the pullback; in the present example it is demonstrated that the map(s) across the diagram makes each component of the pullback a copy of the $\lcm(a,b)$-fold \covering.
\end{example}


\begin{definition}
  \label{def:intersectionand unionofsets}
  Let $S$ be a set and consider two subsets $A$ and $B$ of $S$ given by two families of propositions (for $s:S$) $P(s)$ and $Q(s)$.  The \emph{intersection}\index{intersection! of sets} $A\cap B$ of the two subsets is given by the family of propositions $P(s)\times Q(s)$.  The \emph{union}\index{union of sets} $A\cup B$ is given by the set family of propositions $A(s)+B(s)$.
\end{definition}
\begin{xca}
  \label{xca:intersectionpullbackofsets}
  Given two subsets $A$, $B$ of a set $S$, prove that
  \begin{enumerate}
  \item The pullback $A\times_SB$ maps by an equivalence to the intersection $A\cap B$,
  \item\label{xca:cardinalityintersectionunion}
    If $S$ is finite, then the sum of the cardinalities of $A$ and $B$ is equal to the sum of the cardinalities of $A\cup B$ and $A\cap B$.\qedhere
  \end{enumerate}
\end{xca}

\begin{definition}
  \label{def:intersectionofgroups}
  Let $f:\Hom(H,G)$ and $f':\Hom(H',G)$ be two homomorphisms with common target.  The \emph{pullback}\index{pullback!of groups} $H\times_GH'$ is the group obtained as the (pointed) component of
$$\pt_{H\times_GH'}\defequi(\shape_H,\pt_{H'},p_{f'}p_f^{-1})$$ of the pullback $\BH\times_{\BG}\BH'$ (where $p_f:\shape_G=f(\shape_H)$ is the name we chose for the data displaying $f$ as a pointed map, so that $p_{f'}p_f^{-1}:f(\shape_H)=f'(\pt_{H'})$).

If $(H,f,!)$ and $(H',f',!)$ are monomorphisms into $G$, then the pullback is called the \emph{intersection}\index{intersection! of monomorphisms} and if the context is clear denoted simply $H\cap H'$.
\end{definition}
\begin{example}
  If $a,b:\NN$ are natural number with least common multiple $L$, then $L\ZZ$ is the intersection $a\ZZ\cap b\ZZ$ of the subgroups $a\ZZ$ and $b\ZZ$ of $\ZZ$.
\end{example}
% \begin{example}this came out wrong DELETE June
%   If $H,K:\typemono_G$ with $X,Y:\BG\to\Set$ being the corresponding transitive $G$-sets under the equivalence $E$, then the intersection of $H$ and $K$ corresponds to the $G$-set $X\times Y:\BG\to\Set$ (with $(X\times Y)(x)\defequi X(x)\times Y(x)$).
% \end{example}

\begin{xca}
  Prove that if $f:\Hom(H,G)$ and $f':\Hom(H',G)$ are homomorphisms,
  then the pointed version of \cref{xca:univpropofpullback} induces an equivalence
  $$
  \Hom(K,H)\times_{\Hom(K,G)}\Hom(K,H')\simeq \Hom(K,H\times_GH')
  $$
  for all groups $K$ and an equivalence
  \[
    \USymH \times_{\USymG} \USymH'
    \simeq (\shape_{H\times_GH'}=\shape_{H\times_GH'}).\text{\footnotemark}
  \]
  Elevate the last equivalence to a statement about abstract groups.\footnotetext{%
    Hint: set $A\defequi \Sc$, $B\defequi \BH$, $C\defequi \BH'$ and $D\defequi \BG$.}
\end{xca}

\begin{remark}
  The pullback is an example of when a construction of types \emph{not} preserving connectivity can be used profitably also for groups.
  We get the pullback of groups by restricting to a pointed component, but also the other components have group theoretic importance.
  We will return to this when discussing subgroups.
\end{remark}



\section{Sums of groups}
\label{sec:coprod}
We have seen how the group of integers $\ZZ=(S^1,\base)$ synthesizes the notion of one symmetry with no relations: every symmetry in the circle is of the form $\Sloop^n$ for some unique $n$.  Also, given any group $G=\Aut_A(a)$, the set $a=a$ of symmetries of $a$ corresponds to the set of homomorphisms $\ZZ\to G$, \ie to pointed functions $(S^1,\base)\to_*(A,a)$ by evaluation at $\Sloop$.  What happens if we want to study more than one symmetry at the time?

For instance, is there a group $\ZZ\vee\ZZ$ so that for any group $G=\Aut_A(a)$ a homomorphism $\ZZ\vee\ZZ\to G$ corresponds to \emph{two} symmetries of $a$?
At the very least, $\ZZ\vee\ZZ$ itself would have to have two symmetries and these two can't have any relation, since in a general group $G=\Aut_A(a)$ there is a priori no telling what the relation between the symmetries of $a$ might be.
Now, \emph{one} symmetry is given by a pointed function $(S^1,\base)\to_*(A,a)$ and so a \emph{pair} of symmetries is given by a function $f:S^1+S^1\to A$ with the property that $f$ sends each of the base points of the circles to $a$.  But $S^1+S^1$ is not connected, and so not a group.  To fix this we take the clue from the requirement that both the base points were to be sent to a common base point and \emph{define} $S^1\vee S^1$ to be what we get from $S^1+S^1$ when we \emph{insert an identity} between the two basepoints.
\marginnote{$S^1\vee S^1$ if formed from $S^1+S^1$ by inserting an identity$$\xymatrix{\base\ar@(ul,dl)[]|{\Sloop}\ar@{.>}[rr]^{\text{identify!}}&&\base\ar@(ur,dr)[]|{\Sloop}}
  $$}

The amazing thing is that this works -- an enormous simplification of the classical construction of the ``free products'' or ``amalgamated sum'' of groups.  We need to show that the ``wedge'' $S^1\vee S^1$ is indeed a group, and this proof simultaneously unpacks the classical description.

We start by giving a definition of the wedge construction which is important for pointed types in general and then prove that the wedge of two groups is a group whose symmetries are arbitrary ``words'' in the original symmetries.

\begin{definition}
  \label{def:wedge}
  Let $(A_1,a_1)$ and $(A_2,a_2)$ be pointed types.  The \emph{wedge}\index{wedge of pointed types} is the pointed type $(A_1\vee A_2,a_{12})$ given as a higher inductive type by
  \begin{enumerate}
  \item functions $i_1:A_1\to A_1\vee A_2$ and $i_2:A_2\to A_1\vee A_2$
  \item an identity $g:i_1a_1=i_2a_2$.
  \end{enumerate}
We point this type at $a_{12}\defequi i_1a_1$.
  The function
$$i^g_2:(a_2=_{A_2}a_2)\to(a_{12}=_{A_1\vee A_2}a_{12})$$
is defined by $i^g_2(p)\defequi g^{-1}i_2(p)g$, whereas (for notational consistency only) we set $i_1^g\defequi i_1:(a_1=_{A_1}a_1)\to(a_{12}=_{A_1\vee A_2}a_{12})$.
Simplifying by writing $i:A_1+A_2\to A_1\vee A_2$ for the function given by $i_1$ and $i_2$ (with basepoints systematically left out of the notation),
the induction principle is
$$\prod_{C:(A_1\vee A_2)\to\UU}\sum_{s:\prod_{a:A_1+A_2}Ci(a)}
((s(a_1)=C(g^{-1})s(a_2))\,\to\,\prod_{x:(A_1\vee A_2)}C(x)).$$
\end{definition}

Unraveling the induction principle we see that if $B$ is a pointed type, then a  pointed function $f:A_1\vee A_2\to_* B$ is given by providing pointed functions $f_1:A_1\to_* B$ and $f_2:A_2\to_* B$  -- the identity $f_1(a_1)=f_2(a_2)$ which seems to be missing is provided by the requirement of the functions being pointed.  For the record
\begin{lemma}
  \label{lem:univvee}
  If $B$ is a pointed type, then the function
  $$i^*:(A_1\vee A_2\to_*B)\to(A_1\to_*B)\times(A_2\to_*B),\qquad i^*(f)=(fi_1,fi_2)
$$
is an equivalence.
\end{lemma}



To the right you see a picture of $i_2^g(p)$: \marginnote{$$
\xy (-20,20)*+{};(-20,20)*+{}
**\crv{(15,20)&(18,20)&(-10,35)&(10,45)&(25,30)&(20,19)&(0,20)}
%?>*\dir{>}
?(0)*{} *!LD!/^-20pt/{i_1A_1}
?(.45)*{} *!LD!/^2pt/{>}
?(.95)*{} *!LD!/^-15pt/{g^{-1}}
?(.03)*{} *!LD!/^-5pt/{g}
?(.55)*{} *!LD!/^-7pt/{i_2p}
?(.65)*{} *!LD!/^-30pt/{i_2A_2}
?(.87)*{} *!LD!/^-12pt/{i_2a_2}
?(.86)*{} *!LD!/^-2pt/{\bullet}
?(1)*{} *!LD!/^-2pt/{\bullet}
?(1)*{} *!LD!/^-12pt/{a_{12}}
\endxy
$$}it is the symmetry of the base point $a_{12}\defequi i_1a_1$ you get by \emph{first} moving to $i_2a_2$ with $g$, \emph{then} travel around with $p$ ($i_2p$, really) and finally go home to the basepoint with the inverse of $g$.

\marginnote{The idea is that an identity in $a_{12}=x$ can be factored into a string of identities, each lying solely in $A_1$ or in $A_2$.  We define a family of sets consisting of exactly such strings of identities --  it is a set since $A_1$ and $A_2$ are groupoids -- and prove that it is equivalent to the family $P(x)\defequi(a_{12}=_{A_1\vee A_2}x)$ which consequently must be a family of sets.
We need to be able to determine whether a symmetry is reflexivity or not, but once we know that, the symmetries of the base point in the wedge are then given by ``words $p_0p_1\dots p_n$'' where the $p_j$ alternate between being symmetries in the first or the second group, and none of the $p_j$ for positive $j$ are allowed to be reflexivity.  Note that there order of the $p_j$s is not negotiable: if I shuffle them I get a new symmetry.}


\begin{definition}
  \label{def:sumofgroup}
  If $G_1=\Aut_{A_1}(a_1)$ and $G_2=\Aut_{A_2}(a_2)$ are groups, then their \emph{sum}\index{sum of groups} is defined as
  $$G_1\vee G_2\defequi \Aut_{A_1\vee A_2}(a_{12}).$$
  The homomorphisms $i_1:G_1\to G_1\vee G_2$ and $i_2:G_2\to G_1\vee G_2$ induced from the structure maps  $i_1:A_1\to A_1\vee A_2$ and  $i_2:A_2\to A_1\vee A_2$ are also referred to as \emph{structure maps}.
\end{definition}
\begin{lemma}
  \label{lem:sumofgroupsISsum} If $G_1$, $G_2$ and $G$ are groups, then the function
  $$\Hom(G_1\vee G_2,G)\to\Hom(G_1,G)\times\Hom(G_2,G)$$
given by restriction along the structure maps is an equivalence.
\end{lemma}
\begin{proof}
  This is a special case of \cref{lem:univvee}.
\end{proof}
Specializing further, we return to our initial motivation and see that mapping out of a wedge of two circles \emph{exactly} captures the information of two independent symmetries:
\begin{corollary}
  \label{cor:ZplusZuniv}
  If $G$ is a group, then the functions
  $$\Hom(\ZZ\vee\ZZ,G)\to \Hom(\ZZ,G)\times\Hom(\ZZ,G)\simeq \USym G\times \USym G$$
  is an equivalence.
\end{corollary}

\begin{xca}\label{xca:whatAREabeliangroups}
  This leads to the following characterization of abelian groups\marginnote{%
    \wip{Do we know at this point that this extension problem is a proposition,
      \ie that the wedge inclusion is an epimorphism?
      Check re pointedness.}}
  formulated purely in terms of pointed connected groupoids
  (with no direct reference to identity types).
  A group $G$ is abelian if and only if the canonical map\marginnote{%
    \begin{tikzcd}[ampersand replacement=\&]
      \BG\vee\BG\ar[r,"\fold"]\ar[d,"\text{inclusion}"'] \& \BG \\
       \BG\times\BG\ar[ur,dashed]
    \end{tikzcd}}
  \[
    \fold :\BG\vee \BG\ptdto \BG
  \]
  (given via \cref{lem:sumofgroupsISsum} by $\id_G:G\to G$)
  extends over the inclusion
  \[
    i:\BG\vee \BG\ptdto \BG\times \BG
  \]
  (given by the inclusions $\incl_1,\incl_2:G\to G\times G$).

  As a cute aside, one can see that the required map $\BG\times\BG\ptdto\BG$
  actually doesn't need to be pointed:
  factoring
  $\fold:\BG\vee\BG\to\BG$ over $i:\BG\vee\BG\to\BG\times\BG$
  -- even in an unpointed way -- kills all ``commutators''
  $ghg^{-1}h^{-1}:\USym(G\vee G)$.
  (\wip{is this still a proposition, or do we need to truncate?})
\end{xca}

We end the section by proving that wedges of decidable groups are decidable groups and that they can be given the classical description in terms of words.


\begin{lemma}
  \label{lem:wedgeofgpoidisgpoid}
  Let $G_1\defequi\Aut_{A_1}(a_1)$ and $G_2\defequi\Aut_{A_2}(a_2)$ be decidable groups, then the wedge sum $G_1\vee G_2\defequi\Aut_{A_1\vee A_2}(a_{12})$ is a decidable group.

Let $C_1$ be the set of strings $(p_0,n,p_1,\dots,p_n)$ with $n:\NN$ and, for $0\leq j\leq n$
\begin{itemize}
\item $p_{j}:\USym G_1%\defequi (a_1=a_1)
  $  for even $j$
\item $p_{j}:\USym G_2%\defequi (a_2=a_2)
  $ for odd $j$ and
\item $p_j$ is not reflexivity for $j$ positive
\end{itemize}
(the last requirement makes sense and is a proposition since our groups are decidable).

  Then the function given by composition in $\USym G_{12}\defequi(a_{12}=a_{12})$
  $$\beta:C_1\to\USym G_{12}%\defequi(a_{12}=a_{12})
  ,\qquad\beta(p_0,n,p_1,\dots p_n)\defequi i_1^gp_0i_2^gp_1i_1^gp_2\dots i_?^gp_n$$
(where $i_?^gp_n$  is $i_1^gp_n$ or $i_2^gp_n$ according to whether $n$ is even or odd) is an equivalence.
\end{lemma}
\begin{proof}
  That the wedge is connected follows by transitivity of identifications,
  if necessary passing through the identification $g:i_1a_1=i_2a_2$ in the wedge.

We must prove that the wedge is a groupoid, \ie that all identity types are sets, which we do by giving an explicit description of the universal \covering.

 We use the notation of \cref{def:wedge} freely, and for ease of notation, let $a_{2k+i}\defequi a_i$ and $i_{2k+i}^g\defequi i_i^g$ for $i=1,2$, $k:\NN$.
Define families of sets
$$C_i:A_i\to\Set,\qquad i=1,2$$
by
$$
C_i(x)\defequi(a_i=_{A_i}x)\times
\sum_{n:\NN}\prod_{1\leq k\leq n}\sum_{p_k:a_{i+k}= a_{i+k}}(p_k\neq\refl {a_{i+k}})
$$
when $x:A_i$.  Note that $p_k\neq\refl{a_{i+k}}$  is a proposition; we leave it out when naming elements. Hence, an element in $C_1(a)$ is a tuple
$(p_0,n,p_1,\dots,p_n)$ where $p_0:a_1=_{A_1}a$, $p_1:a_2=_{A_2}a_2$, $p_2:a_1=_{A_1}a_1$, and so on -- alternating between symmetries of $a_1$ and $a_2$, and where $p_0$ is the only identity allowed to be $\refl{}$. Define $C_{12}:C_1(a_1)\to C_2(a_2)$ by
$$C_{12}(p_0,n,p_1\dots,p_n)=
\begin{cases}
  (\refl{a_2}0,)&\text{ if }p_0=\refl{a_1}, n=0,\\
  (p_1,n-1,p_2\dots,p_n)& \text{ if }p_0=\refl{a_1},n\neq0,\\
  (\refl{a_2},n+1,p_0,\dots,p_n)& \text{ if }p_0\neq\refl{a_1}.
\end{cases}
$$
It is perhaps instructive to see a table of the values $C_{12}(p_0,n,p_1,\dots,p_n)$ for $n<3$:
\begin{center}
  \begin{tabular}{r|c cc}
    &$(p_0,0)$&$(p_0,1,p_1)$&$(p_0,2,p_1,p_2)$\\
    \hline
    $p_0=\refl{a_1}$&$(\refl{a_2},0)$&$(p_1,0)$&$(p_1,1,p_2)$\\
    $p_0\neq\refl{a_1}$&$(\refl{a_2},1,p_0)$&$(\refl{a_2},2,p_0,p_1)$&$(\refl{a_2},3,p_0,p_1,p_2)$
  \end{tabular}
\end{center}
Since $C_{12}$ is an equivalence, the triple $(C_1,C_2,C_{12})$ defines a family
$$C:A_1\vee A_2\to\Set.$$
In particular, $C(a_{12})\defequi C_1(a_1)$.
For $x:A_1$ we let $i^C_1:C_1(x)\to C(i_1(x))$ be the induced equivalence, and likewise for $i^C_2$.
We will show that $C$ is equivalent to $P\defequi \pathsp{a_{12}}$, where $P(x)\defequi(a_{12}=x)$, and so that the identity types in the wedge are equal to the sets provided by $C$.

One direction is by transport in $C$; more precisely,
$$\alpha:\prod_{x:A_1\vee A_2}(P(x)\to C(x))$$ is given by transport with $\alpha(a_{12})(\refl{a_{12}})\defequi(\refl{a_{1}},0):C(a_{12})$.
The other way,
$$\beta:\prod_{x:A_1\vee A_2}(C(x)\to P(x))$$ is given by composing identities, using the glue $g$ to make their ends meet:
$$\beta(i_1a)(p_0,n,p_1,\dots,p_n)\defequi i_1(p_0)i_2^g(p_1)i_3^g(p_2) \dots i_{n+1}^g(p_n)$$
(here the definition $\dots i_3^g\defequi i_1^g\defequi i_1$ proves handy since we don't need to distinguish the odd and even cases)
and likewise
$$\beta(i_2a)(p_0,n,p_1,\dots,p_n)\defequi i_2(p_0)g\,i_1^g(p_1)i_2^g(p_2) \dots i_{n}^g(p_n)$$ and compatibility with the glue $C_{12}$ is clear since the composite $\refl{x}p$ is equal to $p$.

For notational convenience, we hide the $x$ in $\alpha(x)(p)$ and $\beta(x)(p)$ from now on.

That $\beta\alpha(p)=p$ follows by path induction: it is enough to prove it for $x=a_{12}$ and
$p\defequi\refl{a_{12}}$:
$$\beta\alpha(\refl{a_{12}})=\beta(\refl{a_1},0)=i_1^g\refl{a_1}=\refl{a_{12}}.$$

That $\alpha\beta(p_0,n,p_1\dots,p_n)=(p_0,n,p_1,\dots,p_n)$ follows by induction on $n$ and $p_0$.  For $n=0$ it is enough to consider  $x=a_{12}$ and $p_0=\refl{a_1}$, and then
$\alpha\beta(\refl{a_1},0)\defequi\alpha(\refl{a_{12}})\defequi(\refl{a_1},0)$.  In general, (for $n>0$)
\begin{align*}
  \alpha\beta(p_0,n,p_1\dots,p_n)
=&\trp[C]{i_1(p_0)i_2^g(p_1)i_1^g(p_2) \dots i_{n+1}^g(p_n)}(\refl{a_1,0})\\
=&\trp[C]{i_1(p_0)}\dots\trp[C]{i_{n+1}^g(p_n)}(\refl{a_1,0}).
\end{align*}
  The induction step is as follows: let $0< k\leq n$, then
\begin{align*}
  &\trp[C]{i_k^gp_{k-1}}i^C_{k-1}(p_k,n-k-1,p_{k+1},\dots,p_n)\\
  =&\trp[C]{i_k^gp_{k-1}}i^C_k(\refl{a_{k-1}},n-k,p_k,\dots,p_n)\\
  =&i^C_k\trp[C_k]{p_{k-1}}(\refl{a_{k-1}},n-k,p_k,\dots,p_n)\\
  =&(p_{k-1},n-k,p_k,\dots,p_n).
\end{align*}
%((please see whether this makes sense to anybody but yvt))
\end{proof}

\section{Heaps \texorpdfstring{$(\dagger)$}{(\textdagger) \color{red} just moved from symmetry without proofreading BID211116}}
\label{sec:heaps}

Recall that we in \cref{rem:heap-preview} wondered about
the status of general identity types $a=_A a'$,
for $a$ and $a'$ elements of a groupoid $A$,
as opposed to the more special loop types $a=_Aa$.\marginnote{%
  This section has no implications for the rest of the book,
  and can thus safely be skipped on a first reading.}
Here we describe the resulting algebraic structure
and how it relates to groups.

We proceed in a fashion entirely analogous to that of \cref{sec:typegroup},
but instead of looking a pointed types, we look at \emph{bipointed types}.

\begin{definition}\label{def:bipt-conn-groupoid}
  The type of \emph{bipointed, connected groupoids} is the type
  \[
    \UUppone \defeq \sum_{A:\UU^{=1}}(A \times A).\qedhere
  \]
\end{definition}
Recall that $\UU^{=1}$ is the type of connected groupoids $A$,
and that we also write $A:\UU$ for the underlying type.
We write $(A,a,a'):\UUppone$ to indicate the two endpoints.

Analogous to the loop type of a pointed type,
we have a designated identity type of a bipointed type,
where we use the two points as the endpoints of the identifications:
We set $\ISym(A,a,a') \defeq (a =_A a')$.

\needspace{6\baselineskip}
\begin{definition}\label{def:heap}
  The type of \emph{heaps}\footnote{%
    The concept of heap (in the abelian case)
    was first introduced by Prfer\footnotemark{}
    under the German name \emph{Schar} (swarm/flock).
    In Anton Sushkevich's book
    \casrus{  }
    (\emph{Theory of Generalized Groups}, 1937),
    the Russian term \casrus{} (heap)
    is used in contrast to \casrus{} (group).
    For this reason, a heap is sometimes
    known as a ``groud'' in English.}%
  \footcitetext{Pruefer-AG}
  is a wrapped copy (\cf \cref{sec:unary-sum-types})
  of the type of bipointed, connected groupoids $\UUppone$,
  \[
    \Heap \defeq \Copy_{\mkheap}(\UUppone),
  \]
  with constructor $\mkheap : \UUppone \to \Heap$.
\end{definition}
We call the destructor $\B : \Heap \to \UUppone$,
and call $\BH$ the \emph{classifying type} of the heap $H \jdeq\mkheap\BH$,
just as for groups,
and we call the first point in $BH$ is \emph{start shape} of $H$,
and the second point the \emph{end shape} of $H$.

The identity type construction $\ISym : \UUppone \to \Set$
induces a map $\USym : \Heap \to \Set$,
mapping $\mkheap X$ to $\ISym X$.
These are the \emph{underlying identifications} of the heaps.

These is an obvious map (indeed a functor) from groups to heaps,
given by doubling the point.
That is, we keep the classifying type and use the designated shape
as both start and end shape of the heap.
In fact, this map lifts to the type of heaps with a chosen identification.
\begin{exercise}\label{xca:group+torsor-heap}
  Define natural equivalences $\Heap \weq \sum_{G:\Group}\BG$,
  and $\Group \weq \sum_{H:\Heap}(\USym H)$.
\end{exercise}
Recalling the equivalence between $\BG$ and the type of $G$-torsors
from~\cref{lem:BGbytorsor},
we can also say that a heap is the same
as a group $G$ together with a $G$-torsor.\footnote{%
  But be aware that are \emph{two} such descriptions,
  according to which endpoint is the designated shape,
  and which is the ``twisted'' torsor.}
It also follows that the type of heaps is a (large) groupoid.

In the other direction,
there are \emph{two} obvious maps (functors) from heaps to groups,
taking either the start or the end shape to be the designated shape.

Here's an \emph{a priori} different map from heaps to groups:
For a heap $H$, consider all the
symmetries of the underlying set of identifications $\USym H$
that arise as $r \mapsto p\inv q r$ for $p,q\in \USym H$.

Note that $(p,q)$ and $(p',q')$ determine the same symmetry
if and only if $p\inv q = p'\inv{q'}$, and if and only if
$\inv{p'}p = \inv{q'}q$.

For the composition, we have $(p,q)(p',q') = (p\inv{q}p',q') = (p,q'\inv{p'}q)$.

\begin{exercise}
  Complete the argument that this defines a map
  from heaps to groups. Can you identify the resulting group
  with the symmetry group of the start or end shape?
  How would you change the construction to get the other endpoint?
\end{exercise}

\begin{exercise}
  Show that the symmetry groups of the two endpoints of a heap
  are \emph{merely} isomorphic.

  Define the notion of an \emph{abelian heap},
  and show that for abelian heaps,
  the symmetry groups of the endpoints are (\emph{purely}) isomorphic.
\end{exercise}

Now we come to the question of describing the algebraic structure
of a heap.
Whereas for groups we can define the abstract structure
in terms of the reflexivity path and the binary operation of path composition,
for heaps, we can define the abstract structure
in terms of a \emph{ternary operation},
as envisioned by the following exercise.

\begin{exercise}\label{xca:heap-variety}
  Fix a set $S$.
  Show that the fiber $\inv{\USym}(S)\jdeq\sum_{H:\Heap}(S=\USym H)$ is a set.

  Now fix in addition a ternary operation $t:S\times S\times S\to S$ on $S$.
  Show that the fiber of the map $\Heap \to \sum_{S:\Set}(S\times S\times S \to S)$,
  mapping $H$ to $(\USym H,(p,q,r)\mapsto p \inv{q} r)$,
  at $(S,t)$ is a proposition,
  and describe this proposition in terms of equations.
\end{exercise}




% Local Variables:
% fill-column: 144
% latex-block-names: ("lemma" "theorem" "remark" "definition" "corollary" "fact" "properties" "conjecture" "proof" "question" "proposition" "exercise")
% TeX-master: "book"
% End:
