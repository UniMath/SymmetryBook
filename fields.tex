\chapter{Rings, fields and vector spaces}
\label{ch:fields}

In this chapter we will extend the hierarchy of algebraic structures from 
monoids (\cref{def:monoid}) and 
groups (\cref{def:typegroup}) to
rings (\cref{def:abstractring}),
fields (\cref{def:field}), and
vector spaces (\cref{def:vectorspace}).
Of all these structures there are several varieties, 
satisfying additional properties, such as 
abelian groups (\cref{sec:abelian-groups}),
non-trivial rings (\cref{def:non-trivial-ring}),
commutative rings (\cref{def:commutative-ring}),
....

Quotients; subspaces (= ?). Bases and so. Dual space; orthogonality. (all of this depends on good implementations of subobjects). Eigen-stuff. Characteristic polynomials; Hamilton-Cayley.

\section{Rings, abstract and concrete}\label{sec:rings}

A ring is an algebraic structure that consists of a group and a
monoid that share the same underlying set. The interaction between
the respective operations is governed by laws that are called
the distributivity laws. 
The standard example of a (commutative) ring 
is the ring with set of integers as underlying set, with addition as
group operation and multiplication as monoid operation.
Note that multiplication in a ring need not be commutative.\footnote{%
In contrast, in \cref{xca:ring-group-abelian} you are asked to prove
that the group of a ring is always abelian, as a consequence of the
extra structure and properties.} We start by defining rings abstractly.

\subsection{Abstract rings}\label{sec:abstrings}

We follow the convention that the group data of an abstract group
are denoted by $0,\,+,\,-$ and the monoid data by $1,\,\cdot\,$.

\begin{definition}\label{def:abstractring}
An \emph{abstract ring} $\mathscr R$ consists of an abstract group 
$(R,0,+,-)$ and a monoid $(R,1,\cdot)$ with the
same underlying set $R$. Moreover, the following equations should hold
for all $a,b,c : R$:
    \begin{enumerate}      %[ref=\ref{def:abstractring} (\alph*)]
    \item\label{ring:ldistr-law} $a \cdot (b + c) = a \cdot b + a \cdot c$ (the \emph{left distributive law})
    \item\label{ring:rdistr-law} $(a + b) \cdot  c = a \cdot c + b \cdot c$ (the \emph{right distributive law})
    \end{enumerate}
The latter two properties
are together denoted by $\mathrm{DistrLaws}(R,\cdot,+)$.

The abstract ring $\mathscr R$ is called \emph{non-trivial} if $0\neq 1$
and \emph{commutative} if its multiplication $\cdot$ is commutative, that is,
if $a\cdot b= b\cdot a$ for all $a,b:R$.
\end{definition}

The abstract group $(R,0,+,-)$ is called the \emph{(additive) group}
of $\mathscr R$, and the monoid $(R,1,\cdot)$ the 
\emph{(multiplicative) monoid} of $\mathscr R$.

\begin{definition}\label{def:typering}
The type of abstract rings is defined as\footnote{%
See \cref{not:GroupLaws} for the monoid laws.}
\begin{align*}
\typering\defeq 
\sum_{(R,0,+,-):\Group^{\abstr}} ~ &\sum_{e:R} ~ \sum_{\mu:R\to R\to R} \\
&\mathrm{MonoidLaws}(R,e,\mu)\times\mathrm{DistrLaws}(R,\mu,+).
\end{align*}
The type $\typecommring$ of commutative rings is similar to the type
of rings with the additional property $\prod_{a,b:R}\mu(a,b)=\mu(b,a)$. 
\end{definition}

\begin{xca}\label{xca:ring-group-abelian}
Let $\mathscr R$ be an abstract ring. Show that the additive group 
of $\mathscr R$ is abelian. Hint: elaborate $(a+1)\cdot(b+1)$.
\end{xca}

\begin{definition}\label{def:ringhom}
Let $\mathscr R,\mathscr S : \Ring$ be abstract rings, with
$\mathscr R$ consisting of an abstract group $\agp R$ with underlying set $R$
and a monoid $(R,1_R,\cdot_R)$, and 
$\mathscr S$ consisting of an abstract group $\agp S$ with underlying set $S$
and a monoid $(S,1_S,\cdot_S)$.
An \emph{abstract ring homomorphism} from $\mathscr R$ to $\mathscr S$ is an
abstract homomorphism $f:\absHom(\agp R,\agp S)$ that is a monoid homomorphism
from $(R,1_R,\cdot_R)$ to $(S,1_S,\cdot_S)$.
\end{definition}



\begin{example}\label{exa:ring-Z-polynomials}
We elaborate the abstract ring of polynomials with integer coefficients.
\MB{TBD}
\end{example}

\subsection{Mixed rings}\label{sec:mixring}

Here we explore a definition of a ring that is based
on a concrete group $G$ and left and right multiplications 
that are still half abstract. %Therefore we call them mixed rings.

We first note that, for any abstract ring $\mathscr R$ and elements $a,b:R$,
the left multiplication function $(a\cdot\blank)$ 
and the right multiplication function $(\blank\cdot b)$ are
abstract homomorphisms
of the additive group $(R,0,+,-)$ of $\mathscr R$ to itself.\footnote{%
    These functions provide two ways to write the product $a\cdot b$,
see the coherence law in \cref{def:mixring}\ref{mixring:lr-coherence-law}.}
There are two ways to compose them: $(a\cdot(\blank\cdot b))$
and $((a\cdot\blank)\cdot b)$. Equality of the latter two functions is
an elegant way of expressing associativity.
These observations lead to the following alternative definition of a ring.

\begin{definition}\label{def:mixring}
An \emph{mixed ring} $R$ consists of a group\footnote{%
It will follow as in \cref{xca:ring-group-abelian} that the group $R$
is abelian.} also denoted $R$ together with
a symmetry $1_R : \USymR$ and two maps $\ell,r: \USymR\to\Hom(R,R)$
from the set of symmetries in $R$ to the set of homomorphisms from
$R$ to $R$.\footnote{We call these rings ``mixed'' since they are
based on a concrete group $R$ and data referring to $\abstr(R)$.}
Given $g:\USymR$, we write $\ell_g$ for the homomorphism $\ell(g)$ and 
$r_g$ for $r(g)$.
Moreover, the following equations should hold.
    \begin{enumerate}
    \item\label{mixring:unit-laws} $\ell_{1_R} = \id_G = r_{1_R}$ (the \emph{multiplicative unit laws})
    \item\label{mixring:lr-coherence-law} $(\USym\ell_g)(h) = (\USymr_h)(g)$, 
    for all $g,h : \USymR$ (the \emph{coherence law})
        \item\label{mixring:assoc-law} $\ell\circ r= r\circ\ell$ (the \emph{associativity law})
    \end{enumerate}
%The properties \ref{mixring:unit-laws}-\ref{mixring:assoc-law} 
%are together denoted by $\RingProps(R,1_R,\ell,r)$.
The ring $R$ is called \emph{commutative} if $\ell=r$,
and \emph{non-trivial} if $1_R \neq \refl{R}$.
\end{definition}

The coherence law \ref{mixring:lr-coherence-law} allows us to abbreviate both 
$(\USym\ell_g)(h)$ and $(\USymr_h)(g)$ by $g\cdot h$. We will do this when
no confusion can occur. Then, $\ell=r$ 
amounts to $g\cdot h = h\cdot g$, for all $g,h : \USymG$,
as could be expected from the abstract case.

We proceed by giving the standard example of the integers as a ring
in the sense of \cref{def:mixring}.
\begin{example}
Consider the group $\ZZ$ classified by the circle.
Using the same notation $\ZZ$ also for the ring, take $1_\ZZ \defeq\Sloop$
and $\ell: (\base\eqto\base)\to\Hom(\ZZ,\ZZ)$ defined as follows.
For every $g:\base\eqto\base$, let $\ell_g$ be the homomorphism
classified by the map $\B\ell_g(\base)\defeq\base$, 
$\B\ell_g(\Sloop)\defis g$, and pointed by reflexivity.\footnote{%
The reader may recognize the degree $m$
map from \cref{def:mfoldS1cover} as a special case.}
Take $r\defeq\ell$. Now the unit laws, the coherence law and
the associativity law can easily be verified. It follows that
$(\ZZ,1_\ZZ,\ell,!)$ is a non-trivial commutative ring.
\end{example}

\DELETE{\begin{definition}\label{def:typemixring}
The type of rings is defined as
\[
\typering\defeq\sum_{R:\typegroup}\sum_{1_R:\USymR}\sum_{\ell,r:\USymR\to\Hom(R,R)} \RingProps(R,1_R,\ell,r).
\]
The type $\typecommring$ of commutative rings is similar to the type
of rings but with $\RingProps(R,1_R,\ell,r) \times(\ell=r)$. 
\end{definition}
}% end DELETE

\begin{xca}\label{xca:Rmixring->URabstring}
Let $(R,1_r,\ell,r)$ be an mixed ring. 
Show that $\USymR$ is an abstract ring with
additive group $\abstr(R)$ and multiplicative 
monoid $(\USymR,1_R,\cdot)$. \MB{TBD}
\end{xca}

\subsection{Move to a better place (Ch.\ 11 or 2)}
\begin{marginfigure}
  \begin{tikzcd}[ampersand replacement=\&,column sep=small]
  \pt_Y\ar[rr,eqr,"f_\pt"]\ar[ddrr,eql,"g_\pt"']
  \& \& f(\pt_X)  \ar[dd,eqr,"k(\pt_X)"]
  \\ \& \mbox{} \& \\
  \pt_Y\ar[uu,"{\jdeq}"']\ar[rr,eql,"g_\pt"']\ar[ddrr,eql,"h_\pt"']    
  \& \mbox{} \& g(\pt_X)\ar[dd,eqr,"k'(\pt_X)"]
  \\\& \mbox{} \& \\
 \&\& h(\pt_X)
  \end{tikzcd}
  \caption{\label{fig:ptd-homotopy-compo}
  Path for $(k'\cdot_{\protect\ptw} k)$.} 
\end{marginfigure}
\begin{definition}\label{def:ptd-homotopy-compo}
Let $X$Â and $Y$ be pointed types and
$f,g: X\ptdto Y$ pointed maps from $X$ to $Y$.
Recall from \cref{con:identity-ptd-maps} the equivalence $\ptw_*$ of type 
$(f\eqto g) \equivto H(f,g)$, where 
\[ H(f,g) \defeq \sum_{k:\prod_{x:X}(f_\div(x)\eqto g_\div(x))}
                               ((k(\pt_X)\cdot f_\pt) \eqto g_\pt ).
\]

Assume also $h: X\ptdto Y$ and let $k: H(f,g)$ and 
$k': H(g,h)$. In line with the notation for pointed maps, 
we denote the pair $k$ by $(k_\div,k_\pt)$, an likewise for $k'$. 
Define the \emph{pointwise composition}
$(k'\cdot_{\ptw} k)$ of $k'$ and $k$ by\footnote{%
We'll use the notation ``$\cdot_{\ptw}$'' also for $k'_\div$ and $k_\div$.
As we do for pointed maps, we will often drop the subscript ``$\div$''.}
\begin{align*}
\bigl(k'\cdot_{\ptw} k\bigr)&\defeq
\bigl(k'_\div\cdot_{\ptw} k_\div ~,~ 
       k'_\pt\cdot\ap{(k'_\div(\pt_X)\cdot\blank)}(k_\pt)\bigr),
\quad\text{where}\\
(k'_\div\cdot_{\ptw} k_\div) &\defeq (x\mapsto k'_\div(x)\cdot k_\div(x)).
\end{align*}
In \cref{fig:ptd-homotopy-compo}, the upper-right triangle represents
the type of $k_\pt$, the upper-left triangle is a reflexivity triangle,
the lower triangle represents the type of $k'_\pt$,
and the outer diagram represents the type 
$k'(\pt_X)\cdot k(\pt_X)\cdot f_\pt \eqto h_\pt$
of $k'_\pt\cdot\ap{(k'_\div(\pt_X)\cdot\blank)}(k_\pt)$.
Thus we see that $(k'\cdot_{\ptw} k)$ is an element of $H(f,h)$.
\end{definition}

\begin{construction}\label{con:ptd-homotopy-compo}
Let conditions be as in \cref{def:ptd-homotopy-compo}.
Let $p:(f\eqto g)$ and $q:(g\eqto h)$.
Then we have an identification of $\ptw_*(qp)$ with
$\ptw_*(q) \cdot_{\ptw} \ptw_*(p)$.
\end{construction}
\begin{implementation}{con:ptd-homotopy-compo}
By path induction on $q$, it suffices to construct an identification
of $\ptw_*(p)$ and $\ptw_*(\refl{g}) \cdot_{\ptw} \ptw_*(p)$.
Using \cref{con:identity-ptd-maps} and \cref{def:funext} we
can identify $\ptw_*(\refl{g})$ with the pair
$((x\mapsto\refl{g_\div(x)}),\refl{g_\pt)}$. 
For use in \cref{fig:ptd-homotopy-compo} we write the latter
pair as $(k'_\div,k'_\pt)$, noting that $h\jdeq g$ in this case.
Writing also $(k_\div,k_\pt)$ for $\ptw_*(p)$, the goal is to
identify $(k'\cdot_{\ptw} k)$ with $k$.
This identification is easily obtained by using
that $\refl{g(x)}\cdot r$ is definitionally equal to $r$,
for all $x:X$ and $r:f(x)\eqto g(x)$.
\end{implementation}

Recall from \cref{thm:abelian-groups-weq-sc2types} the equivalence
$\BB$ from the type of abelian groups to the type of pointed
simply connected $2$-types. Let $H:\Group$ be a group and let
$G:\AbGroup$ be an abelian group.
Then $\BB G$ and hence also $\BH\ptdto\BB G$ is a $2$-type, 
pointed at the constant map that sends any $w:\BH$ to the 
point $\pt_{\BB G}\defeq (\BG_\div,\settrunc{\id_{\BG_\div}})$ 
of $\BB G$.\footnote{Itself pointed by reflexivity.} In fact,
the type $\BG\ptdto\BB G$ is a $1$-type, since the maps are pointed.

\begin{definition}\label{def:AbHomgroup}
Let $H:\Group$ be a group and let $G:\AbGroup$ be an abelian group. 
Define the group $\grpHom(H,G)$ of homomorphisms from $H$ to $G$ by 
\[
\grpHom(H,G) \defeq \Aut_{\BH\ptdto\BB G}
((w \mapsto \pt_{\BB G}),\refl{\pt_{\BB G}}).\qedhere
\]
\end{definition}

The above definition of $\grpHom(H,G)$ is indeed serving its purpose:

\begin{lemma}\label{lem:grpHomOK}
Let conditions be as in \cref{def:AbHomgroup}. Abbreviate the shape
$((w\mapsto \pt_{\BB G}),\refl{\pt_{\BB G}})$ of $\grpHom(H,G)$ by $\sh$. 
Consider the following chain of equivalences\footnote{%
The first is $\ptw_*$ from \cref{con:identity-ptd-maps} 
(with path inverted). 
The second is composition with $\ev_{\sh_G}$
from \cref{sec:center-group}, which is an equivalence since $G$ is abelian.
The third is essentially $\abstr$ from \cref{def:abstrisfunctor}.}
\begin{align*}
(\sh\eqto\sh) &\equivto 
\sum_{h:\BH_\div\to(\pt_{\BB G}\eqto\pt_{\BB G})} 
  (\refl{\pt_{\BB G}}\eqto h(\sh_H)) \\
              &~\jdeq \qquad \bigl(\BH\ptdto((\pt_{\BB G}\eqto\pt_{\BB G}),\refl{\pt_{\BB G}})\bigr)\\
 &\equivto \qquad\! \bigl(\BH\ptdto\BG\bigr)\\
% &\jdeq\qquad~\BHom(G,G)\\
 &\equivto \qquad \absHom(\abstr(H),\abstr(G)).
\end{align*}
Then the composite of the above chain defines an abstract isomorphism
from $\abstr(\grpHom(H,G))$ to $\absHom_{\ptw}(\abstr(H),\abstr(G))$.
\end{lemma}
\begin{proof}
%$\pathpair{h}{h_\pt}:\sh\eqto\sh$
Given $p:(\sh\eqto\sh)$, the equivalence $\ptw_*$ from 
\cref{con:identity-ptd-maps} gives a pair $\ptw_*(p)$ which
we denote by $(\ptoe p,p_\pt)$. Here 
$\ptoe p :\BH_\div\to(\pt_{\BB G}\eqto\pt_{\BB G})$ maps any $w:\BH$ to 
$\ptoe p(w)$ corresponding\footnote{%
This uses \cref{eq:id-types-universal-cover} and univalence.}
to a pair consisting of an equivalence (by the same name)
$\ptoe p(w):(\BG_\div\equivto\BG_\div)$ and a proof of
$\Trunc{\ptoe p(w) \eqto \id_{\BG_\div}}$, that is,
all $\ptoe p(w)$ are merely equal to the identity.
The second component $p_\pt$ of $(\ptoe p,p_\pt)$ is an
identification of $\refl{\pt_{\BB G}}$ with $\ptoe p(\sh_H)$,
which gives us an identification (by the same name) $p_\pt$ of 
$\id_{\BG_\div}$ with $\ptoe p(\sh_H)$.\footnote{%
Technically, we should write $\fst(p_\pt)$,
but $\snd(p_\pt)$ is true propositional data and plays no role.}

In the following, until the end of the proof,
we abbreviate $\sh_G$ by $\base$.
The goal is to prove, for any $p,q:(\sh\eqto\sh)$ and $g:\USymH$, 
the proposition
\[
\bigl(\loops(\ev_{\base}\circ \ptw_*(pq))\bigr)(g) = 
\bigl(\loops(\ev_{\base}\circ \ptw_*(p)\bigr)(g)\cdot
\bigl(\loops(\ev_{\base}\circ \ptw_*(q)\bigr)(g).
\]

%Then, by \cref{con:ptd-homotopy-compo}, we have that $(\ptoe{pq})$
%is pointed by $p_\pt\cdot\ap{(\ptoe p(\sh_H)\cdot\blank)}(q_\pt):
%(\refl{\pt_{\BB G}}\eqto \ptoe p(\sh_H)\ptoe q(\sh_H))$.
We first elaborate the right hand side.
Note that $\ev_\base(\ptoe p(\sh_H))\jdeq \ptoe p(\sh_H)(\base)$. 
The pointing path of $\ev_{\base}\circ (\ptoe p,p_\pt)$
is $\ev_{\base}(p_\pt)$, which is equal to $\ptw(p_\pt)(\base)$,
and we have $\ev_{\base}(\ptoe p(g)) = \ptw(p(g))(\base)$.\footnote{%
By induction on $r: s \eqto_{A\eqto A} t$ one easily constructs for all
types $A$ and elements $a:A$ an identification $\ev_a(r) \eqto \ptw(r)(a)$.}

Using the definition of $\loops$ from \cref{def:loops-map},
we calculate:
\begin{align*}
\loops(\ev_{\base}\circ (\ptoe p,p_\pt))(g) &= 
\inv{\ptw(p_\pt)(\base)} \cdot \ev_{\base}(\ptoe p(g)) \cdot {\ptw(p_\pt)(\base)}\\
              &= 
\ptw (\inv{p_\pt} \cdot \ptoe p(g) \cdot p_\pt)(\base)
~\text{in type $\base\eqto\base$}.
\end{align*}
Likewise we obtain for $\ptoe q$ and $(\ptoe{pq})$ the following
equalities:
\begin{align*}
\loops(\ev_{\base}\circ (\ptoe q,q_\pt))(g) &=  
\ptw (\inv{q_\pt} \cdot \ptoe q(g) \cdot q_\pt)(\base)
\\
\loops(\ev_{\base}\circ (\ptoe {pq},(pq)_\pt))(g) &=  
\ptw (\inv{(pq)_\pt} \cdot (\ptoe{pq})(g) \cdot (pq)_\pt)(\base)
\end{align*}

We continue with elaboration the latter equality in three steps.

First, by \cref{con:ptd-homotopy-compo}, we have an identification
$\ptw_*(pq) \eqto \ptw_*(p) \cdot_{\ptw} \ptw_*(q)$,
with $\cdot_{\ptw}$ as given in \cref{def:ptd-homotopy-compo}.
This gives an identification of type
$(\ptoe{pq})\eqto(w\mapsto \ptoe p(w)\cdot\ptoe q(w))$,
which we (\MB{abusively}) take to be definitional.
Hence, $(\ptoe{pq})(\sh_H)\jdeq (\ptoe p(\sh_H)\cdot\ptoe q(\sh_H))$,
which as function $\BG_\div\equivto\BG_\div$ corresponds to
the composition $\ptoe p(\sh_H) \circ \ptoe q(\sh_H)$.

Second, also need a path $(pq)_\pt$ from $\id_{\BG_\div}$ 
to $(\ptoe{pq})(\sh_H)$. For this we take
$(pq)_\pt \jdeq \ap{(\ptoe p(\sh_H)\cdot\blank)}(q_\pt)\cdot p_\pt$,
which follows from \cref{def:ptd-homotopy-compo}.\footnote{%
The order is reversed wrt \ref{def:ptd-homotopy-compo}
because the paths are reversed: 
$q_\pt: \refl{\BG_\div}\eqto \ptoe q(\sh_H)$,
so $\ap{(\ptoe p(\sh_H)\cdot\blank)}(q_\pt): \ptoe p(\sh_H) \eqto 
\ptoe p(\sh_H) \cdot \ptoe q(\sh_H)$, so $p_\pt$ must be precomposed.   
}

Third, we elaborate $(\ptoe{pq})(g)$ which is shorthand for 
$\ap{w\mapsto \ptoe p(w)\ptoe q(w)}(g)$. In order to be able to
do induction on $g$, we loosen up the endpoint of $g$. 
Let $w:BH_\div$, $g:\sh_H\eqto w$, $z:\BG_\div$
and consider the following diagram. The task is to find
a path from $\ptoe p(\sh_H)(\ptoe q(\sh_H)$ to $\ptoe p(w)(\ptoe q(w)$
that can be identified with $\ap{w\mapsto \ptoe p(w)\ptoe q(w)}(g)$.
\[
   \begin{tikzcd}[ampersand replacement=\&]    
     \&\BG_\div 
       \ar[r,"\ptoe q(\blank)"]
     \&\BG_\div 
       \ar[r,"\ptoe p(\blank)"]
     \&\BG_\div
%     \&\ptoe p(\sh_H)(\ptoe q(w)(z)) \ar[dl,eqr,"r_2"]
\\     
     \sh_H\ar[dd,eqr,"g"]
     \&z 
       \ar[r,mapsto,"\ptoe q(\sh_H)"]
     \&\ptoe q(\sh_H)(z)
       \ar[r,mapsto,"\ptoe p(\sh_H)"]
     \&\ptoe p(\sh_H)(\ptoe q(\sh_H)(z))
%       \ar[dd,bend left=40,"?", "="' pos=0.2]
       \ar[d,eqr,"{r_1(g,z)}"]
\\    
     \&
     \&
     \&\ptoe p(\sh_H)(\ptoe q(w)(z))
        \ar[d,eqr,"{r_2(g,z)}"]
\\     
     w
     \&z 
       \ar[r,mapsto,"\ptoe q(w)"]
     \&\ptoe q(w)(z) 
       \ar[r,mapsto,"\ptoe p(w)"]
     \&\ptoe p(w)(\ptoe q(w)(z))
   \end{tikzcd}
\]
There are two ways to proceed.
One is based on the composite of the paths
$r_1(g,z)\defeq \ptoe p(\sh_H)(\ptw(\ptoe q(g))(z))$ and 
$r_2(g,z)\defeq \ptw(\ptoe p(g))(\ptoe q(w)(z))$ of types
as shown above.\footnote{%
The other way is analogous, based on the intermediate point
$\ptoe p(w)(\ptoe q(\sh_H)(z))$ instead of $\ptoe p(\sh_H)(\ptoe q(w)(z))$,
with $r_1(g,z)\defeq (\ptw(\ptoe p(g)))(\ptoe q(\sh_H)(z))$
and $r_2(g,z)\defeq \ptoe p(w)((\ptw(\ptoe q(g)))(z))$.}
 
We proceed by induction on $g$ and take
$g\jdeq\refl{\sh_H}$, so $w\jdeq\sh_H$. Then we have
$\ap{w\mapsto \ptoe p(w)\ptoe q(w)}(g) 
\jdeq \refl{\ptoe p(\sh_H)(\ptoe q(\sh_H)}$. Also in this case,
both $r_1(g,z)$ and $r_2(g,z)$ are definitionally equal to
$\refl{\ptoe p(\sh_H)(\ptoe q(\sh_H)(z))}$.
It follows that $\ap{w\mapsto \ptoe p(w)\ptoe q(w)}(g)$ is equal
to $\inv\ptw(z\mapsto r_2(g,z)\cdot r_1(g,z))$ for any $g:\sh_H\eqto w$. 

We can now reformulate the goal as %\footnote{%
%The shape $\base$ is arbitrary and $\ptw$ is an equivalence.}
the equality of 
\[
\ptw\Bigl(\inv{p_\pt} \cdot \ptoe p(g) \cdot p_\pt \cdot
\inv{q_\pt} \cdot \ptoe q(g) \cdot q_\pt\Bigr)(\base) 
\]
and the composition of the following four paths: 
\begin{align*}
\ptw\Bigl(\inv p_\pt \cdot \ap{(\ptoe p(\sh_H)\cdot\blank)}(\inv{q_\pt})\Bigr)(\base)
&\quad\text{coming from $\inv{(pq)}_\pt$} \\
\ptw\Bigl(\ptoe p(g)\Bigr)(\ptoe q(\sh_H)(\base))
&\quad\text{coming from $r_2$} \\
\ptoe p(\sh_H)(\ptw\Bigl(\ptoe q(g)\Bigr)(\base))
&\quad\text{coming from $r_1$} \\
\ptw\Bigl(\ap{(\ptoe p(\sh_H)\cdot\blank)}(q_\pt)\cdot p_\pt\Bigr)(\base) 
&\quad\text{coming from $(pq)_\pt$.}
\end{align*}

\MB{Plan:}
Transport the goal along the paths
$p_\pt: (\id_{\BG_\div}\eqto\ptoe p(\sh_H))$ and
$q_\pt: (\id_{\BG_\div}\eqto\ptoe q(\sh_H))$.

\MB{W.i.p.}

\end{proof}

\begin{remark}\label{rem:grpHomOK}
We explore two alternative approaches to the lemma above,
generalizing from $\BG$ and $\BB G$.
Assume that $X$ is a pointed $1$-type and $Y$ a
pointed $2$-type.\footnote{This should not be needed, but intends to
simplify by making $p=_{\loops X}q$ and $p=_{{\loops}^2 Y}q$
proof-irrelevant.}
\begin{marginfigure}
  \begin{tikzcd}[ampersand replacement=\&,column sep=small]
  \loops(X\ptdto Y)\ar[rr,eqr,"{\ptw_*}"]\ar[dd,"{\loops(\loops)}"']
  \& \& X\ptdto \loops Y  \ar[dd,"{\loops}"]
  \\ \& \mbox{} \& \\
  \loops(\loops X\ptdto \loops Y) \ar[rr,eql,"{\ptw_*}"']   
  \& \mbox{} \& \loops X\ptdto {\loops}^2 Y
  \end{tikzcd}
  \caption{\label{fig:ulrik}
  Fill!} 
\end{marginfigure}

First approach. We start by constructing the function 
denoted by ${\loops(\loops)}$ in \cref{fig:ulrik}, with type 
$$\loops(X\ptdto Y) \to \loops(\loops X\ptdto \loops Y).$$
Recall the map $\loops : ((X\ptdto Y)\to(\loops X\ptdto \loops Y))$
sending  a pointed map $f:X\ptdto Y$ to $\loops(f)$ defined by 
\[
\loops(f)(p) \defeq \inv{f_\pt}\cdot \ap{f_\div}(p) \cdot f_\pt
\quad\text{for any $p:\pt_X\eqto\pt_XÂ $,}
\]
pointed by an element $\loops(f)_\pt$ of 
$\refl{\pt_Y} \eqto \inv{f_\pt}\cdot \ap{f_\div}(\refl{\pt_X}) \cdot f_\pt$.%
\footnote{
Obtained by path algebra, not in general a reflexivity path.}
Before we can apply ${\loops}$ to this map we have to point it.
The point of $X\ptdto Y$ is the constant 
map $x\mapsto\pt_Y$ pointed by reflexivity.
The point of $\loops X\ptdto \loops Y$ is the constant 
map $p\mapsto\refl{\pt_Y}$ pointed by reflexivity.
We have
\[
\loops(x\mapsto\pt_Y)(p) \defeq 
\inv{\refl{\pt_Y}}\cdot \ap{x\mapsto\pt_Y}(p) \cdot \refl{\pt_Y}.
\]
Now, since $\ap{x\mapsto\pt_Y}(p) \eqto \refl{\pt_Y}$ 
for all $p: \loops(X)$, by path algebra and function extensionality, 
we get a pointing path
$\pi: (p\mapsto \refl{\pt_Y})\eqto \loops(x\mapsto\pt_Y)$.

The desired map is now $\loops(\loops)$, which is short for
$\loops((f:X\ptdto Y) \mapsto \loops(f))$ of type $\loops(X\ptdto Y) \to \loops(\loops X\ptdto \loops Y)$, defined by
\[
(\loops(\loops))(q)\defeq\inv\pi\cdot\ap{f\mapsto\loops(f)}(q)\cdot\pi
\quad\text{for any $q:\loops(X\ptdto Y)$}.
\]
Note that the type of $q$ is 
$(x\mapsto\pt_Y,\refl{\pt_Y})\eqto(x\mapsto\pt_Y,\refl{\pt_Y}))$.
The type of $\ap{f\mapsto\loops(f)}(q)$ is
$\loops(x\mapsto\pt_Y,\refl{\pt_Y})\eqto\loops(x\mapsto\pt_Y,\refl{\pt_Y}))$,
which is (by the above) equivalent to 
$(p\mapsto \refl{\pt_Y})\eqto(p\mapsto \refl{\pt_Y})$,
so by function extensionality equivalent to 
$\loops(X)\to\loops(\loops(Y))$. Under this equivalence,
$\ap{f\mapsto\loops(f)}(q)$ corresponds to $\ptw(\fst(q))$. 
\MB{TODO: use $\snd(q)$ to get a pointing path and check everything!}

Second approach. This approach uses the equivalence
between pointed maps from $\Sc\ptdto A$ and loops $\pt_A\eqto\pt_A$
from \cref{cor:circle-loopspace}.
\def\Scc{\wip{\Sc}}
\begin{figure}[h]
  \begin{tikzcd}[ampersand replacement=\&,column sep=small]
  \Sc(X\ptdto Y)\ar[rr,eqr,"{e_{X,Y}}"]\ar[dd,"{O\circ\blank}"']
  \& \& X\ptdto \Sc Y  \ar[dd,"{O'}"] \ar[ddrr,"{O}"]
  \\ \& \mbox{} \& \\
  \Sc(\Scc X\ptdto \Scc Y) \ar[rr,eql,"{e_{\Scc X,\Scc Y}}"']   
  \& \mbox{} \& \Scc X \ptdto \Sc (\Scc Y) \ar[rr,eql,"{\text{swap}}"']
  \&\&  \Scc X \ptdto \Scc (\Sc Y) 
  \end{tikzcd}
  \caption{\label{fig:bjÃ¸rn}
  Fill! Here $\Sc A$ means $\Sc\ptdto A$ and the colors track
  related occurrences of $\Sc$. \MB{Perhaps}
  we must use the equivalence $-\id_\Sc : \Sc\ptdto\Scc$ defined by
  $\base\mapsto\base$ and $\Sloop\mapsto{\Sloop}^{-1}$
  for the pointing paths?} 
\end{figure}

The map $O: ((X\ptdto Y)\ptdto((\wip{\Sc}\ptdto X)\ptdto(\wip{\Sc}\ptdto Y))$
is easy: $O(f)\defeq (p\mapsto (f\circ p))$ for any $f:X\ptdto Y$.\footnote{%
We write $O$ for $O_{X,Y}$, and also for $O_{X,\Sc Y}$.
Name $p$ since $(\Sc\ptdto X)\we\loops(X)$.
Similarly for $q:\Sc\ptdto (X \ptdto Y)$.}
We have to point $O$ and hence calculate 
\begin{align*}
O(x\mapsto\pt_Y,\refl{\pt_Y})
&\jdeq (p\mapsto(x\mapsto\pt_Y,\refl{\pt_Y})\circ p)\\
&\eqto (p\mapsto (z\mapsto\pt_Y,\refl{\pt_Y}))
 \jdeq\pt_{(\wip{\Sc}\ptdto X)\ptdto(\wip{\Sc}\ptdto Y)},
\end{align*}
with the identity in the middle by function extensionality,
composition of pointed maps and path algebra.
Hence we can point $O$ by the inverse identification which we denote $\tau$.
Composition with $O$, \ie $(O\circ\blank)\defeq(q\mapsto O\circ q)$,
gives the map\footnote{
This map corresponds to the map of type
$\loops(X\ptdto Y) \to \loops(\loops X\ptdto \loops Y)$
constructed in the first approach.} 
along the left down arrow in \cref{fig:bjÃ¸rn}:
\[
(O\circ\blank): (\Sc\ptdto(X\ptdto Y))\to
(\Sc\to((\Scc\ptdto X)\ptdto(\Scc\ptdto Y)).
\]

The middle down arrow in \cref{fig:bjÃ¸rn} maps
$g:X\ptdto(\Sc\ptdto Y)$ to $O'(g)$ defined by $O'(g)(p) \defeq
((z:\Sc) \mapsto ((w:\Scc) \mapsto g(p(w),z)))$.
This is to be compared to $O(g)(p) \defeq
((z:\Sc) \mapsto ((w:\Scc) \mapsto g(p(z),w)))$ in the right down arrow. 

Next are the horizontal equivalences, which are easy. The lower left one
is a special case of the upper one, which we call $e_{X,Y}$ and 
define by $e_{X,Y}(f) \defeq ((x:X) \mapsto ((z:\Sc) \mapsto f(z,x)))$ for
any $f:\Sc\ptdto (X\ptdto Y)$.
The lower right one makes up for the difference between $O$ and $O'$
so that the right triangle commutes definitionally:\footnote{%
As unpointed maps. \MB{TODOs:}
Pointing paths. Check that $O$ corresponds to $\loops$
and that $e$ corresponds to $\ptw_*$ (should be easy).}
\[
\text{swap} \defeq (h\mapsto (p:\Scc X, z:\Sc,w:\Scc) \mapsto h(p,w,z)).
\]
The left square in \cref{fig:bjÃ¸rn} also commutes definitionally,
as unpointed maps. \MB{W.i.p.}
\end{remark}


\subsection{Concrete rings}\label{sec:concrings}

We will now elaborate an approach to rings that is even more concrete
than mixed rings. For the latter rings we took the
obvious first step to replace the abstract additive group by a 
(concrete) group. Since monoids have no concrete counterpart in our set up,
we replaced in \cref{def:mixring} the multiplicative monoid 
by the half abstract $\ell,r:\USymR\to\Hom(R,R)$.

The use of $\ell,r$ was based on the observation that, 
for any abstract ring $\mathscr R$, left and right multiplication
by a fixed but arbitrary element of $R$ are 
abstract homomorphisms from the additive group $(R,0,+,-)$ of 
$\mathscr R$ to itself. 
Even more so, the map $a\mapsto(a\cdot\blank)$ is an abstract homomorphism
from $(R,0,+,-)$ to the abstract group $\absHom_{\ptw}(R,R)$
of abstract homomorphisms from $(R,0,+,-)$ to itself, with
pointwise operations induced by $(R,0,+,-)$.\footnote{%
$\absHom_{\ptw}(R,R)$ is an abelian abstract group by
\cref{xca:abs-homgroup} and \cref{xca:abstract-group-of-maps}.}

Given that we have replaced $(R,0,+,-)$ by an abelian group $G:\Group$,
the plan is to deloop $\absHom_{\ptw}(\abstr(G),\abstr(G))$. 
Denoting the result of the delooping by $\grpHom(G,G)$,\footnote{%
This notation presupposes that $G$ is abelian and distinguishes 
the \emph{set} of homomorphisms from $G$ to $G$ from the \emph{group}
with this set of homomorphisms as underlying set.}
we can then define the multiplication as a homomorphism
$\mu: \Hom(G,\grpHom(G,G))$.

One way of delooping $\absHom_{\ptw}(\abstr(G),\abstr(G))$ would be
to use the inverse of $\abstr$ in \cref{lem:homomabstrconcr}
which involves torsors.  
We prefer to use $\grpHom(G,G)$ from \cref{def:AbHomgroup},
making direct use of the assumption that $G$ is abelian.


\begin{definition}\label{def:ring}
A \emph{ring} $R$ consists of the following data:
\begin{enumerate}
\item An abelian group also denoted $R$;
\item A homomorphism $1_R:\Hom(\ZZ,R)$;
\item A homomorphism $\mu: \Hom(R,\grpHom(R,R))$, with $\grpHom(R,R)$
the group defined in \cref{def:AbHomgroup}.
\end{enumerate}
Moreover, the following equations should hold:
    \begin{enumerate}
    \item\label{ring:unit-laws}\
    $\ev\circ(\USym(\mu\circ{1_R})(\Sloop)) = \B\id_R \approx \MB{TBD}$ 
    (the \emph{multiplicative unit laws})\footnote{%
\MB{Not great:} $\USym(\mu\circ{1_R})$ is an abstract homomorphism
from $\USym\ZZ$ to $\USym\Hom(R,R)$ and the latter type
is equivalent to $(\BR\ptdto\loops\BB R)$. Finally by postcomposition
with $\ev$, we get equivalence with $(\BR\ptdto\BR)$.
The other unit law is probably worse.}
    \item\label{ring:assoc-law} \MB{TBD} (the \emph{associative law}). %for all $z : \BR$
    \end{enumerate}
The properties \ref{ring:unit-laws}-\ref{ring:assoc-law} 
are together denoted by $\RingProps(R,1_R,\mu)$.
The ring $R$ is called \emph{commutative} if \MB{TBD}, 
and \emph{non-trivial} if $1_R$ is not trivial.\footnote{%
A homomorphism is trivial if it classified by the constant function
at the shape to the target group. Or, equivalently, if it factors
through the trivial group.}
\end{definition}

We proceed by giving the standard example of the integers as a ring
in the sense of \cref{def:ring}.

%\MB{CURSOR}

\begin{example}
We take the group $\ZZ$ of the integers classified by the circle
as the abelian group for the ring of the integers.
We take $1_\ZZ \defeq \id_\ZZ$, the identity homomorphism.
For defining $\mu$ we first elaborate $\Hom(\ZZ,\ZZ)$ as a group.
Unfolding the definition we get (leaving the points implicit)
$\B\Hom(\ZZ,\ZZ) \jdeq(\Sc\ptdto\sum_{X:\UU}\setTrunc{\Sc\eqto X})$.
The shape of $\Hom(\ZZ,\ZZ)$ is the constant map 
that sends any $z:\Sc$ to $(\Sc,\settrunc{\id_{\Sc}})$, pointed by reflexivity.

Recall that $\BB\ZZ \jdeq \sum_{X:\UU}\setTrunc{\Sc\eqto X})$,
pointed at $\sh_{\BB\ZZ}\jdeq (\Sc,\settrunc{\id_\Sc})$.
For $\mu: \Hom(\ZZ,\Hom(\ZZ,\ZZ))$ we take,\footnote{\MB{Exercise material?}
Define $s:\id_\Sc\eqto\id_\Sc$ by function extensionality,
setting $s(\base)\defeq\Sloop$, $s(\Sloop)\defis {!}$.
Now define $e_z: \Sc\eqto\Sc$ by $e_z(\base)\defeq z$,
$e_z(\Sloop) \defis s(z) : (z\eqto z)$. Indeed, $e_\base = \id_\Sc$
and, by path induction $e_p(\base)=p$ for all $p:\base\eqto z$,
so $e_{\Sloop} = s$.}
with $\ve$ from \cref{lem:freeloopspace},
\[
\B\mu \defeq (z:\Sc) \mapsto \ve_{\BB\ZZ}(\sh_{\BB\ZZ},(e_z,!)).
\]
In this succint definition, $\ve_{\BB\ZZ}(\sh_{\BB\ZZ},\settrunc{e_z})$
can be identified as the function from $\Sc$ to $\BB\ZZ$ that sends 
$\base$ to $\Sc$ and $\Sloop$ to $(e_z,!)$ where $e_z:(\Sc\eqto\Sc)$,
$!: \Trunc{e_z\eqto\id_\Sc}$. In the following we focus on first components,
that is, on $\Sc$ and $e_z$, analyzing how $\B\mu$ applies to paths.

For any $z:\Sc$ and $k:\zet$ we have that 
$\B\mu(z,{\Sloop}^k)= e_z^k : (\Sc\eqto\Sc)$.
Hence for any $j:\zet$ we have that 
$\B\mu({\Sloop}^j,{\Sloop}^k )= e_{{\Sloop}^j}^k = s^{jk}: (\id_\Sc\eqto\id_\Sc)$.
\MB{Almost there! Use $\ev$ to get to $\USym\ZZ$?}




%\cref{xca:(S1->S1)_(f)-eqv-S1,xca:S1=S1-components},
%which give an equivalence $e:\Sc\to(\Sc\eqto\Sc)_{\id_\Sc}$
%which maps $\base$ to $\id_\Sc$.%
It follows that
$(\ZZ,1_\ZZ,\mu)$ is a non-trivial commutative ring.
\end{example}

\begin{xca}\label{xca:Rconcring->URabstring}
Let $(R,1_r,\mu)$ be a ring. Show that $\USymR$ is an abstract ring with
additive group $\abstr(R)$ and multiplicative monoid 
$(\USymR,\USym1_R(\Sloop),\USym\mu$. \MB{TBD}
\end{xca}
%Solution: 



\MB{TBD define type of (abstract) rings, prove equivalence, define
ring homomorphisms, delooping etc. No interesting difficulties
expected before we come to fields.}





\begin{definition}
Given a commutative ring $R$, an element $e:R$ is \textbf{invertible} if there exists an element $a:R$ such that $e \cdot a = 1$ and $a \cdot e = 1$:
$$\mathrm{isInvertible}(e) := \left\Vert\sum_{a:R} (e \cdot a = 1) \times (a \cdot e = 1)\right\Vert$$
\end{definition}

\begin{theorem}
In any nontrivial commutative ring $R$, $0$ is always a non-invertible element. 
$$\mathrm{isNonTrivialCRing}(R) \to \neg \mathrm{isInvertible}(0)$$
\end{theorem}

\begin{proof}
Suppose that $0$ is invertible. Then there exists an element $a:R$ such that $a \cdot 0 = 1$. However, due to the absorption properties of $0$ and the fact that $R$ is a set, $a \cdot 0 = 0$. This implies that $0 = 1$, which contradicts the fact that $0 \neq 1$ in a nontrivial commutative ring. Thus, $0$ is a non-invertible element in any nontrivial commutative ring $R$. 
\end{proof}

\begin{definition}
A nontrivial commutative ring $R$ is a \textbf{field} if and only if the type of all non-invertible elements in $R$ is contractible:
$$\mathrm{isField}(R) := \mathrm{isNonTrivialCRing}(R) \times \mathrm{isContr}\left(\sum_{x:R} \neg \mathrm{isInvertible}(x)\right)$$ 
Equivalently, $R$ is a field if and only if every non-invertible element is equal to zero. 
\end{definition}

\begin{remark}
In other parts of the constructive mathematics literature, such as in Peter Johnstone's \textit{Rings, Fields, and Spectra}, this is called a "residue field". However, in this book we shall refrain from using the term "residue field" for our definition, since that contradicts the usage of "residue field" in other parts of mathematics, such as in algebraic geometry. 
\end{remark}

\begin{definition}
A field is \textbf{discrete} if every element is either invertible or equal to zero. 
$$\mathrm{isDiscreteField}(R) := \mathrm{isField}(R) \times \prod_{a:R} \Vert(a = 0) \amalg \mathrm{isInvertible}(a)\Vert$$ 
\end{definition}

\begin{definition}
A nontrivial commutative ring $R$ is a \textbf{local ring} if for every element $a:R$ and $b:R$, if the sum $a + b$ is invertible, then either $a$ is invertible or $b$ is invertible. 
$$\mathrm{isLocalRing}(R) := \mathrm{isNonTrivialCRing}(R) \times \prod_{a:R} \prod_{b:R} \mathrm{isInvertible}(a + b) \to \Vert\mathrm{isInvertible}(a) \amalg \mathrm{isInvertible}(b)\Vert$$ 
\end{definition}

\begin{definition}
A field $R$ is \textbf{Heyting} if it is also a local ring. 
$$\mathrm{isHeytingField}(R) := \mathrm{isField}(R) \times \mathrm{isLocalRing}(R)$$ 
\end{definition}

References used in this section: 
\begin{itemize}
\item Emmy Noether, \textit{Ideal Theory in Rings}, Mathematische Annalen 83 (1921)
\item Henri Lombardi, Claude QuittÃ©, \textit{Commutative algebra: Constructive methods (Finite projective modules)}
\item Peter Johnstone, \textit{Rings, Fields, and Spectra}, Journal of Algebra 49 (1977) 238-260
\end{itemize}

\section{vector spaces}

\begin{definition}
Given a field $K$, a $K$-\textbf{vector space} is an abelian group $V$ with a bilinear function $(-)(-):K \times V \to V$ called \textbf{scalar multiplication} such that $1 v = v$ and for all elements $a:K$, $b:K$, and $v:V$, $(a \cdot b) v = a (b v)$. 
\end{definition}

\begin{definition}
A $K$-\textbf{linear map} between two $K$-vector spaces $V$ and $W$ is a group homomorphism $h:V \to W$ which also preserves scalar multiplication: for all elements $a:K$ and $v:V$, $f(a v) = a f(v)$. 
\end{definition}

\begin{definition}
Given a field $K$ and a set $S$, the \textbf{free $K$-vector space} on $S$ is the homotopy initial $K$-vector space $V$ with a function $i:S \to V$: for every other $K$-vector space $W$ with a function $j:S \to W$, the type of linear maps $h:V \to W$ such that for all elements $s:S$, $h(i(s)) = j(s)$ is contractible. 
\end{definition}

\begin{definition}
Given a field $K$ and a natural number $n$, an \textbf{$n$-dimensional $K$-vector space} is a free $K$-vector space on the finite type $\mathrm{Fin}(n)$. 
\end{definition}

\section{the general linear group as automorphism group}
\section{determinants\titledagger}
\section{examples: rationals, polynomials, adding a root, field extensions}
\section{ordered fields, real-closed fields, pythagorean fields, euclidean fields}
\section{complex fields, quadratically closed fields, algebraically closed fields}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "book"
%%% End:
